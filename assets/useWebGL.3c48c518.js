import{an as l,ao as T,W as _,ap as x,u as B}from"./index.b50866e0.js";function C(t){const n=[];return x(()=>n.forEach(o=>o())),new Promise(o=>{n.push(l(()=>{const r=T(t);if(r instanceof HTMLCanvasElement){const{width:a,height:c}=_(r),s=[];n.push(l(()=>{r.width=a.value*devicePixelRatio,r.height=c.value*devicePixelRatio,s.forEach(e=>e())})),o({canvas:r,onDispose:e=>n.push(e),onResize:e=>s.push(e),size:{width:a,height:c},dispose(){n.forEach(e=>e()),n.splice(0,n.length)}})}}))})}function p(t,n,o){const r=t.createShader(t[`${n}_SHADER`]);if(!r)throw new Error("An error occurred while initializing a shader.");if(t.shaderSource(r,`#version 300 es
precision highp float;
`+o.trim()),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS))return r;throw console.log(t.getShaderInfoLog(r)),t.deleteShader(r),new Error("An error occurred while compiling a shader.")}function D(t,n,o){const r=t.createProgram();if(!r)throw new Error("An error occurred while initializing a WebGL program.");const a=p(t,"VERTEX",n),c=p(t,"FRAGMENT",o);if(t.attachShader(r,a),t.attachShader(r,c),t.linkProgram(r),t.getProgramParameter(r,t.LINK_STATUS))return{program:r,vertex:a,fragment:c};throw console.log(t.getProgramInfoLog(r)),t.deleteProgram(r),new Error("An error occurred while creating a WebGL program.")}const F=`
in vec2 _pos;
out vec2 pos;

void main() {
  gl_Position = vec4(pos = _pos, 0, 1);
}`;async function y(t,n,o){var w;const r=await C(t),{canvas:a,onResize:c,onDispose:s}=r,e=a.getContext("webgl2",{preserveDrawingBuffer:o==null?void 0:o.preserveDrawingBuffer});if(!e)throw new Error("An error occurred while initializing the context.");const{program:f,vertex:A,fragment:S}=D(e,(w=o==null?void 0:o.vertShader)!=null?w:F,n);e.useProgram(f),s(()=>e.deleteProgram(f)),s(()=>e.deleteShader(A)),s(()=>e.deleteShader(S));const m=e.getAttribLocation(f,"_pos");e.enableVertexAttribArray(m);const g=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,g),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,1,0,1,1,0,0,1,1,0,0,0]),e.STATIC_DRAW),e.vertexAttribPointer(m,2,e.FLOAT,!1,0,0),s(()=>e.deleteBuffer(g));function h(){e.isContextLost()||(e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.viewport(-a.width,-a.height,2*a.width,2*a.height),e.drawArrays(e.TRIANGLES,0,6))}let u=!1;const E=setInterval(()=>{u&&(u=!1,h())});s(()=>clearInterval(E)),c(h);function R(L,P,b){if(e.isContextLost())return;const v=e.getUniformLocation(f,L);!v||s(l(()=>{let i=B(b);typeof i=="number"&&(i=[i]),typeof i=="boolean"&&(i=[i]),!(i.length<1||i.length>4)&&(e[`uniform${i.length}${P}v`](v,i.map(d=>d===!0?1:d===!1?0:d)),u=!0)}))}return Object.assign(r,{gl:e,program:f,render:h,useUniform:R,destroy(){r.dispose()}})}export{y as u};

var d=Object.defineProperty,f=Object.defineProperties;var y=Object.getOwnPropertyDescriptors;var h=Object.getOwnPropertySymbols;var g=Object.prototype.hasOwnProperty,b=Object.prototype.propertyIsEnumerable;var m=(t,e,a)=>e in t?d(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,u=(t,e)=>{for(var a in e||(e={}))g.call(e,a)&&m(t,a,e[a]);if(h)for(var a of h(e))b.call(e,a)&&m(t,a,e[a]);return t},c=(t,e)=>f(t,y(e));import{au as computed,d as defineComponent,c as createBlock,o as openBlock}from"./index.0a07b922.js";import{a as ace,A as AceEditor}from"./AceEditor.c1c0fb2c.js";const map=new Map([["(","lparen"],[")","rparen"],["=","assign"],[`
`,"newline"],[".","dot"]]),lambdas=new Set(["\u039B","\u03BB","\u1D27","\u2C96","\u2C97","\u{1D6B2}","\u{1D6CC}","\u{1D6EC}","\u{1D706}","\u{1D726}","\u{1D740}","\u{1D760}","\u{1D77A}","\u{1D79A}","\u{1D7B4}","\\"]);function tokenize(t){var o;let e=t.trim();const a=[];for(;e;){if(lambdas.has(e[0]))a.push({type:"lambda"}),e=e.slice(1);else if(map.has(e[0]))a.push({type:map.get(e[0])}),e=e.slice(1);else{const n=e.match(/^[\w\d+\-*\/%@?!:_#$^&|~;'"]+/);n?(a.push({type:"variable",name:n[0]}),e=e.slice(n[0].length)):e=e.slice(1)}for(;e.startsWith(" ")||e.startsWith("	");)e=e.slice(1)}const r=a.reduce((n,s)=>{if(s.type==="lparen"){const i={type:"group",tokens:[],parent:n};return n.tokens.push(i),i}else if(s.type==="rparen"){if(!n.parent)throw new SyntaxError("Unmatched closing parenthesis");return n.parent}return n.tokens.push(s),n},{type:"group",tokens:[]});if(r.parent)throw new SyntaxError("Unmatched opening parenthesis");r.tokens.forEach(function n(s){s.type==="group"&&(delete s.parent,s.tokens.forEach(n))});const l=[];for(let n=0;n<r.tokens.length;n++){const s=r.tokens[n],i=r.tokens[n+1];if(s.type==="variable"&&(i==null?void 0:i.type)==="assign"){if(n===r.tokens.length-2)throw new SyntaxError("An alias declaration must have a value.");if(n===r.tokens.length-3)throw new SyntaxError("An alias declaration must not be the last thing in a script.");const p={type:"alias",name:s.name,value:[]};for(n++;++n<r.tokens.length-1;){if(((o=r.tokens[n+1])==null?void 0:o.type)==="assign"){n--;break}if(r.tokens[n].type==="newline")break;p.value.push(r.tokens[n])}if(p.value.length===0)throw new SyntaxError("An alias must have a value.");l.push(p)}else l.push(s)}return l}function toExpression(t,e={}){var a,r;if(Array.isArray(t)){const l=t.filter(o=>o.type!=="lparen"&&o.type!=="rparen"&&o.type!=="assign"&&o.type!=="newline");if(l.length===0)throw new SyntaxError("Cannot convert empty token list to expression.");if(l.length===1)t=l[0];else if(l[0].type==="lambda"){if(((a=l[1])==null?void 0:a.type)!=="variable")throw new SyntaxError("A lambda must be followed by a variable.");if(((r=l[2])==null?void 0:r.type)!=="dot")throw new SyntaxError("A lambda variable must be followed by a dot.");if(l.length<3)throw new SyntaxError("A lambda function must have a value.");const o=+Math.random().toString().slice(2,12);return{type:"function",variable:l[1].name,scope:o,expr:toExpression(l.slice(3),c(u({},e),{[l[1].name]:o}))}}else if(l[0].type==="alias"){const o=+Math.random().toString().slice(2,12);return{type:"application",lhs:{type:"function",variable:l[0].name,scope:o,expr:toExpression(l.slice(1),c(u({},e),{[l[0].name]:o}))},rhs:toExpression(l[0].value,e)}}else{if(l[0].type==="dot")throw new SyntaxError("A dot cannot appear outside of a lambda function.");{let o=toExpression(l[0],e);for(let n=1;n<l.length;n++){if(l[n].type==="lambda")return{type:"application",lhs:o,rhs:toExpression(l.slice(n),e)};o={type:"application",lhs:o,rhs:toExpression(l[n],e)}}return o}}}if(t.type==="variable")return c(u({},t),{scope:e[t.name]});if(t.type==="group")return toExpression(t.tokens,e);throw new SyntaxError(`Cannot convert singular '${t.type}' token to an expression.`)}function useCompileLambda(t){return computed(()=>{try{const e=tokenize(t.value);return toExpression(e)}catch(e){return console.error(e),""+e}})}function churchNumeral(t){try{return t(e=>e+1)(0)}catch{return 1e10}}const special={"+":"_add","-":"_sub","*":"_mult","/":"_div","%":"_mod","@":"_at","?":"_ques","!":"_exclm",":":"_colon",_:"__","#":"_hash",$:"$","^":"_pos","&":"_amp","|":"_bar","~":"_tilde",";":"_semi","'":"_apos",'"':"_quote",__proto__:null};function normalizeVar(t){return t=t.split("").map(e=>e in special?special[e]:e).join(""),t.match(/^\d/)?`_${t}`:t}function indent(t){return t.split(/\n+/g).join(`
  `)}function toJS(t){try{if(t.type==="variable")return normalizeVar(t.name);if(t.type==="application"){let e=toJS(t.rhs);return t.rhs.type==="function"&&(e=e.slice(1,-1)),e.length>60?`${toJS(t.lhs)}(
  ${indent(e)}
)`:`${toJS(t.lhs)}(${e})`}else{let e=toJS(t.expr);return t.expr.type==="function"&&(e=e.slice(1,-1)),e.length>40?`(${normalizeVar(t.variable)} =>
  ${indent(e)}
)`:`(${normalizeVar(t.variable)} => ${e})`}}catch(e){return""+e}}function evaluate(expr){try{return eval(toJS(expr))}catch(t){return t}}function useEvaluateLambda(t){const e=useCompileLambda(t);return computed(()=>{try{if(typeof e.value=="string")return e.value;const a=evaluate(e.value);return typeof a=="string"?a:churchNumeral(a)}catch(a){return""+a}})}const _sfc_main=defineComponent({__name:"Editor",props:{modelValue:null,readonly:{type:Boolean},placeholder:null,round:{type:Boolean}},emits:["update:modelValue","init","save"],setup(t){ace.define("ace/mode/lambda_calculus",(a,r)=>{const l=a("ace/lib/oop"),o=a("ace/mode/text").Mode,n=a("ace/mode/lambda_calculus_highlight_rules").LambdaCalculusHighlightRules,s=function(){this.HighlightRules=n};l.inherits(s,o),r.Mode=s}),ace.define("ace/mode/lambda_calculus_highlight_rules",(a,r)=>{const l=a("ace/lib/oop"),o=a("ace/mode/text_highlight_rules").TextHighlightRules,n=function(){this.$rules={start:[{defaultToken:"text"}]}};l.inherits(n,o),r.LambdaCalculusHighlightRules=n});function e(a){a.on("change",r=>{r.action==="insert"&&a.replaceAll("\u03BB",{needle:"lambda",caseSensitive:!1})})}return(a,r)=>{var l;return openBlock(),createBlock(AceEditor,{modelValue:t.modelValue,placeholder:(l=t.placeholder)!=null?l:"Write some lambdas...",readonly:t.readonly,round:t.round,mode:"lambda_calculus",onInit:r[0]||(r[0]=o=>e(o)&&a.$emit("init",o)),onSave:r[1]||(r[1]=o=>a.$emit("save",o)),"onUpdate:modelValue":r[2]||(r[2]=o=>a.$emit("update:modelValue",o))},null,8,["modelValue","placeholder","readonly","round"])}}});export{_sfc_main as _,useEvaluateLambda as a,toJS as t,useCompileLambda as u};

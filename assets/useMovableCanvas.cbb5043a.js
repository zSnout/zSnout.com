var L=Object.defineProperty,W=Object.defineProperties;var k=Object.getOwnPropertyDescriptors;var z=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var P=(e,n,t)=>n in e?L(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,M=(e,n)=>{for(var t in n||(n={}))A.call(n,t)&&P(e,t,n[t]);if(z)for(var t of z(n))G.call(n,t)&&P(e,t,n[t]);return e},Y=(e,n)=>W(e,k(n));import{ad as f,f as a,ak as X,m as S,a9 as j,au as T,av as q,aw as V,ap as Z,aq as U,ae as $}from"./index.643da7dc.js";import{u as F}from"./useWebGL.754f09dc.js";function b(e,n,t,s,r){return f(()=>(a(r)-a(e))*(a(s)-a(t))/(a(n)-a(e))+a(t))}function g(e,n,t){const s=X(),r=b(0,s.width,0,1,t.x),i=b(s.height,0,0,1,t.y);return{x:f(()=>r.value*n.x.value+e.x.value),y:f(()=>i.value*n.y.value+e.y.value)}}function H(e,n){const t=X();e=J(e,n);const s=f(()=>{const r=a(e.xStart),i=a(e.xEnd),y=a(e.yStart),c=a(e.yEnd);return t.width.value>t.height.value?{x:(r-(i-r)/2)/2,y}:{x:r,y:(y-(c-y)/2)/2}});return{offset:{x:f(()=>s.value.x),y:f(()=>s.value.y)},scale:{x:f(()=>a(e.xEnd)-a(e.xStart)),y:f(()=>a(e.yEnd)-a(e.yStart))}}}function D(e){return f(()=>[a(e.x),a(e.y)])}function J(e,n){const t=f(()=>{const{xStart:s,xEnd:r,yStart:i,yEnd:y}=e,c=a(s)+a(r),d=a(i)+a(y),v=(a(r)-a(s))/2,x=(a(y)-a(i))/2;let{width:{value:o},height:{value:l}}=n;return(Number.isNaN(o)||o===0)&&(o=l),(Number.isNaN(l)||l===0)&&(l=o),(Number.isNaN(o)||o===0)&&(o=l=1),o<l?{xStart:s,xEnd:r,yStart:d-l/o*x,yEnd:d+l/o*x}:{xStart:c-o/l*v,xEnd:c+o/l*v,yStart:i,yEnd:y}});return{xStart:f(()=>a(t.value.xStart)),xEnd:f(()=>a(t.value.xEnd)),yStart:f(()=>a(t.value.yStart)),yEnd:f(()=>a(t.value.yEnd))}}const O=`
struct Bounds {
  float xStart;
  float xEnd;
  float yStart;
  float yEnd;
};

struct Coordinates {
  float x;
  float y;
};
`,K=`
in vec2 _pos;
out vec2 pos;

uniform vec2 offset;
uniform vec2 scale;

void main() {
  gl_Position = vec4(_pos, 0, 1);
  pos = _pos * scale + offset;
}`;async function Q(e,n,t){var c,d,v,x,o,l,w,m,N;const s={xStart:S((d=(c=t==null?void 0:t.bounds)==null?void 0:c.xStart)!=null?d:-2),xEnd:S((x=(v=t==null?void 0:t.bounds)==null?void 0:v.xEnd)!=null?x:2),yStart:S((l=(o=t==null?void 0:t.bounds)==null?void 0:o.yStart)!=null?l:-2),yEnd:S((m=(w=t==null?void 0:t.bounds)==null?void 0:w.yEnd)!=null?m:2)},r=await F(e,O+n,Y(M({},t),{vertShader:O+((N=t==null?void 0:t.vertShader)!=null?N:K)})),{offset:i,scale:y}=H(s,r.size);if(r.useUniform("offset","f",D(i)),r.useUniform("scale","f",D(y)),(t==null?void 0:t.uniforms)===!0){r.useUniform("bounds.xStart","f",s.xStart),r.useUniform("bounds.xEnd","f",s.xEnd),r.useUniform("bounds.yStart","f",s.yStart),r.useUniform("bounds.yEnd","f",s.yEnd);const E=j(),u=g(i,y,E);r.useUniform("pointer.x","f",u.x),r.useUniform("pointer.y","f",u.y)}return Object.assign(r,{bounds:s,offset:i,scale:y})}const h=T("history");function p(e,n){return h[e]===void 0&&n!==void 0&&(h[e]=""+n),q({get(){return typeof n=="number"?+h[e]:""+h[e]},set(t){h[e]=""+t}})}function tt(e,n){const t=p(e,n.value);n.value=t.value;const s=V(t,n,{direction:"rtl"});return Z(s),s}function et(e,n=1e7){return q({get(){return~~(n*e.value)/n},set(t){e.value=t}})}function _(e,n,t){return{xStart:f(()=>a(e.xStart)+a(t)*(a(n.x)-a(e.xStart))/10),xEnd:f(()=>a(e.xEnd)+a(t)*(a(n.x)-a(e.xEnd))/10),yStart:f(()=>a(e.yStart)+a(t)*(a(n.y)-a(e.yStart))/10),yEnd:f(()=>a(e.yEnd)+a(t)*(a(n.y)-a(e.yEnd))/10)}}async function ut(e,n,t){const s=await Q(e,n,t),{canvas:r,bounds:i,offset:y,onDispose:c,scale:d,useUniform:v}=s,x=j(),o={x:S(NaN),y:S(NaN)},l=S(0),w=_(i,g(y,d,x),l);if((t==null?void 0:t.uniforms)===!0){const u=_(i,g(y,d,x),1);v("zoomRegion.xStart","f",u.xStart),v("zoomRegion.xEnd","f",u.xEnd),v("zoomRegion.yStart","f",u.yStart),v("zoomRegion.yEnd","f",u.yEnd)}c(U(r,"wheel",u=>{u.preventDefault(),x.x.value=u.offsetX,x.y.value=u.offsetY,l.value=Math.sqrt(Math.abs(u.deltaY))*-Math.sign(u.deltaY)/10;const{xStart:{value:C},xEnd:{value:R},yStart:{value:B},yEnd:{value:I}}=w;i.xStart.value=C,i.xEnd.value=R,i.yStart.value=B,i.yEnd.value=I},{passive:!1}));const m=g(y,d,x),N=g(y,d,o);c(U(r,"pointermove",u=>{if(u.preventDefault(),Number.isNaN(o.x.value)||Number.isNaN(o.y.value))return;x.x.value=u.offsetX,x.y.value=u.offsetY;const C=m.x.value-N.x.value,R=m.y.value-N.y.value;i.xStart.value-=C,i.xEnd.value-=C,i.yStart.value-=R,i.yEnd.value-=R,o.x.value=x.x.value,o.y.value=x.y.value})),c(U(r,"pointerdown",u=>{r.setPointerCapture(u.pointerId),o.x.value=u.offsetX,o.y.value=u.offsetY})),c(U("pointerup",u=>{r.releasePointerCapture(u.pointerId),o.x.value=NaN,o.y.value=NaN}));function E(u){c(tt(u,et($(i,u))))}return E("xStart"),E("xEnd"),E("yStart"),E("yEnd"),s}export{tt as s,ut as u};

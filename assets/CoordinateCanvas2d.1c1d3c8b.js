var C=Object.defineProperty,T=Object.defineProperties;var N=Object.getOwnPropertyDescriptors;var f=Object.getOwnPropertySymbols;var l=Object.prototype.hasOwnProperty,g=Object.prototype.propertyIsEnumerable;var d=(s,r,e)=>r in s?C(s,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[r]=e,v=(s,r)=>{for(var e in r||(r={}))l.call(r,e)&&d(s,e,r[e]);if(f)for(var e of f(r))g.call(r,e)&&d(s,e,r[e]);return s},u=(s,r)=>T(s,N(r));var p=(s,r)=>{var e={};for(var t in s)l.call(s,t)&&r.indexOf(t)<0&&(e[t]=s[t]);if(s!=null&&f)for(var t of f(s))r.indexOf(t)<0&&g.call(s,t)&&(e[t]=s[t]);return e};var S=(s,r,e)=>(d(s,typeof r!="symbol"?r+"":r,e),e);import{W as F}from"./WebGlCanvas.52909bf2.js";import{p as x}from"./useOption.58894b67.js";import{s as j}from"./index.b085a846.js";class W extends F{constructor(e,h={}){var o=h,{bounds:t,fragmentString:a,saveBounds:i}=o,n=p(o,["bounds","fragmentString","saveBounds"]);var m,y,c,E;super(e,u(v({},n),{fragmentString:a}));S(this,"saveBounds");S(this,"navTimer",!0);S(this,"bounds");this.saveBounds=i!=null?i:!1,i&&(t={xStart:Number.isFinite(+x.xStart)?+x.xStart:-2,xEnd:Number.isFinite(+x.xEnd)?+x.xEnd:2,yStart:Number.isFinite(+x.yStart)?+x.yStart:-2,yEnd:Number.isFinite(+x.yEnd)?+x.yEnd:2}),this.setBounds({xStart:(m=t==null?void 0:t.xStart)!=null?m:-2,xEnd:(y=t==null?void 0:t.xEnd)!=null?y:2,yStart:(c=t==null?void 0:t.yStart)!=null?c:-2,yEnd:(E=t==null?void 0:t.yEnd)!=null?E:2}),j(this.canvas,()=>this.setBounds(this.bounds))}getNormalizedBounds(){let{xStart:e,xEnd:t,yStart:a,yEnd:i}=this.bounds;const n=e+t,h=a+i,o=(t-e)/2,m=(i-a)/2,{width:y,height:c}=this.canvas;return y>c?(e=n-y/c*o,t=n+y/c*o):(a=h-c/y*m,i=h+c/y*m),{xStart:e,xEnd:t,yStart:a,yEnd:i}}getAdjusters(){const{width:e,height:t}=this.canvas,{xStart:a,xEnd:i,yStart:n,yEnd:h}=this.getNormalizedBounds();return e>t?{scale:{x:i-a,y:h-n},offset:{x:(a-(i-a)/2)/2,y:n}}:{scale:{x:i-a,y:h-n},offset:{x:a,y:(n-(h-n)/2)/2}}}setBounds(e){const{xStart:t,xEnd:a,yStart:i,yEnd:n}=this.bounds=e;this.saveBounds&&this.navTimer&&(x.xStart=""+t,x.xEnd=""+a,x.yStart=""+i,x.yEnd=""+n,this.navTimer=!1,setTimeout(()=>this.navTimer=!0,1e3));const{offset:h,scale:o}=this.getAdjusters();this.setUniform("u_offset",h.x,h.y),this.setUniform("u_scale",o.x,o.y)}pxToCoords(e,t){const{offset:a,scale:i}=this.getAdjusters();return{x:e/this.canvas.clientWidth*i.x+a.x,y:(1-t/this.canvas.clientHeight)*i.y+a.y}}mouseToCoords(){return this.pxToCoords(this.mouse.x,this.canvas.clientHeight-this.mouse.y)}}export{W as C};

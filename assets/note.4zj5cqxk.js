import{E as D,s as E,a as N}from"./index.33vn1inf.js";import{y as T,c as n,s as l,v as x,d as C,A as L}from"./main.200onzgm.js";import{D as V}from"./DocumentDisplay.6d0yf2eg.js";import{I as B}from"./InlineField.sq5fmr9m.js";import{_ as F,H as I}from"./BookmarkIcon.46krkaf8.js";import{l as W,r as c,h as q,d as M,x as o,y as a,F as p,D as g,G as w,u as s,H as v,a9 as k,I as h,C as R,E as U,ac as $}from"./runtime-core.esm-bundler.47vl3tei.js";import"./_commonjsHelpers.3aq3i5tf.js";import"./_plugin-vue_export-helper.4yxwi37t.js";import"./Navigation.vue_vue_type_script_setup_true_lang.4wr1p5fg.js";import"./Logo.vue_vue_type_script_setup_true_lang.2nyidlx8.js";import"./LogoLight.3fmf1259.js";import"./SharedNav.4z4l3m5g.js";import"./VStack.3evi6szx.js";import"./Field.5c7fkv56.js";const z={key:0},Y={key:1},A={key:2},G={key:3},O={key:0,style:{margin:"0 0 1em 0"}},j=["href"],J={key:0},de=W({__name:"note",setup(K){const e=""+T().query.id,r=c("Loading title..."),u=c("waiting"),y=c(!1);n.on("notes:note",(m,t)=>{m===e&&(t===!1?u.value="invalid":(u.value="editing",i.commands.setContent(t,!1)))}),n.on("notes:details",m=>{m.id===e&&(r.value=m.title)}),q(()=>{n.emit("notes:request:note",l.value,e),n.emit("notes:request:details",l.value,e)});const i=new D({extensions:[E]}),_=c(!0),d=c(!1),S=x(()=>{d.value||(_.value=!0,n.emit("notes:update:note",l.value,e,i.getHTML()))},500,{maxWait:1e3}),H=x(()=>{r.value&&n.emit("notes:update:title",l.value,e,r.value)},500,{maxWait:1e3});return i.on("update",()=>{d.value=i.getHTML().length>=1e4,_.value=!1,S()}),M(()=>{n.emit("notes:update:note",l.value,e,i.getHTML()),n.emit("notes:update:title",l.value,e,r.value),i.destroy()}),(m,t)=>{const b=$("RouterLink");return o(),a(w,null,[p(V,null,{default:g(()=>[!s(C)&&u.value!=="editing"?(o(),a("p",z," You're not connected to a zServer. Check your internet and try again. ")):s(l)?u.value==="waiting"?(o(),a("p",A," Hey @"+h(s(L))+"! We're fetching your note right now... ",1)):u.value==="invalid"?(o(),a("p",G,[v(" Sorry @"+h(s(L))+", but it looks like you don't own this note. Let's ",1),p(b,{to:"/my-notes"},{default:g(()=>[v("go back to your notes.")]),_:1})])):(o(),a(w,{key:4},[s(C)?(o(),R(I,{key:1,style:{"margin-bottom":"1em"}},{default:g(()=>[k("span",null,h(d.value?"Whoops!":_.value?"Synced:":"Syncing:"),1),p(B,{flex:!d.value,maxlength:100,"model-value":r.value,placeholder:"Note title...","onUpdate:modelValue":t[1]||(t[1]=f=>(r.value=f,s(H)()))},null,8,["flex","model-value"]),d.value?(o(),a("span",J,"is too large and cannot be synced.")):U("",!0)]),_:1})):(o(),a("p",O,[v(" Looks like you disconnected from a zServer. Copy your recent changes and "),k("a",{href:`/note?id=${e}`},"reload the page.",8,j)])),p(s(N),{editor:s(i)},null,8,["editor"])],64)):(o(),a("p",Y,[v(" You have to "),k("span",{class:"link",onClick:t[0]||(t[0]=f=>y.value=!0)},"log in"),v(" before you can edit a note. ")]))]),_:1}),p(F,{open:y.value,"onUpdate:open":t[2]||(t[2]=f=>y.value=f)},null,8,["open"])],64)}}});export{de as default};

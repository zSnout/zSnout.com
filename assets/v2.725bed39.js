var A=Object.defineProperty;var y=Object.getOwnPropertySymbols;var S=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var _=(r,a,n)=>a in r?A(r,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[a]=n,$=(r,a)=>{for(var n in a||(a={}))S.call(a,n)&&_(r,n,a[n]);if(y)for(var n of y(a))z.call(a,n)&&_(r,n,a[n]);return r};import{u as useNavLink,D as DocumentDisplay}from"./DocumentDisplay.c57d1884.js";import{_ as _export_sfc,H as HStack}from"./Modal.005a0319.js";import{a as ace,A as AceEditor,u as useCompleteConsole,C as Console}from"./AceEditor.ee8e313b.js";import{d as defineComponent,c as createBlock,o as openBlock,u as unref,y as isRef,w as withCtx,b as createVNode}from"./index.008fb619.js";import{u as useLocationHash}from"./useLocationHash.1faa9654.js";import"./Labeled.149c5036.js";import"./Field.6f226a40.js";const _sfc_main$2=defineComponent({__name:"Editor2",props:{modelValue:null,readonly:{type:Boolean},placeholder:null,round:{type:Boolean}},emits:["update:modelValue","init","save"],setup(r){return ace.define("ace/mode/storymatic2",(a,n)=>{const t=a("ace/lib/oop"),o=a("ace/mode/text").Mode,s=a("ace/mode/storymatic2_highlight_rules").StorymaticHighlightRules,u=function(){this.HighlightRules=s,this.lineCommentStart="#"};t.inherits(u,o),n.Mode=u}),ace.define("ace/mode/storymatic2_highlight_rules",function(a,n){const t=a("ace/lib/oop"),o=a("ace/mode/text_highlight_rules").TextHighlightRules,s=function(){this.$rules={start:[{token:["keyword.other","text","variable.other","text","constant.other","comment.line.other"],regex:/^(#import)( +)([A-Za-z_][A-Za-z0-9_]*)( +)((?:@[A-Za-z_][A-Za-z0-9_]*(?:$| +))+)( *<--.+)$/},{token:["keyword.other","text","variable.other","text","constant.other"],regex:/^(#import)( +)([A-Za-z_][A-Za-z0-9_]*)( +)((?:@[A-Za-z_][A-Za-z0-9_]*(?:$| +))+)$/},{token:["keyword.other","text","variable.other","comment.line.other"],regex:/^(#import)( +)([A-Za-z_][A-Za-z0-9_]*)( *<--.+)$/},{token:["keyword.other","text","variable.other"],regex:/^(#import)( +)([A-Za-z_][A-Za-z0-9_]*)$/},{token:["keyword.other","comment.line.other"],regex:/^(#importall)( *<--.+)$/},{token:"keyword.other",regex:/^#importall$/},{token:["keyword.other","text","variable.other.markup.underline.link","comment.line.other"],regex:/^(#library)( +)([^ ]+)( *<--.+)$/},{token:["keyword.other","text","variable.other.markup.underline.link"],regex:/^(#library)( +)([^ ]+)$/},{token:["keyword.other","text","variable.other.markup.underline.link","text","string.other","comment.line.other"],regex:/^(#plugin)( +)([^ ]+)( +)(.+)( *<--.+)$/},{token:["keyword.other","text","variable.other.markup.underline.link","text","string.other"],regex:/^(#plugin)( +)([^ ]+)( +)(.+)$/},{token:"comment.block",regex:/\/\*/,next:"comment"},{token:["variable.other","text","keyword.operator","text","string.other","comment.line.other"],regex:/^(\$[A-Za-z_][A-Za-z0-9_]*)( *)(=)( *)(.+)( *<--.+)$/},{token:["variable.other","text","keyword.operator","text","string.other"],regex:/^(\$[A-Za-z_][A-Za-z0-9_]*)( *)(=)( *)(.+)$/},{token:["constant.other","text","variable.other","text","variable.other","comment.line.other"],regex:/^(@[A-Za-z_][A-Za-z0-9_]*)(?:( +)(\$[A-Za-z_][A-Za-z0-9_]*|NONE))?(?:( +)(\$[A-Za-z_][A-Za-z0-9_]*|NONE))?( *<--.+)$/},{token:["constant.other","text","variable.other","text","variable.other"],regex:/^(@[A-Za-z_][A-Za-z0-9_]*)(?:( +)(\$[A-Za-z_][A-Za-z0-9_]*|NONE))?(?:( +)(\$[A-Za-z_][A-Za-z0-9_]*|NONE))?$/},{token:["text","constant.other","comment.line.other"],regex:/^( +)(@[A-Za-z_][A-Za-z0-9_]*)( *<--.+)$/},{token:["text","constant.other"],regex:/^( +)(@[A-Za-z_][A-Za-z0-9_]*)$/},{token:["text","constant.other","text"],regex:/^( +)(@[A-Za-z_][A-Za-z0-9_]*)( +)/,next:"text"},{token:["text","constant.other","text"],regex:/^( +)(@[A-Za-z_][A-Za-z0-9_]*)(\()/,next:"argument"},{token:["text","variable.other","text","keyword.operator","text"],regex:/^( +)(\$[A-Za-z_][A-Za-z0-9_]*)( *)(\+=|-=|\*=|\/=|=)( *)/,next:"text"},{token:["text","variable.other","text","keyword.operator","text"],regex:/^( +)(\$[A-Za-z_][A-Za-z0-9_]*)( *)(@=)( *)/,next:"expression"},{token:["text","variable.other","text","keyword.operator"],regex:/^( +)(\$[A-Za-z_][A-Za-z0-9_]*)( *)(\+\+|--)$/},{token:["text","variable.other","text","keyword.operator"],regex:/^( +)(\$[A-Za-z_][A-Za-z0-9_]*)( *)(--)$/},{token:"comment.line.number-sign",regex:/#.+$/},{token:"comment.line.other",regex:/<--.+$/},{token:"text",regex:/^ +/,next:"text"},{defaultToken:"text"}],text:[{token:"constant.character.escape",regex:/\$\$/},{token:"comment.line.number-sign",regex:/#.+$/},{token:"comment.line.other",regex:/<--.+$/},{token:"comment.block",regex:/\/\*/,next:"comment"},{token:"variable.other",regex:/\$[A-Za-z_][A-Za-z0-9_]*/},{token:"string.other",regex:/-?[0-9]+(?:\.[0-9]+)?/},{regex:/^|$/,next:"start"},{defaultToken:"text"}],expression:[{token:"comment.line.number-sign",regex:/#.+$/},{token:"comment.line.other",regex:/<--.+$/},{token:"comment.block",regex:/\/\*/,next:"comment"},{token:"variable.other",regex:/\$[A-Za-z_][A-Za-z0-9_]*/},{token:"string.other",regex:/-?[0-9]+(?:\.[0-9]+)?/},{token:"keyword.operator",regex:/\(|\)|<|>|\*|\/|%|\+|-|!|=|and|or|&&|\|\|/},{regex:/^|$/,next:"start"},{defaultToken:"text"}],comment:[{token:"comment.block",regex:/\*\//,next:"start"},{defaultToken:"comment.block"}],argument:[{token:"constant.character.escape",regex:/\$\$|\)\)/},{token:"text",regex:/\) +/,next:"text"},{token:"text",regex:/\)$/,next:"start"},{token:"comment.line.number-sign",regex:/#.+$/},{token:"comment.line.other",regex:/<--.+$/},{token:"comment.block",regex:/\/\*/,next:"comment"},{token:"variable.other",regex:/\$[A-Za-z_][A-Za-z0-9_]*/},{token:"string.other",regex:/-?[0-9]+(?:\.[0-9]+)?/},{regex:/^|$/,next:"start"},{defaultToken:"text"}]}};t.inherits(s,o),n.StorymaticHighlightRules=s}),(a,n)=>{var t;return openBlock(),createBlock(AceEditor,{modelValue:r.modelValue,placeholder:(t=r.placeholder)!=null?t:"Write a story...",readonly:r.readonly,round:r.round,mode:"storymatic2",onInit:n[0]||(n[0]=o=>a.$emit("init",o)),onSave:n[1]||(n[1]=o=>a.$emit("save",o)),"onUpdate:modelValue":n[2]||(n[2]=o=>a.$emit("update:modelValue",o))},null,8,["modelValue","placeholder","readonly","round"])}}});String.prototype.realMatchAll=function(r){return Array.from(this.matchAll(r))};class _Storymatic{constructor(story,callback){story=_Storymatic.parse(story),this.original=story.original,this.variables=story.variables,this.parsed=JSON.parse(JSON.stringify(story)),this.commands={};var add=(r,a,n,t)=>{this.commands[r]||(this.commands[r]=(o,s,u,m,l,h)=>{this.setVariable(a,o),this.setVariable(n,u),this.runParsed(t,()=>{!l||l.length==0?typeof h=="function"&&h():this.run(l,h)})})};for(var command in story.commands)if(!(command in this.commands)){var cmd=story.commands[command];add(command,cmd.arg,cmd.codeblock,cmd.body)}var libs=[],plugins=[];story.libs.map(r=>libs.push(fetch(r,{mode:"no-cors",cache:"reload"}))),story.plugins.map(r=>plugins.push(fetch(r[0],{mode:"no-cors",cache:"reload"}))),Promise.allSettled(plugins).then(data=>{for(var pluginText=[],i=0;i<data.length;i++)data[i].status=="fulfilled"&&data[i].value.ok&&data[i].value.status==200&&pluginText.push(data[i].value.text());Promise.allSettled(pluginText).then(data=>{data.map(e=>eval(e.value)),Promise.allSettled(libs).then(r=>{for(var a=[],n=0;n<r.length;n++)r[n].status=="fulfilled"&&r[n].value.ok&&r[n].value.status==200&&a.push(r[n].value.text());Promise.allSettled(a).then(t=>{t=t.map(u=>u.value);var o=0,s=()=>{if(o>=t.length){story.importall&&(story.imports=Object.keys(_Storymatic.imports));for(var u=0;u<story.importfrom.length;u++)if(story.importfrom[u][0]in _Storymatic.imports)for(var m=_Storymatic.imports[story.importfrom[u][0]],l=0;l<story.importfrom[u][1].length;l++){var h=story.importfrom[u][1][l];h in m&&(this.commands[h]=m[h])}for(var u=0;u<story.imports.length;u++)if(story.imports[u]in _Storymatic.imports){var m=_Storymatic.imports[story.imports[u]];for(var h in m)this.commands[h]=m[h]}typeof callback=="function"&&callback(this)}else this.mergeWith(t[o],()=>{o++,s()})};s()})})})})}mergeWith(r,a){var n=_Storymatic.parse(r),t=(u,m,l,h)=>{this.commands[u]||(this.commands[u]=(f,p,d,g,c,v)=>{this.setVariable(m,f),this.setVariable(l,d),this.runParsed(h,()=>{!c||c.length==0?typeof v=="function"&&v():this.run(c,v)})})};for(var o in n.commands)if(!(o in this.commands)){var s=n.commands[o];t(o,s.arg,s.codeblock,s.body)}typeof a=="function"&&a()}getVariable(r){var a=this.variables[r];return a==null||a.replace(/\s+/g,"")===""?"":a.match(/^-?[0-9]+(?:\.[0-9]+)?$/)?+a:a}setVariable(r,a){if(r)a=`${a}`;else return;this.variables[r]=a}calc(r){var a=t=>{var o=()=>{if(typeof t=="boolean"||typeof t=="string"||typeof t=="number")return t;if(typeof t!="object"||!t.type)return!1;if(t.type=="variable")return this.getVariable(t.name);if(t.type=="invert")return!a(t.values[0]);if(t.type=="multiply")return a(t.values[0])*a(t.values[1]);if(t.type=="divide")return a(t.values[0])/a(t.values[1]);if(t.type=="modulus")return a(t.values[0])%a(t.values[1]);if(t.type=="add")return a(t.values[0])+a(t.values[1]);if(t.type=="subtract")return a(t.values[0])-a(t.values[1]);if(t.type=="less_than")return a(t.values[0])<a(t.values[1]);if(t.type=="greater_than")return a(t.values[0])>a(t.values[1]);if(t.type=="less_than_equal")return a(t.values[0])<=a(t.values[1]);if(t.type=="greater_than_equal")return a(t.values[0])>=a(t.values[1]);if(t.type=="equal")return a(t.values[0])==a(t.values[1]);if(t.type=="not_equal")return a(t.values[0])!=a(t.values[1]);if(t.type=="and")return!!(a(t.values[0])&&a(t.values[1]));if(t.type=="or")return!!(a(t.values[0])||a(t.values[1]))},s=o();return s===!0||s=="TRUE"?!0:s===!1||s=="FALSE"?!1:s},n=a(r);return n===!0?"TRUE":n===!1?"FALSE":""+n}expr(r){return this.calc(_Storymatic.expr(r))}is(r){var a;return typeof r=="string"?a=this.expr(r):a=this.calc(r),a===!0||a.toUpperCase()=="TRUE"}runCommand(r,a,n,t,o,s,u){r in this.commands?this.commands[r].call(this,...JSON.parse(JSON.stringify([a,n,t,o,s])),u):s.length==0?typeof u=="function"&&u():this.run(s,u)}runCode(r,a){r=_Storymatic.parseBlock.inner(r),this.runParsed(r,a)}runParsed(r,a){this.run(r,a)}runVariable(r,a,n,t){if(a=="@=")return n.replace(/\s+/g,"")==""?this.setVariable(r,""):this.setVariable(r,this.expr(n)),typeof t=="function"?t():null;if(a=="=")return n.replace(/\s+/g,"")==""?this.setVariable(r,""):this.setVariable(r,this.parseText(n)),typeof t=="function"?t():null;var o=this.getVariable(r),s=this.parseText(n);return o==""?(this.setVariable(r,s),typeof t=="function"?t():null):(!isNaN(+o)&&!isNaN(+s)&&(o=+o,s=+s),a=="+="&&(o+=s),a=="-="&&(o-=s),a=="*="&&(o*=s),a=="/="&&(o/=s),a=="%="&&(o%=s),this.setVariable(r,o),typeof t=="function"?t():null)}print(r,a){_Storymatic.print(this.parseText(r),a)}parseText(r){return r.replace(/\$\$|\$([A-Za-z_][A-Za-z0-9_]*)/g,a=>a=="$$"?"$":this.getVariable(a.substr(1)))}run(r,a){r=JSON.parse(JSON.stringify(r)),setTimeout(()=>{if(r.length==0)return typeof a=="function"?a():null;var n=r.shift(),t=()=>r.length==0?typeof a=="function"?a():null:this.run(r,a);n.action=="command"?this.runCommand(n.name,n.arg,n.expr,n.code,n.parsed,r,a):n.action=="code"?this.runCode(n.code,t):n.action=="parsed"?this.runParsed(n.code,t):n.action=="print"?this.print(n.text,t):n.action=="variable"?this.runVariable(n.name,n.mode,n.value,t):this.run(r,t)},0)}start(r){typeof r!="function"&&(r=()=>{}),this.runCommand("start","","",[],[],r)}context(r){new _Storymatic(this.original,a=>{a.variables=JSON.parse(JSON.stringify(this.parsed.variables)),typeof r=="function"&&r(a)})}}_Storymatic.parseBlock={precomment:function(r){var a=/ *<--.+$/gm;return r.replace(a,"")},importfrom:function(r){var a=/^#import +([A-Za-z_][A-Za-z0-9_]*) +((?:@[A-Za-z_][A-Za-z0-9_]*(?:$| *,? *))+)$/gm;return r.realMatchAll(a),[r.replace(a,""),r.realMatchAll(a).map(n=>[n[1],n[2].realMatchAll(/@[A-Za-z_][A-Za-z0-9_]*/g).map(t=>t[0].substr(1))])]},imports:function(r){var a=/^#import +([^ \n\r]+)$/gm;return[r.replace(a,""),r.realMatchAll(a).map(n=>n[1])]},importall:function(r){var a=/^#importall$/gm;return[r.replace(a,""),!!r.realMatchAll(a).length]},libs:function(r){var a=/^#library +([^ \n\r]+)$/gm;return[r.replace(a,""),r.realMatchAll(a).map(n=>n[1]).filter(n=>{try{new URL(n)}catch{return!1}return n.substr(0,5)=="https"})]},plugins:function(r){var a=/^#plugin +([^ \n\r]+) +(.+)$/gm;return[r.replace(a,""),r.realMatchAll(a).map(n=>[n[1],n[2]]).filter(n=>{try{new URL(n[0])}catch{return!1}return n[0].substr(0,5)=="https"})]},commentblock:function(r){var a=/\/\*(?:[^\*]|\*(?=[^/]|$))*\*\/|\/\*(?:[^\*]|\*(?=[^/]|$))*$/g;return r.replace(a,"")},comments:function(r){var a=/ *#.+$/gm;return r.replace(a,"")},variables:function(r){var a=/^\$([A-Za-z_][A-Za-z0-9_]*) *= *(.+)$/gm,n=r.realMatchAll(a).map(t=>[t[1],t[2]]);return[r.replace(a,""),n]},commands:function(r){var a=/^@([A-Za-z_][A-Za-z0-9_]*)(?: +\$([A-Za-z_][A-Za-z0-9_]*)| +NONE)?(?: +\$([A-Za-z_][A-Za-z0-9_]*)| +NONE)? *$\n((?:^( +).*$)(?:\n^\5.*$)*)/gm,n=r.realMatchAll(a).map(t=>[null,t[1],t[2],t[3],t[4],t[5]]);return n=n.map(function(t){var o=t[5].length;return t[4]=t[4].split(`
`).map(s=>s.substr(o)),[t[1],t[2],t[3],t[4].join(`
`)]}),n},inner:function(r){r=r.split(`
`);var a=[],n;if(r.length===0)return[];var t=()=>r=r.filter((u,m)=>m>0).join(`
`);if(r.length>=2&&(n=r.join(`
`).match(/^@([A-Za-z_][A-Za-z0-9_]*?)(?: +(.+))?\n((?:( +).+)(?:\n\4.+)*)(?=\n|$)/))){var o=n[4].length,s=n[3].split(`
`).length+1;a.push({action:"command",name:n[1],arg:n[2]||"",expr:_Storymatic.expr(n[2]||""),code:n[3].split(`
`).map(u=>u.substr(o)).join(`
`),parsed:_Storymatic.parseBlock.inner(n[3].split(`
`).map(u=>u.substr(o)).join(`
`))}),r=r.filter((u,m)=>m>=s).join(`
`)}else(n=r.join(`
`).match(/^@([A-Za-z_][A-Za-z0-9_]*?)(?: +(.+))?(?=\n|$)/))?(a.push({action:"command",name:n[1],arg:n[2]||"",expr:_Storymatic.expr(n[2]||""),code:"",parsed:[]}),t()):(n=r[0].match(/^@([A-Za-z_][A-Za-z0-9_]*)\(((?:[^\)]|\)\))+)?\)(?: +(.+))?$/))?(a.push({action:"command",name:n[1],arg:n[2]||"",expr:_Storymatic.expr(n[2]||""),code:n[3]||"",parsed:_Storymatic.parseBlock.inner(n[3]||"")}),t()):(n=r.join(`
`).match(/^\$([A-Za-z_][A-Za-z0-9_]*) *(\+=|-=|\*=|\/=|%=|@=|=) *(.+)(?=\n|$)/))?(a.push({action:"variable",name:n[1],mode:n[2],value:n[3]}),t()):(n=r[0].match(/^\$([A-Za-z_][A-Za-z0-9_]*) *\+\+$/))?(a.push({action:"variable",name:n[1],mode:"+=",value:"1"}),t()):(n=r[0].match(/^\$([A-Za-z_][A-Za-z0-9_]*) *--$/))?(a.push({action:"variable",name:n[1],mode:"-=",value:"1"}),t()):r[0].replace(/ +/g,"")===""?t():(a.push({action:"print",text:r[0]}),r=r.filter((u,m)=>m>0).join(`
`));return r===""?a:a.concat(_Storymatic.parseBlock.inner(r))}};_Storymatic.parse=function(r){var a,n,t,o,s,u,m,l=r;r=r.split(`
`).filter(d=>d.replace(/ /g,"")).join(`
`),r=_Storymatic.parseBlock.precomment(r),[r,a]=_Storymatic.parseBlock.importfrom(r),[r,n]=_Storymatic.parseBlock.imports(r),[r,t]=_Storymatic.parseBlock.importall(r),[r,o]=_Storymatic.parseBlock.libs(r),[r,s]=_Storymatic.parseBlock.plugins(r),r=_Storymatic.parseBlock.commentblock(r),r=_Storymatic.parseBlock.comments(r),[r,u]=_Storymatic.parseBlock.variables(r),m=_Storymatic.parseBlock.commands(r),m=m.map(d=>[d[0],d[1]||"",d[2]||"",_Storymatic.parseBlock.inner(d[3])]);var h,f={};for(h=0;h<m.length;h++)f[m[h][0]]={arg:m[h][1],codeblock:m[h][2],body:m[h][3]};var p={};for(h=0;h<u.length;h++)p[u[h][0]]=u[h][1];return{original:l,importfrom:a,imports:n,importall:t,libs:o,plugins:s,variables:p,commands:f}};_Storymatic.parseExpr={verify:function(r){var a=/\(|\)|<=|>=|<|>|!=|\*|\/|%|\+|-|!|=|and|or|&&|\|\||-?[0-9]+(?:\.[0-9]+)?|\$[A-Za-z_][A-Za-z0-9_]*/g;if(r.replace(a,"").match(/[^ ]/)||!r.match(a))return!1;var n=r.match(a),t="<= >= < > != * / % + - = and or && ||".split(" "),o=m=>m.match(/-?[0-9]+(?:\.[0-9]+)?/),s=m=>m.match(/\$[A-Za-z_][A-Za-z0-9_]*/);if(t.indexOf(n[0])>-1||n[0]==")"||t.indexOf(n[n.length-1])>-1||n[n.length-1]=="("||n[n.length-1]=="!"||n.filter(m=>m=="(").length!=n.filter(m=>m==")").length)return!1;for(var u=0;u<n.length-1;u++)if(t.indexOf(n[u])>-1&&t.indexOf(n[u+1])>-1||t.indexOf(n[u])>-1&&n[u+1]==")"||(o(n[u])||s(n[u]))&&(o(n[u+1])||s(n[u+1])))return!1;return!0},tokenize:function(r){var a=/\$[A-Za-z_][A-Za-z0-9_]*|-?[0-9]+(?:\.[0-9]+)?|\(|\)|\|\||&&|\+|-|\*|\/|%|!=|!|<=|>=|<|>|=/g;return r.match(a)||[]},paren:function(r){for(var a=[],n=[],t=0,o=!1,s=r.length,u=0;u<s;u++)o?(r[u]=="("&&t++,r[u]==")"&&t--,t==-1?(o=!1,t=0,a.push(_Storymatic.expr(n.join(" ")))):n.push(r[u])):r[u]=="("?o=!0:a.push(r[u]);return a},varnums:function(r){for(var a,n=0;n<r.length;n++)typeof r[n]=="string"&&(a=r[n].match(/^\$([A-Za-z_][A-Za-z0-9_]*)$/))&&(r[n]={type:"variable",name:a[1]}),typeof r[n]=="string"&&(a=r[n].match(/(-?[0-9]+(?:\.[0-9]+)?)/))&&(r[n]=+a[1]);return r},not:function(r){for(var a=[],n=(o,s,u)=>{a.push({type:o,values:s}),t+=u},t=0;t<r.length;t++)r[t]=="!"?n("invert",[r[t+1]],1):a.push(r[t]);return a},prodquotmod:function(r){for(var a=[],n=(o,s,u)=>{a.push({type:o,values:s}),t+=u},t=0;t<r.length;t++)r[t+1]=="*"?n("multiply",[r[t],r[t+2]],2):r[t+1]=="/"?n("divide",[r[t],r[t+2]],2):r[t+1]=="%"?n("modulus",[r[t],r[t+2]],2):a.push(r[t]);return a},plusminus:function(r){for(var a=[],n=(o,s,u)=>{a.push({type:o,values:s}),t+=u},t=0;t<r.length;t++)r[t+1]=="+"?n("add",[r[t],r[t+2]],2):r[t+1]=="-"?n("subtract",[r[t],r[t+2]],2):a.push(r[t]);return a},compare:function(r){for(var a=[],n=(o,s,u)=>{a.push({type:o,values:s}),t+=u},t=0;t<r.length;t++)r[t+1]=="<"?n("less_than",[r[t],r[t+2]],2):r[t+1]==">"?n("greater_than",[r[t],r[t+2]],2):r[t+1]=="<="?n("less_than_equal",[r[t],r[t+2]],2):r[t+1]==">="?n("greater_than_equal",[r[t],r[t+2]],2):a.push(r[t]);return a},equal:function(r){for(var a=[],n=(o,s,u)=>{a.push({type:o,values:s}),t+=u},t=0;t<r.length;t++)r[t+1]=="="?n("equal",[r[t],r[t+2]],2):r[t+1]=="!="?n("not_equal",[r[t],r[t+2]],2):a.push(r[t]);return a},and:function(r){for(var a=[],n=(o,s,u)=>{a.push({type:o,values:s}),t+=u},t=0;t<r.length;t++)r[t+1]=="and"||r[t+1]=="&&"?n("and",[r[t],r[t+2]],2):a.push(r[t]);return a},or:function(r){for(var a=[],n=(o,s,u)=>{a.push({type:o,values:s}),t+=u},t=0;t<r.length;t++)r[t+1]=="or"||r[t+1]=="||"?n("or",[r[t],r[t+2]],2):a.push(r[t]);return a}};_Storymatic.expr=function(r){return _Storymatic.parseExpr.verify(r)?(r=_Storymatic.parseExpr.tokenize(r),r=_Storymatic.parseExpr.paren(r),r=_Storymatic.parseExpr.varnums(r),r=_Storymatic.parseExpr.not(r),r=_Storymatic.parseExpr.prodquotmod(r),r=_Storymatic.parseExpr.plusminus(r),r=_Storymatic.parseExpr.compare(r),r=_Storymatic.parseExpr.equal(r),r=_Storymatic.parseExpr.and(r),r=_Storymatic.parseExpr.or(r),r[0]):{type:"equal",values:[0,1]}};_Storymatic.tooltip=(r,a)=>typeof a=="function"?a():null;_Storymatic.write=(r,a)=>typeof a=="function"?a(alert(r)):null;_Storymatic.print=(r,a)=>typeof a=="function"?a(alert(r)):null;_Storymatic.image=(r,a)=>typeof a=="function"?a():null;_Storymatic.line=r=>typeof r=="function"?r():null;_Storymatic.clear=r=>typeof r=="function"?r():null;_Storymatic.type=(r,a,n)=>typeof n=="function"?n(alert(r)):null;_Storymatic.input=(r,a)=>typeof a=="function"?a(prompt(r)):null;_Storymatic.choice=(r,a,n)=>{function t(){var o=prompt(r+`
Choose From: `+a.join(","));return a.indexOf(o)==-1?t():o}typeof n=="function"&&n(t())};_Storymatic.waitingFor=[];_Storymatic.waitFor=(r,a,n)=>{typeof n=="function"&&n(r)};_Storymatic.imports={};_Storymatic.imports.time={nowait:function(r,a,n,t,o,s){_Storymatic.write(this.parseText(r),()=>{this.run(o,s)})},wait:function(r,a,n,t,o,s){if(r=+this.parseText(r),isNaN(r))return this.run(o,s);setTimeout(()=>{this.run(o,s)},1e3*r)},wait_ms:function(r,a,n,t,o,s){if(r=+this.parseText(r),isNaN(r))return this.run(o,s);setTimeout(()=>{this.run(o,s)},r)}};_Storymatic.imports.input={menu:function(r,a,n,t,o,s){var u=t.filter(m=>m.action=="command"&&m.name=="option"&&m.arg.replace(/\s+/g,"")!="");if(u.length==0)return this.run(o,s);_Storymatic.choice(this.parseText(r),u.map(m=>this.parseText(m.arg)),m=>{this.run(u[m].parsed,()=>{this.run(o,s)})})},choice:function(r,a,n,t,o,s){var u=r.match(/^\$([A-Za-z_][A-Za-z0-9_]*) +(.+)$/);if(!u)return this.run(o,s);var m=t.filter(l=>l.action=="command"&&l.name=="option"&&l.arg.replace(/\s+/g,"")!="");if(m.length==0)return this.run(o,s);_Storymatic.choice(this.parseText(r),m.map(l=>this.parseText(l.arg)),l=>{m[l].code.replace(/\s+/g)==""?this.setVariable(u[1],this.parseText(m[l].arg)):this.setVariable(u[1],this.parseText(m[l].code)),this.run(o,s)})},input:function(r,a,n,t,o,s){var u=/^\$([A-Za-z_][A-Za-z0-9_]*) +(.+)$/,m,l=n.replace(/\s+/g,"")==""?[]:n.split(`
`).map(f=>this.parseText(f)).map(f=>f.toLowerCase());if(!(m=r.match(u)))return this.run(o,s);var h=()=>{_Storymatic.input(m[2],f=>f.replace(/\s+/g,"")==""||l.length>0&&l.indexOf(f.toLowerCase())==-1?h():(this.setVariable(m[1],f),this.run(o,s)))};h()},input_cs:function(r,a,n,t,o,s){var u=/^\$([A-Za-z_][A-Za-z0-9_]*) +(.+)$/,m,l=n.replace(/\s+/g,"")==""?[]:n.split(`
`).map(f=>this.parseText(f)).map(f=>f.toLowerCase());if(!(m=r.match(u)))return this.run(o,s);var h=()=>{_Storymatic.input(m[2],f=>f.replace(/\s+/g,"")==""||l.length>0&&l.indexOf(f)==-1?h():(this.setVariable(m[1],f),this.run(o,s)))};h()},number:function(r,a,n,t,o,s){var u=/^\$([A-Za-z_][A-Za-z0-9_]*) +(.+)$/,m=r.match(u);if(!m)return this.run(o,s);var l=-1/0,h=1/0,f=0,p=!1;if(n=n.split(`
`),n.map(c=>{var v;(v=c.match(/^min *: *(-?[0-9]+(?:\.[0-9]+)?)/))&&(l=+v[1]),(v=c.match(/^max *: *(-?[0-9]+(?:\.[0-9]+)?)/))&&(h=+v[1]),(v=c.match(/^step *: *([0-9]+(?:\.[0-9]+)?)/))&&(f=+v[1]),(c=="integer"||c=="int")&&(p=!0),c=="float"&&(p=!1)}),l>h){var d=l;l=h,h=d}var g=()=>{_Storymatic.input(m[2],c=>c.replace(/\s/g,"")==""||(c=+c,isNaN(c))||c<l||c>h||p&&Math.floor(c)!=c||f&&Math.floor((c-l)/f)!=(c-l)/f?g():(this.setVariable(m[1],c),this.run(o,s)))};g()},bind_once:function(r,a,n,t,o,s){if(r.replace(/\s+/g,"")=="")return this.run(o,s);if(n.replace(/\s+/g,"")=="")return this.run(o,s);_Storymatic.waitFor(this.parseText(r),!0,()=>{this.run(JSON.parse(JSON.stringify(t)))}),this.run(o,s)},bind_forever:function(r,a,n,t,o,s){if(n.replace(/\s/g,"")=="")return this.run(o,s);if(r.replace(/\s/g,"")=="")return this.run(o,s);_Storymatic.waitFor(this.parseText(r),!1,()=>{this.run(JSON.parse(JSON.stringify(t)))}),this.run(o,s)},unbind:function(r,a,n,t,o,s){r.replace(/\s/g,"")!=""?_Storymatic.waitingFor=_Storymatic.waitingFor.filter(u=>r.split(/\s+/g).indexOf(u.key.toLowerCase())==-1):_Storymatic.waitingFor=[],this.run(o,s)}};_Storymatic.imports.output={nowait:function(r,a,n,t,o,s){_Storymatic.write(this.parseText(r),()=>{this.run(o,s)})},image:function(r,a,n,t,o,s){_Storymatic.image(this.parseText(r),()=>this.run(o,s))},typewrite:function(r,a,n,t,o,s){var u;(u=r.match(/^([0-9]+(?:\.[0-9]+)?) +(.+)$/))?_Storymatic.type(this.parseText(u[2]),1e3*+u[1],()=>this.run(o,s)):(u=r.match(/^\$([A-Za-z_][A-Za-z0-9_]*) +(.+)$/))?_Storymatic.type(this.parseText(u[2]),1e3*+this.getVariable(u[1]),()=>this.run(o,s)):this.run(o,s)},typewrite_ms:function(r,a,n,t,o,s){var u;(u=r.match(/^([0-9]+(?:\.[0-9]+)?) +(.+)$/))?_Storymatic.type(this.parseText(u[2],+u[1],()=>this.run(o,s))):(u=r.match(/^\$([A-Za-z_][A-Za-z0-9_]*) +(.+)$/))?_Storymatic.type(this.parseText(u[2],+this.getVariable(u[1]),()=>this.run(o,s))):this.run(o,s)},line:function(r,a,n,t,o,s){_Storymatic.line(()=>this.run(o,s))},clear:function(r,a,n,t,o,s){_Storymatic.clear(()=>this.run(o,s))},center:function(r,a,n,t,o,s){_Storymatic.center(this.parseText(r),()=>{this.run(o,s)})},tooltip:function(r,a,n,t,o,s){_Storymatic.tooltip(this.parseText(r),()=>{this.run(o,s)})}};_Storymatic.imports.control={if:function(r,a,n,t,o,s){if(r.replace(/\s/g,"")=="")return this.run(u,s);if(n.replace(/\s+/g,"")=="")return this.run(u,s);for(var u=JSON.parse(JSON.stringify(o)),m=[{action:"command",name:"if",arg:r,expr:a,code:n,parsed:t}];u.length>0&&u[0].action=="command"&&(u[0].name=="elseif"||u[0].name=="else")&&!(u[0].name=="elseif"&&u[0].arg.replace(/\s/g,"")==""||u[0].name=="else"&&u[0].arg.replace(/\s/g,"")!=""||(m.push(u.shift()),m[m.length-1].name=="else"));)if(u.length>0&&u[0].action=="command"){if(u[0].name!="elseif"&&u[0].name!="else")break}else break;for(var l=0;l<m.length;l++){if((m[l].name=="if"||m[l].name=="elseif")&&this.is(m[l].expr))return this.run(JSON.parse(JSON.stringify(m[l].parsed)),()=>this.run(u,s));if(m[l].name=="else")return this.run(JSON.parse(JSON.stringify(m[l].parsed)),()=>this.run(u,s))}this.run(u,s)},context:function(r,a,n,t,o,s){if(n.replace(/\s+/g,"")=="")return this.run(o,s);this.context(u=>{var m=r.match(/\$([A-Za-z_][A-Za-z0-9_]*)/g);Array.isArray(m)?m=m.map(l=>l.substr(1)):m=[],u.runParsed(t,()=>{for(var l=0;l<m.length;l++)m[l]in u.variables&&(this.variables[m[l]]=JSON.parse(JSON.stringify(u.variables[m[l]])));this.run(o,s)})})},repeat:function(r,a,n,t,o,s){var u=0,m=+this.calc(a);if(r.replace(/\s/g,"")=="")return this.run(o,s);if(n.replace(/\s/g,"")=="")return this.run(o,s);if(!m)return this.run(o,s);var l=()=>{if(++u>m)return this.run(o,s);this.run(JSON.parse(JSON.stringify(t)),l)};l()},while:function(r,a,n,t,o,s){if(r.replace(/\s/g,"")=="")return this.run(o,s);if(n.replace(/\s/g,"")=="")return this.run(o,s);var u=()=>{this.is(a)?this.run(JSON.parse(JSON.stringify(t)),u):this.run(o,s)};u()},for:function(r,a,n,t,o,s){if(n.replace(/\s+/g,"")=="")return this.run(o,s);if(r=r.split(/;/g).map(m=>m.trim()),r.length!=3)return this.run(o,s);var u=()=>{if(this.is(r[1]))this.run(JSON.parse(JSON.stringify(t)),()=>{this.runCode(r[2],u)});else return this.run(o,s)};this.runCode(r[0],u)},step:function(r,a,n,t,o,s){if(n.replace(/\s+/g,"")=="")return this.run(o,s);var u=/\$([A-Za-z_][A-Za-z0-9_]*) +(-?[0-9]+(?:\.[0-9]+)?) +(-?[0-9]+(?:\.[0-9]+)?)(?: +([0-9](?:\.[0-9]+)?))?/,m=r.match(u);if(!m)return this.run(o,s);var l=m[1],h=+m[2],f=+m[3],p=+m[4]||1;if(h>f){var d=f;f=h,h=d}var g=()=>{this.setVariable(l,h),this.run(JSON.parse(JSON.stringify(t)),()=>(h+=p,h>f?this.run(o,s):g()))};g()},run:function(r,a,n,t,o,s){var u;(u=r.match(/^\$([A-Za-z_][A-Za-z0-9_]*)$/))?this.runCode(this.getVariable(u[1]),()=>this.run(o,s)):this.run(o,s)},switch:function(r,a,n,t,o,s){for(var u=this.parseText(r),m=0;m<t.length;m++)if(t[m].action=="command"){if(t[m].name=="case"&&this.parseText(t[m].arg)==u)return this.run(t[m].parsed,()=>this.run(o,s));if(t[m].name=="default")return this.run(t[m].parsed,()=>this.run(o,s))}this.run(o,s)}};_Storymatic.imports.string={parse:function(r,a,n,t,o,s){var u=/^\$([A-Za-z_][A-Za-z0-9_]*)$/,m;if(m=r.match(u)){var l=`${this.getVariable(m[1])}`;this.setVariable(m[1],this.parseText(l)),this.run(o,s)}else this.run(o,s)},newline:function(r,a,n,t,o,s){var u=/^\$([A-Za-z_][A-Za-z0-9_]*)$/,m=r.match(u);if(!m)return this.run(o,s);this.setVariable(m[1],this.getVariable(m[1])+`
`),this.run(o,s)},empty:function(r,a,n,t,o,s){var u=/^\$([A-Za-z_][A-Za-z0-9_]*)$/,m=r.match(u);if(!m)return this.run(o,s);this.setVariable(m[1],""),this.run(o,s)},substr:function(r,a,n,t,o,s){var u=/^\$([A-Za-z_][A-Za-z0-9_]*) +(-?[0-9]+)(?: +(-?[0-9]+))?$/,m;if(m=r.match(u)){var l=`${this.getVariable(m[1])}`,h=+m[2]>0?+m[2]-1:+m[2],f=+m[3]||void 0;this.setVariable(m[1],l.substr(h,f)),this.run(o,s)}else this.run(o,s)},substring:function(r,a,n,t,o,s){var u=/^\$([A-Za-z_][A-Za-z0-9_]*) +(-?[0-9]+)(?: +(-?[0-9]+))?$/,m;if(m=r.match(u)){var l=`${this.getVariable(m[1])}`,h=+m[2]>0?+m[2]-1:+m[2];m[3]&&(+m[3]>0?+m[3]-1:+m[3]),this.setVariable(m[1],l.substring(h,length)),this.run(o,s)}else this.run(o,s)},char:function(r,a,n,t,o,s){var u=/^\$([A-Za-z_][A-Za-z0-9_]*) +(-?[0-9]+)$/,m;if(m=r.match(u)){var l=`${this.getVariable(m[1])}`,h=+m[2]>0?+m[2]-1:+m[2];this.setVariable(m[1],l.charAt(h)),this.run(o,s)}else this.run(o,s)},switch_char:function(r,a,n,t,o,s){var u=/^\$([A-Za-z_][A-Za-z0-9_]*) +(-?[0-9]+)$/,m;if(m=r.match(u)){var l=`${this.getVariable(m[1])}`,h=+m[2]>0?+m[2]-1:+m[2];l=l.charAt(h)}else this.run(o,s);for(var f=0;f<t.length;f++)if(t[f].action=="command"){if(t[f].name=="case"&&this.parseText(t[f].arg)==l)return this.run(t[f].parsed,()=>this.run(o,s));if(t[f].name=="default")return this.run(t[f].parsed,()=>this.run(o,s))}this.run(o,s)},lowercase:function(r,a,n,t,o,s){var u=/^\$([A-Za-z_][A-Za-z0-9_]*)$/,m=r.match(u);if(!m)return this.run(o,s);this.setVariable(m[1],`${this.getVariable(m[1])}`.toLowerCase()),this.run(o,s)},uppercase:function(r,a,n,t,o,s){var u=/^\$([A-Za-z_][A-Za-z0-9_]*)$/,m=r.match(u);if(!m)return this.run(o,s);this.setVariable(m[1],`${this.getVariable(m[1])}`.toUpperCase()),this.run(o,s)},replace:function(r,a,n,t,o,s){var u=/^\$([A-Za-z_][A-Za-z0-9_]*) +\/((?:[^\/]|\\\/)+)\/([gimsuy]{0,6}) +?(.*)$/,m=r.match(u);if(!m)return this.run(o,s);var l=`${this.getVariable(m[1])}`,h=new RegExp(m[2],m[3]),f=m[4];this.setVariable(m[1],l.replace(h,f)),this.run(o,s)}};_Storymatic.imports.number={randint:function(r,a,n,t,o,s){var u=/^\$([A-Za-z_][A-Za-z0-9_]*) +(-?[0-9]+) +(-?[0-9]+)$/,m=r.match(u);if(!m)return this.run(o,s);var l=+m[2],h=+m[3];if(l>h){var f=l+0;l=h,h=f}this.setVariable(m[1],Math.floor((h-l+1)*Math.random())+l),this.run(o,s)},floor:function(r,a,n,t,o,s){var u=/^\$([A-Za-z_][A-Za-z0-9_]*)$/,m=r.match(u);if(!m)return this.run(o,s);this.setVariable(m[1],Math.floor(+this.getvariable(m[1]))),this.run(o,s)},ceil:function(r,a,n,t,o,s){var u=/^\$([A-Za-z_][A-Za-z0-9_]*)$/,m=r.match(u);if(!m)return this.run(o,s);this.setVariable(m[1],Math.ceil(+this.getvariable(m[1]))),this.run(o,s)}};_Storymatic.imports.sync={exists:function(r,a,n,t,o,s){var u=r.match(/^\$([A-Za-z_][A-Za-z0-9_]*)$/);if(u&&n.replace(/\s+/g,"")!=""){var n=new URL(window.location.href).searchParams.get("code"),m=`storymatic_${n}_${u[1]}`;actions.getLocal(m,h=>{typeof h[m]=="string"?this.run(t,()=>this.run(o,s)):o.length>0&&o[0].action=="command"&&o[0].name=="else"?this.run(o[0].parsed,()=>this.run(o.filter((f,p)=>p>0),s)):this.run(o,s)})}else this.run(o,s)},load:function(r,a,n,t,o,s){var u;if(u=r.match(/^\$([A-Za-z_][A-Za-z0-9_]*) +(.+)$/)){var n=new URL(window.location.href).searchParams.get("code"),m=`storymatic_${n}_${u[1]}`;actions.getLocal(m,h=>{typeof h[m]=="string"?(this.setVariable(u[1],h[m]),this.run(o,s)):(this.setVariable(u[1],this.parseText(u[2])),this.run(o,s))})}else this.run(o,s)},save:function(r,a,n,t,o,s){var u;if(u=r.match(/^\$([A-Za-z_][A-Za-z0-9_]*)$/)){var n=new URL(window.location.href).searchParams.get("code"),m=`storymatic_${n}_${u[1]}`,l={};l[m]=`${this.getVariable(u[1])}`,actions.setLocal(l,()=>{this.run(o,s)})}else this.run(o,s)},reset:function(r,a,n,t,o,s){var u;if(u=r.match(/^\$([A-Za-z_][A-Za-z0-9_]*)$/)){var n=new URL(window.location.href).searchParams.get("code"),m=`storymatic_${n}_${u[1]}`,l={};l[m]=null,actions.setLocal(l,()=>this.run(o,s))}else this.run(o,s)}};const actions={};actions.getLocal=function(r,a){var n={};if(typeof r=="object"&&r.length===0){for(var t=0;t<localStorage.length;t++){var o=localStorage.key(t);o.slice(0,6)=="local-"&&(n[o.slice(6)]=localStorage.getItem(o))}return n}typeof r=="string"&&(r=[r]);for(var t=0;t<r.length;t++)n[r[t]]=actions.storage.get("local-"+r[t])["local-"+r[t]];a(n)};actions.setLocal=function(r,a){var n={};for(var t in r)n["local-"+t]=r[t];actions.storage.set(n),typeof a=="function"&&a("")};const _sfc_main$1=defineComponent({__name:"Viewer2",props:{code:null},setup(r){const a=r,{console:n,field:t,messages:o,onKey:s,onSelect:u,onSubmit:m,placeholder:l}=useCompleteConsole();return _Storymatic.tooltip=(h,f)=>{l.value=h,f==null||f()},_Storymatic.write=(h,f)=>{n.log(h),f==null||f()},_Storymatic.print=(h,f)=>{_Storymatic.write(h,()=>{_Storymatic.tooltip("Press Enter to continue...",()=>{_Storymatic.waitFor("Enter",!0,()=>{_Storymatic.tooltip("",f)})})})},_Storymatic.image=(h,f)=>{const p=new Image;p.src=h,n.log(p),f==null||f()},_Storymatic.line=h=>{n.log(document.createElement("hr")),h==null||h()},_Storymatic.clear=h=>{n.clear(),h==null||h()},_Storymatic.type=(h,f,p)=>{let d=0;const g=document.createElement("p");if(h.length>0){const c=setInterval(()=>{g.textContent+=h[d++]||"",d>=h.length&&(clearInterval(c),p==null||p())},f/h.length/1e3)}else p==null||p();n.log(g)},_Storymatic.input=async(h,f)=>{const p=await n.prompt(h,!0);f==null||f(p)},_Storymatic.choice=async(h,f,p)=>{const d=await n.select(h,$({},f));p==null||p(f[d])},_Storymatic.waitFor=async(h,f,p)=>{Object.assign(window,{c:n}),f?n.key(h).then(()=>p==null?void 0:p(h)):n.bindKey(h,()=>p==null?void 0:p(h))},useNavLink({title:"Execute",onEnter:!0,action(){n.clear(),new _Storymatic(a.code,h=>{_Storymatic.waitingFor.splice(0,_Storymatic.waitingFor.length),_Storymatic.tooltip("",()=>{_Storymatic.clear(()=>{h.start()})})})}}),(h,f)=>(openBlock(),createBlock(Console,{field:unref(t),"onUpdate:field":f[0]||(f[0]=p=>isRef(t)?t.value=p:null),messages:unref(o),"onUpdate:messages":f[1]||(f[1]=p=>isRef(o)?o.value=p:null),placeholder:unref(l),onKey:unref(s),onSelect:unref(u),onSubmit:unref(m)},null,8,["field","messages","placeholder","onKey","onSelect","onSubmit"]))}});var v2_vue_vue_type_style_index_0_scoped_true_lang=(()=>`.viewer[data-v-d804a772]{width:min(400px,100%)}@media screen and (max-width: 850px){.stack.stack[data-v-d804a772]{flex-direction:column}.viewer[data-v-d804a772]{width:100%}}
`)();const _sfc_main=defineComponent({__name:"v2",setup(r){const a=useLocationHash();return(n,t)=>(openBlock(),createBlock(DocumentDisplay,{center:"","explicit-height":"","max-width":""},{default:withCtx(()=>[createVNode(HStack,{class:"stack",space:.75,style:{height:"100%","justify-content":"center"}},{default:withCtx(()=>[createVNode(_sfc_main$2,{modelValue:unref(a),"onUpdate:modelValue":t[0]||(t[0]=o=>isRef(a)?a.value=o:null),round:"",style:{flex:"1","max-width":"800px"}},null,8,["modelValue"]),createVNode(_sfc_main$1,{class:"viewer",code:unref(a)},null,8,["code"])]),_:1},8,["space"])]),_:1}))}});var v2=_export_sfc(_sfc_main,[["__scopeId","data-v-d804a772"]]);export{v2 as default};

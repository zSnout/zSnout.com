var L=Object.defineProperty,W=Object.defineProperties;var k=Object.getOwnPropertyDescriptors;var P=Object.getOwnPropertySymbols;var p=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var M=(e,n,t)=>n in e?L(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,O=(e,n)=>{for(var t in n||(n={}))p.call(n,t)&&M(e,t,n[t]);if(P)for(var t of P(n))A.call(n,t)&&M(e,t,n[t]);return e},Y=(e,n)=>W(e,k(n));import{ad as f,f as a,ak as j,m as S,a9 as q,aw as F,ax as z,ay as G,ap as T,aq as R,ae as V}from"./index.c530de8c.js";import{u as Z}from"./useWebGL.5f638c4c.js";function D(e,n,t,u,r){return f(()=>(a(r)-a(e))*(a(u)-a(t))/(a(n)-a(e))+a(t))}function h(e,n,t){const u=j(),r=D(0,u.width,0,1,t.x),i=D(u.height,0,0,1,t.y);return{x:f(()=>r.value*n.x.value+e.x.value),y:f(()=>i.value*n.y.value+e.y.value)}}function $(e,n){const t=j();e=H(e,n);const u=f(()=>{const r=a(e.xStart),i=a(e.xEnd),l=a(e.yStart),x=a(e.yEnd);return t.width.value>t.height.value?{x:(r-(i-r)/2)/2,y:l}:{x:r,y:(l-(x-l)/2)/2}});return{offset:{x:f(()=>u.value.x),y:f(()=>u.value.y)},scale:{x:f(()=>a(e.xEnd)-a(e.xStart)),y:f(()=>a(e.yEnd)-a(e.yStart))}}}function _(e){return f(()=>[a(e.x),a(e.y)])}function H(e,n){const t=f(()=>{const{xStart:u,xEnd:r,yStart:i,yEnd:l}=e,x=a(u)+a(r),d=a(i)+a(l),v=(a(r)-a(u))/2,c=(a(l)-a(i))/2;let{width:{value:s},height:{value:y}}=n;return(Number.isNaN(s)||s===0)&&(s=y),(Number.isNaN(y)||y===0)&&(y=s),(Number.isNaN(s)||s===0)&&(s=y=1),s<y?{xStart:u,xEnd:r,yStart:d-y/s*c,yEnd:d+y/s*c}:{xStart:x-s/y*v,xEnd:x+s/y*v,yStart:i,yEnd:l}});return{xStart:f(()=>a(t.value.xStart)),xEnd:f(()=>a(t.value.xEnd)),yStart:f(()=>a(t.value.yStart)),yEnd:f(()=>a(t.value.yEnd))}}const b=`
struct Bounds {
  float xStart;
  float xEnd;
  float yStart;
  float yEnd;
};

struct Coordinates {
  float x;
  float y;
};
`,J=`
in vec2 _pos;
out vec2 pos;

uniform vec2 offset;
uniform vec2 scale;

void main() {
  gl_Position = vec4(_pos, 0, 1);
  pos = _pos * scale + offset;
}`;async function K(e,n,t){var x,d,v,c,s,y,g,m,N;const u={xStart:S((d=(x=t==null?void 0:t.bounds)==null?void 0:x.xStart)!=null?d:-2),xEnd:S((c=(v=t==null?void 0:t.bounds)==null?void 0:v.xEnd)!=null?c:2),yStart:S((y=(s=t==null?void 0:t.bounds)==null?void 0:s.yStart)!=null?y:-2),yEnd:S((m=(g=t==null?void 0:t.bounds)==null?void 0:g.yEnd)!=null?m:2)},r=await Z(e,b+n,Y(O({},t),{vertShader:b+((N=t==null?void 0:t.vertShader)!=null?N:J)})),{offset:i,scale:l}=$(u,r.size);if(r.useUniform("offset","f",_(i)),r.useUniform("scale","f",_(l)),(t==null?void 0:t.uniforms)===!0){r.useUniform("bounds.xStart","f",u.xStart),r.useUniform("bounds.xEnd","f",u.xEnd),r.useUniform("bounds.yStart","f",u.yStart),r.useUniform("bounds.yEnd","f",u.yEnd);const E=q(),o=h(i,l,E);r.useUniform("pointer.x","f",o.x),r.useUniform("pointer.y","f",o.y)}return Object.assign(r,{bounds:u,offset:i,scale:l})}const U=F("history");function Q(e,n){return U[e]===void 0&&n!==void 0&&(U[e]=n),z({get(){return""+U[e]},set(t){U[e]=t}})}function tt(e,n){const t=Q(e,""+n);return z({get(){return parseFloat(t.value)},set(u){t.value=""+u}})}function et(e,n){const t=tt(e,n.value);n.value=t.value;const u=G(t,n,{direction:"rtl"});return T(u),u}function at(e,n=1e7){return z({get(){return~~(n*e.value)/n},set(t){e.value=t}})}function X(e,n,t){return{xStart:f(()=>a(e.xStart)+a(t)*(a(n.x)-a(e.xStart))/10),xEnd:f(()=>a(e.xEnd)+a(t)*(a(n.x)-a(e.xEnd))/10),yStart:f(()=>a(e.yStart)+a(t)*(a(n.y)-a(e.yStart))/10),yEnd:f(()=>a(e.yEnd)+a(t)*(a(n.y)-a(e.yEnd))/10)}}async function ot(e,n,t){const u=await K(e,n,t),{canvas:r,bounds:i,offset:l,onDispose:x,scale:d,useUniform:v}=u,c=q(),s={x:S(NaN),y:S(NaN)},y=S(0),g=X(i,h(l,d,c),y);if((t==null?void 0:t.uniforms)===!0){const o=X(i,h(l,d,c),1);v("zoomRegion.xStart","f",o.xStart),v("zoomRegion.xEnd","f",o.xEnd),v("zoomRegion.yStart","f",o.yStart),v("zoomRegion.yEnd","f",o.yEnd)}x(R(r,"wheel",o=>{o.preventDefault(),c.x.value=o.offsetX,c.y.value=o.offsetY,y.value=Math.sqrt(Math.abs(o.deltaY))*-Math.sign(o.deltaY)/10;const{xStart:{value:w},xEnd:{value:C},yStart:{value:B},yEnd:{value:I}}=g;i.xStart.value=w,i.xEnd.value=C,i.yStart.value=B,i.yEnd.value=I},{passive:!1}));const m=h(l,d,c),N=h(l,d,s);x(R(r,"pointermove",o=>{if(o.preventDefault(),Number.isNaN(s.x.value)||Number.isNaN(s.y.value))return;c.x.value=o.offsetX,c.y.value=o.offsetY;const w=m.x.value-N.x.value,C=m.y.value-N.y.value;i.xStart.value-=w,i.xEnd.value-=w,i.yStart.value-=C,i.yEnd.value-=C,s.x.value=c.x.value,s.y.value=c.y.value})),x(R(r,"pointerdown",o=>{r.setPointerCapture(o.pointerId),s.x.value=o.offsetX,s.y.value=o.offsetY})),x(R("pointerup",o=>{r.releasePointerCapture(o.pointerId),s.x.value=NaN,s.y.value=NaN}));function E(o){x(et(o,at(V(i,o))))}return E("xStart"),E("xEnd"),E("yStart"),E("yEnd"),u}export{ot as u};

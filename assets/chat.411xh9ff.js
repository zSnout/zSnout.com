import{y as ue,z as x,c as f,C as ie,A as M,s as v,d as N,B as de,M as G,D as re}from"./main.200onzgm.js";import{B as y}from"./VStack.3evi6szx.js";import{D as ce}from"./DocumentDisplay.6d0yf2eg.js";import{D as me}from"./Dropdown.5phpgqpn.js";import{F as R}from"./Field.5c7fkv56.js";import{_ as fe,M as q,H as $,S as P,T as ve}from"./BookmarkIcon.46krkaf8.js";import{I as J}from"./InlineButton.12vhnjwt.js";import{I as pe}from"./InlineField.sq5fmr9m.js";import{a as X}from"./_plugin-vue_export-helper.4yxwi37t.js";import{x as u,y as r,z as _e,l as he,r as p,j as Q,h as ye,d as ke,F as a,D as l,u as d,G as U,E as F,H as n,C as K,a9 as k,I as S,ah as W,v as ge,ad as Ce,ae as be}from"./runtime-core.esm-bundler.47vl3tei.js";import{S as we}from"./StickyTopRegion.54a7rjac.js";import"./Navigation.vue_vue_type_script_setup_true_lang.4wr1p5fg.js";import"./Logo.vue_vue_type_script_setup_true_lang.2nyidlx8.js";import"./LogoLight.3fmf1259.js";import"./SharedNav.4z4l3m5g.js";const xe={},Me={class:"sticky"};function Se(V,c){return u(),r("div",Me,[_e(V.$slots,"default",{},void 0,!0)])}const Ve=X(xe,[["render",Se],["__scopeId","data-v-b70addb1"]]),H=V=>(Ce("data-v-7da3bd78"),V=V(),be(),V),De={key:0},Oe={key:1},Ie={key:2},$e={style:{flex:"1"}},Ue={key:5},Le={class:"normalize"},ze={key:0,class:"name"},Be=["onContextmenu"],Te={class:"second-layer"},Ee={key:0,class:"second-layer"},Ne=H(()=>k("option",{value:"view"},"Viewer",-1)),Fe=H(()=>k("option",{value:"comment"},"Commenter",-1)),He=H(()=>k("option",{value:"manage"},"Manager",-1)),Re={class:"second-layer trash-div"},qe=H(()=>k("p",null,"Edit your message below, then click OK to send it.",-1)),Ke=he({__name:"chat",setup(V){const c=p(),s=""+ue().query.id,L=p(!1),z=p(!1),D=p(""),_=Q([]),h=p("waiting"),b=p("Loading title...");x("chat:message:delete",(o,e)=>{if(o===s){const i=_.findIndex(({id:t})=>t===e);i!==-1&&_.splice(i,1)}}),x("chat:message:list",(o,e)=>{o===s&&(_.splice(0,_.length,...e),setTimeout(()=>scrollTo(0,1e6)))}),x("chat:message:update",(o,e)=>{if(o===s){let i;e.from===M.value?i=_.find(t=>t.localOnly===e.content):i=_.find(t=>t.id===e.id),i?(i.content=e.content,i.from=e.from,i.id=e.id,i.timestamp=e.timestamp,delete i.localOnly):_.push(e),document.body.scrollHeight-window.innerHeight+8>=scrollY&&setTimeout(()=>scrollTo(0,1e6))}}),x("chat:update:title",(o,e)=>{o===s&&(b.value=e,document.title=`${b.value} | zSnout`)}),x("chat:permission",(o,e)=>{o===s&&(h.value=e)}),ye(()=>{f.emit("chat:watch:start",v.value,s)}),x("connect",()=>{f.emit("chat:watch:start",v.value,s)}),ke(()=>f.emit("chat:watch:stop",s));function j(o){var e;o==null||o.preventDefault(),D.value&&(f.emit("chat:message:send",v.value,s,D.value),_.push({from:M.value,content:"Sending your message...",id:((e=window.crypto)==null?void 0:e.randomUUID())||"",timestamp:Date.now(),localOnly:D.value.slice(0,1e3)}),D.value="")}function A(o){c.value=o,L.value=!0}function Z(){L.value=!1,c.value&&f.emit("chat:message:delete",v.value,s,c.value.id)}const B=p(!1),I=p("");function ee(){c.value&&c.value.from===M.value&&(B.value=!0,I.value=c.value.content)}function te(){c.value&&(B.value=!1,c.value.content=I.value,f.emit("chat:message:update",v.value,s,c.value.id,I.value))}const T=p(!1),g=Q(Object.create(null));x("chat:update:members",(o,e)=>{if(o===s){for(const i in g)delete g[i];Object.assign(g,e)}});function ae(){h.value==="manage"&&(w.splice(0,w.length),f.emit("chat:request:members",v.value,s),T.value=!0)}const w=[];function le(){if(h.value==="manage"){for(const o of w)f.emit("chat:message:send",v.value,s,o);w.splice(0,w.length),f.emit("chat:update:members",v.value,s,g)}}const O=p("");function Y(o){o==null||o.preventDefault(),O.value&&(g[O.value]="comment",w.push(`(added ${O.value})`),O.value="")}function oe(o){w.push(`(removed ${o})`),delete g[o]}const E=p(!1);function ne(){E.value=!0}function se(){E.value=!1,f.emit("chat:leave",v.value,s),re.push("/my-chats")}return(o,e)=>{var i;return u(),r(U,null,[a(ce,{center:"","no-footer":""},{default:l(()=>[a(we,{class:"normalize"},{default:l(()=>[d(N)?F("",!0):(u(),r("p",De," Looks like you're temporarily offline. zSnout is reconnecting... ")),d(v)?h.value==="none"?(u(),r("p",Ie," Looks like you don't have permission to access this chat! ")):d(N)&&h.value==="manage"?(u(),K($,{key:3,wraps:""},{default:l(()=>[a(pe,{maxlength:100,"model-value":b.value,style:{flex:"1"},"onUpdate:modelValue":e[2]||(e[2]=t=>d(f).emit("chat:update:title",d(v),s,b.value=t))},null,8,["model-value"]),a(y,{pre:"",style:{"font-size":"1rem"},onClick:ae},{default:l(()=>[n(" Edit Members ")]),_:1})]),_:1})):d(N)?(u(),K($,{key:4,wraps:""},{default:l(()=>[k("p",$e,S(b.value),1),a(y,{pre:"",style:{"font-size":"1rem"},onClick:ne},{default:l(()=>[n(" Leave this Chat ")]),_:1})]),_:1})):d(N)?(u(),r("p",Ue,S(b.value),1)):F("",!0):(u(),r("p",Oe,[n(" You're not logged in. "),a(J,{onClick:e[0]||(e[0]=t=>z.value=!0)},{default:l(()=>[n("Log in")]),_:1}),n(" or "),a(J,{onClick:e[1]||(e[1]=t=>z.value=!0)},{default:l(()=>[n("sign up")]),_:1}),n(" to access this chat. ")]))]),_:1}),k("div",Le,[(u(!0),r(U,null,W(_,(t,m)=>(u(),r(U,{key:t.id},[m===0||_[m-1].from!==t.from?(u(),r("div",ze,S(t.from)+": ",1)):F("",!0),ge((u(),r("div",{onContextmenu:C=>(C.preventDefault(),A(t)),onMousedown:e[3]||(e[3]=C=>C.preventDefault())},[n(S(t.content),1)],40,Be)),[[d(de),C=>(C.preventDefault(),A(t))]])],64))),128))]),a(P,null,{default:l(()=>[n(S(""))]),_:1}),a(Ve,{class:"normalize"},{default:l(()=>[h.value==="manage"||h.value==="comment"?(u(),r("form",{key:0,style:{"font-size":"1rem"},onSubmit:j},[a($,null,{default:l(()=>[a(R,{modelValue:D.value,"onUpdate:modelValue":e[4]||(e[4]=t=>D.value=t),maxlength:1e3,placeholder:"Send a message...",style:{flex:"1"}},null,8,["modelValue"]),a(y,{onClick:j},{default:l(()=>[n("Send")]),_:1})]),_:1})],32)):F("",!0)]),_:1})]),_:1}),a(fe,{open:z.value,"onUpdate:open":e[5]||(e[5]=t=>z.value=t)},null,8,["open"]),a(ie,{open:L.value,"onUpdate:open":e[6]||(e[6]=t=>L.value=t)},{default:l(()=>{var t,m;return[a(G,{disabled:((t=c.value)==null?void 0:t.from)!==d(M),onClick:Z},{default:l(()=>[n(" Delete Message ")]),_:1},8,["disabled"]),a(G,{disabled:((m=c.value)==null?void 0:m.from)!==d(M),onClick:ee},{default:l(()=>[n(" Edit Message ")]),_:1},8,["disabled"])]}),_:1},8,["open"]),a(q,{open:h.value==="manage"&&T.value},{buttons:l(()=>[a(y,{onClick:e[8]||(e[8]=t=>(le(),T.value=!1))},{default:l(()=>[n("OK")]),_:1}),a(y,{cancel:"",onClick:e[9]||(e[9]=t=>(d(f).emit("chat:request:members",d(v),s),T.value=!1))},{default:l(()=>[n(" Cancel ")]),_:1})]),default:l(()=>[k("form",{onSubmit:Y},[a($,null,{default:l(()=>[a(R,{modelValue:O.value,"onUpdate:modelValue":e[7]||(e[7]=t=>O.value=t),placeholder:"Type someone's username..."},null,8,["modelValue"]),a(y,{pre:"",onClick:Y},{default:l(()=>[n("Add Member")]),_:1})]),_:1})],32),(u(!0),r(U,null,W(g,(t,m)=>(u(),K($,{key:m,class:"member"},{default:l(()=>[k("div",Te,S(m),1),a(P),m===d(M)?(u(),r("div",Ee,"Not Removable")):(u(),r(U,{key:1},[a(me,{modelValue:g[m],"onUpdate:modelValue":C=>g[m]=C,class:"level"},{default:l(()=>[Ne,Fe,He]),_:2},1032,["modelValue","onUpdate:modelValue"]),k("div",Re,[a(ve,{class:"trash",onClick:C=>oe(m)},null,8,["onClick"])])],64))]),_:2},1024))),128))]),_:1},8,["open"]),a(q,{open:(h.value==="view"||h.value==="comment")&&E.value},{buttons:l(()=>[a(y,{cancel:"",onClick:e[10]||(e[10]=t=>E.value=!1)},{default:l(()=>[n("Cancel")]),_:1}),a(y,{onClick:se},{default:l(()=>[n("OK")]),_:1})]),default:l(()=>[k("p",null," Are you sure you want to leave "+S(b.value)+"? You can always contact the chat owner to be re-added. ",1)]),_:1},8,["open"]),a(q,{open:((i=c.value)==null?void 0:i.from)===d(M)&&B.value},{buttons:l(()=>[a(y,{onClick:te},{default:l(()=>[n("OK")]),_:1}),a(y,{cancel:"",onClick:e[12]||(e[12]=t=>B.value=!1)},{default:l(()=>[n("Cancel")]),_:1})]),default:l(()=>[qe,a(R,{modelValue:I.value,"onUpdate:modelValue":e[11]||(e[11]=t=>I.value=t),maxlength:1e3},null,8,["modelValue"])]),_:1},8,["open"])],64)}}});const nt=X(Ke,[["__scopeId","data-v-7da3bd78"]]);export{nt as default};

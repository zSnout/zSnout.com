var S=Object.defineProperty;var d=(y,x,e)=>x in y?S(y,x,{enumerable:!0,configurable:!0,writable:!0,value:e}):y[x]=e;var f=(y,x,e)=>(d(y,typeof x!="symbol"?x+"":x,e),e);import{W as E}from"./WebGlCanvas.648f6b8a.js";import{p as n}from"./useOption.b58c60f3.js";import{s as l}from"./index.a2eb2e49.js";class C extends E{constructor(e,{bounds:t,fragmentString:r,saveBounds:s,...i}={}){var a,h,c,o;super(e,{...i,fragmentString:r});f(this,"saveBounds");f(this,"navTimer",!0);f(this,"bounds");this.saveBounds=s!=null?s:!1,s&&(t={xStart:Number.isFinite(+n.xStart)?+n.xStart:-2,xEnd:Number.isFinite(+n.xEnd)?+n.xEnd:2,yStart:Number.isFinite(+n.yStart)?+n.yStart:-2,yEnd:Number.isFinite(+n.yEnd)?+n.yEnd:2}),this.setBounds({xStart:(a=t==null?void 0:t.xStart)!=null?a:-2,xEnd:(h=t==null?void 0:t.xEnd)!=null?h:2,yStart:(c=t==null?void 0:t.yStart)!=null?c:-2,yEnd:(o=t==null?void 0:t.yEnd)!=null?o:2}),l(this.canvas,()=>this.setBounds(this.bounds))}getNormalizedBounds(){let{xStart:e,xEnd:t,yStart:r,yEnd:s}=this.bounds;const i=e+t,a=r+s,h=(t-e)/2,c=(s-r)/2,{width:o,height:m}=this.canvas;return o>m?(e=i-o/m*h,t=i+o/m*h):(r=a-m/o*c,s=a+m/o*c),{xStart:e,xEnd:t,yStart:r,yEnd:s}}getAdjusters(){const{width:e,height:t}=this.canvas,{xStart:r,xEnd:s,yStart:i,yEnd:a}=this.getNormalizedBounds();return e>t?{scale:{x:s-r,y:a-i},offset:{x:(r-(s-r)/2)/2,y:i}}:{scale:{x:s-r,y:a-i},offset:{x:r,y:(i-(a-i)/2)/2}}}setBounds(e){const{xStart:t,xEnd:r,yStart:s,yEnd:i}=this.bounds=e;this.saveBounds&&this.navTimer&&(n.xStart=""+t,n.xEnd=""+r,n.yStart=""+s,n.yEnd=""+i,this.navTimer=!1,setTimeout(()=>this.navTimer=!0,1e3));const{offset:a,scale:h}=this.getAdjusters();this.setUniform("u_offset",a.x,a.y),this.setUniform("u_scale",h.x,h.y)}pxToCoords(e,t){const{offset:r,scale:s}=this.getAdjusters();return{x:e/this.canvas.clientWidth*s.x+r.x,y:(1-t/this.canvas.clientHeight)*s.y+r.y}}mouseToCoords(){return this.pxToCoords(this.mouse.x,this.canvas.clientHeight-this.mouse.y)}}export{C};

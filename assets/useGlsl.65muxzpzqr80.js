const o={"+":2,"-":2,"*":3,"#":3,"/":3,"**":4,"^":5,"^2":5,"^3":5};function u(p){return p==="("?0:o[p]||1}const m={"+":"l","-":"l","*":"l","#":"l","/":"l"};function $(p){return m[p]||"r"}const g=["+","-","*","#","/","^","("];function n(p){return!g.includes(p)}function z(p){p=p.toLowerCase();const f=[];let s=!1;for(;;){let l;if(p.length===0)break;p[0]==="$"||p[0]==="@"?p=p.slice(1):(l=p.match(/^\d+(?:\.\d+)?/))||!s&&(l=p.match(/^-\d+(?:\.\d+)?/))?(s&&f.push("**"),s=!0,f.push(+l[0]),p=p.slice(l[0].length)):(l=p.match(/^(sin|cos|tan|exp|log|abs|min|max)/))?(s&&f.push("**"),s=!1,f.push(l[0]),p=p.slice(l[0].length)):(l=p.match(/^(pi|pz|ppz|sz|e|i|c|z|m|t|fx|fy)/))?(s&&f.push("**"),s=!0,f.push(l[0]),p=p.slice(l[0].length)):(l=p.match(/^\.[xy]/))||(l=p.match(/^\^[23]/))?(s=!0,f.push(l[0]),p=p.slice(l[0].length)):((l=p.match(/^[-+*#\/^()]/))&&(s&&l[0]==="("&&f.push("**"),s=!1,l[0]===")"&&(s=!0),f.push(l[0])),p=p.slice(1))}const e=[],c=[];let t;for(;t=f.shift();)if(typeof t=="number"||t.match(/^(pi|pz|ppz|sz|e|i|c|z|fx|fy)$/))e.push(t);else if(t.match(/^\.[xy]$/))e.push(t);else if(t===")"){for(;c[c.length-1]!=="(";){const h=c[c.length-1];if(!h)return["z"];c.pop(),e.push(h)}if(c.pop()!=="(")return["z"];const l=c[c.length-1];if(!l)continue;n(l)&&(c.pop(),e.push(l))}else if(t==="("||n(t))c.push(t);else{const l=t;let h;for(;(h=c[c.length-1])&&h!=="(";){const i=u(l),r=u(h);if(!(r>i||i===r&&$(l)==="l"))break;e.push((c.pop(),h))}c.push(l)}for(;t=c.pop();){if(t==="("||t===")")return["z"];e.push(t)}return e}function v(p){var f;try{const s=[];for(let e of p)if(typeof e=="number")s.push(`vec2(${e}, 0)`);else if(e==="i")s.push("vec2(0, 1)");else if(e==="pi")s.push("vec2(3.141592653589793, 0)");else if(e==="e")s.push("vec2(2.718281828459045, 0)");else if(e==="t")s.push("vec2(time, 0)");else if(e==="m")s.push("mouse");else if(e==="fx")s.push("vec2(1, -1)");else if(e==="fy")s.push("vec2(-1, 1)");else if(e.match(/^(pz|ppz|sz|c|z)$/))s.push(e);else if(e==="+"||e==="-"||e==="#"){const c=s.pop(),t=(f=s.pop())!=null?f:"";s.push(`${t} ${e==="#"?"*":e} ${c}`)}else if(e==="^2")s.push(`sqr(${s.pop()})`);else if(e==="^3")s.push(`cube(${s.pop()})`);else if(e==="*"||e==="**"||e==="/"||e==="^"||e==="min"||e==="max"){e==="/"?e="div":e==="^"?e="cx_pow":(e==="*"||e==="**")&&(e="mult");const c=s.pop(),t=s.pop();s.push(`${e}(${t}, ${c})`)}else e==="abs"?s.push(`abs(${s.pop()})`):e==="sin"||e==="cos"||e==="tan"||e==="exp"||e==="log"?s.push(`cx_${e}(${s.pop()})`):(e===".x"||e===".y")&&s.push(`vec2((${s.pop()})${e}, 0)`);return s.length!==1?"z":s[0]}catch{return"z"}}function x(p){return v(z(p))}Object.assign(window,{glsl:x});export{x as g};

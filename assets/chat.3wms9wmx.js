import{_ as j,o as u,h as d,r as Z,d as ie,q as v,a7 as de,I as G,a8 as S,v as ce,a9 as re,H as m,b as o,w as a,aa as fe,u as r,F as O,ab as M,s as _,K as N,j as R,c as F,a as k,t as V,E as J,ac as me,ad as _e,e as s,ae as Q,af as ve,p as pe,l as he}from"./index.4yzzgtk3.js";import{B as y}from"./VStack.6d7g92uw.js";import{D as ye}from"./DocumentDisplay.1u3n8z7b.js";import{D as ke}from"./Dropdown.5andrccq.js";import{_ as ge,M as H,H as U,S as W,F as K,T as be}from"./BookmarkIcon.108uetaj.js";import{I as X}from"./InlineButton.197m3pe8.js";import{I as Ce}from"./InlineField.1bs7kao1.js";import"./Navigation.3ml0eptj.js";import"./Logo.vue_vue_type_script_setup_true_lang.4ks050nj.js";import"./LogoLight.539ztpd2.js";import"./SharedNav.3yzrssnp.js";const we={},xe={class:"sticky"};function Se(b,c){return u(),d("div",xe,[Z(b.$slots,"default",{},void 0,!0)])}const Me=j(we,[["render",Se],["__scopeId","data-v-b70addb1"]]);const Ve={},$e={class:"sticky"};function De(b,c){return u(),d("div",$e,[Z(b.$slots,"default",{},void 0,!0)])}const Ie=j(Ve,[["render",De],["__scopeId","data-v-b6bfcac1"]]),q=b=>(pe("data-v-d6dafe5e"),b=b(),he(),b),Oe={key:0},Ue={key:1},Le=s(" You're not logged in. "),Te=s("Log in"),Be=s(" or "),Ee=s("sign up"),ze=s(" to access this chat. "),Ne={key:2},Re=s(" Edit Members "),qe={style:{flex:"1"}},Fe=s(" Leave this Chat "),He={key:5},Ke={class:"normalize"},je={key:0,class:"name"},Ye=["onContextmenu"],Ae=s(V("")),Pe=s("Send"),Ge=s(" Delete Message "),Je=s(" Edit Message "),Qe=s("Add Member"),We={class:"second-layer"},Xe={key:0,class:"second-layer"},Ze=q(()=>k("option",{value:"view"},"Viewer",-1)),et=q(()=>k("option",{value:"comment"},"Commenter",-1)),tt=q(()=>k("option",{value:"manage"},"Manager",-1)),ot={class:"second-layer trash-div"},at=s("OK"),nt=s(" Cancel "),st=s("Cancel"),lt=s("OK"),ut=q(()=>k("p",null,"Edit your message below, then click OK to send it.",-1)),it=s("OK"),dt=s("Cancel"),ct=ie({__name:"chat",setup(b){const c=v(),l=""+de().query.id,L=v(!1),T=v(!1),$=v(""),p=G([]),h=v("waiting"),w=v("Loading title...");S("chat:message:delete",(n,e)=>{if(n===l){const i=p.findIndex(({id:t})=>t===e);i!==-1&&p.splice(i,1)}}),S("chat:message:list",(n,e)=>{n===l&&(p.splice(0,p.length,...e),setTimeout(()=>scrollTo(0,1e6)))}),S("chat:message:update",(n,e)=>{if(n===l){let i;e.from===M.value?i=p.find(t=>t.localOnly===e.content):i=p.find(t=>t.id===e.id),i?(i.content=e.content,i.from=e.from,i.id=e.id,i.timestamp=e.timestamp,delete i.localOnly):p.push(e),document.body.scrollHeight-window.innerHeight+8>=scrollY&&setTimeout(()=>scrollTo(0,1e6))}}),S("chat:update:title",(n,e)=>{n===l&&(w.value=e,document.title=`${w.value} | zSnout`)}),S("chat:permission",(n,e)=>{n===l&&(h.value=e)}),ce(()=>{m.emit("chat:watch:start",_.value,l)}),S("connect",()=>{m.emit("chat:watch:start",_.value,l)}),re(()=>m.emit("chat:watch:stop",l));function Y(n){var e;n==null||n.preventDefault(),$.value&&(m.emit("chat:message:send",_.value,l,$.value),p.push({from:M.value,content:"Sending your message...",id:((e=window.crypto)==null?void 0:e.randomUUID())||"",timestamp:Date.now(),localOnly:$.value.slice(0,1e3)}),$.value="")}function A(n){c.value=n,L.value=!0}function ee(){L.value=!1,c.value&&m.emit("chat:message:delete",_.value,l,c.value.id)}const B=v(!1),I=v("");function te(){c.value&&c.value.from===M.value&&(B.value=!0,I.value=c.value.content)}function oe(){c.value&&(B.value=!1,c.value.content=I.value,m.emit("chat:message:update",_.value,l,c.value.id,I.value))}const E=v(!1),g=G(Object.create(null));S("chat:update:members",(n,e)=>{if(n===l){for(let i in g)delete g[i];Object.assign(g,e)}});function ae(){h.value==="manage"&&(x.splice(0,x.length),m.emit("chat:request:members",_.value,l),E.value=!0)}const x=[];function ne(){if(h.value==="manage"){for(const n of x)m.emit("chat:message:send",_.value,l,n);x.splice(0,x.length),m.emit("chat:update:members",_.value,l,g)}}const D=v("");function P(n){n==null||n.preventDefault(),D.value&&(g[D.value]="comment",x.push(`(added ${D.value})`),D.value="")}function se(n){x.push(`(removed ${n})`),delete g[n]}const z=v(!1);function le(){z.value=!0}function ue(){z.value=!1,m.emit("chat:leave",_.value,l),ve.push("/my-chats")}return(n,e)=>{var i;return u(),d(O,null,[o(ye,{center:"","no-footer":""},{default:a(()=>[o(Ie,{class:"normalize"},{default:a(()=>[r(N)?R("",!0):(u(),d("p",Oe," Looks like you're temporarily offline. zSnout is reconnecting... ")),r(_)?h.value==="none"?(u(),d("p",Ne," Looks like you don't have permission to access this chat! ")):r(N)&&h.value==="manage"?(u(),F(U,{key:3,wraps:""},{default:a(()=>[o(Ce,{maxlength:100,"model-value":w.value,style:{flex:"1"},"onUpdate:modelValue":e[2]||(e[2]=t=>r(m).emit("chat:update:title",r(_),l,w.value=t))},null,8,["model-value"]),o(y,{pre:"",style:{"font-size":"1rem"},onClick:ae},{default:a(()=>[Re]),_:1})]),_:1})):r(N)?(u(),F(U,{key:4,wraps:""},{default:a(()=>[k("p",qe,V(w.value),1),o(y,{pre:"",style:{"font-size":"1rem"},onClick:le},{default:a(()=>[Fe]),_:1})]),_:1})):r(N)?(u(),d("p",He,V(w.value),1)):R("",!0):(u(),d("p",Ue,[Le,o(X,{onClick:e[0]||(e[0]=t=>T.value=!0)},{default:a(()=>[Te]),_:1}),Be,o(X,{onClick:e[1]||(e[1]=t=>T.value=!0)},{default:a(()=>[Ee]),_:1}),ze]))]),_:1}),k("div",Ke,[(u(!0),d(O,null,J(p,(t,f)=>(u(),d(O,{key:t.id},[f===0||p[f-1].from!==t.from?(u(),d("div",je,V(t.from)+": ",1)):R("",!0),me((u(),d("div",{onContextmenu:C=>(C.preventDefault(),A(t)),onMousedown:e[3]||(e[3]=C=>C.preventDefault())},[s(V(t.content),1)],40,Ye)),[[r(_e),C=>(C.preventDefault(),A(t))]])],64))),128))]),o(W,null,{default:a(()=>[Ae]),_:1}),o(Me,{class:"normalize"},{default:a(()=>[h.value==="manage"||h.value==="comment"?(u(),d("form",{key:0,style:{"font-size":"1rem"},onSubmit:Y},[o(U,null,{default:a(()=>[o(K,{modelValue:$.value,"onUpdate:modelValue":e[4]||(e[4]=t=>$.value=t),maxlength:1e3,placeholder:"Send a message...",style:{flex:"1"}},null,8,["modelValue"]),o(y,{onClick:Y},{default:a(()=>[Pe]),_:1})]),_:1})],32)):R("",!0)]),_:1})]),_:1}),o(ge,{open:T.value,"onUpdate:open":e[5]||(e[5]=t=>T.value=t)},null,8,["open"]),o(fe,{open:L.value,"onUpdate:open":e[6]||(e[6]=t=>L.value=t)},{default:a(()=>{var t,f;return[o(Q,{disabled:((t=c.value)==null?void 0:t.from)!==r(M),onClick:ee},{default:a(()=>[Ge]),_:1},8,["disabled"]),o(Q,{disabled:((f=c.value)==null?void 0:f.from)!==r(M),onClick:te},{default:a(()=>[Je]),_:1},8,["disabled"])]}),_:1},8,["open"]),o(H,{open:h.value==="manage"&&E.value},{buttons:a(()=>[o(y,{onClick:e[8]||(e[8]=t=>(ne(),E.value=!1))},{default:a(()=>[at]),_:1}),o(y,{cancel:"",onClick:e[9]||(e[9]=t=>(r(m).emit("chat:request:members",r(_),l),E.value=!1))},{default:a(()=>[nt]),_:1})]),default:a(()=>[k("form",{onSubmit:P},[o(U,null,{default:a(()=>[o(K,{modelValue:D.value,"onUpdate:modelValue":e[7]||(e[7]=t=>D.value=t),placeholder:"Type someone's username..."},null,8,["modelValue"]),o(y,{pre:"",onClick:P},{default:a(()=>[Qe]),_:1})]),_:1})],32),(u(!0),d(O,null,J(g,(t,f)=>(u(),F(U,{key:f,class:"member"},{default:a(()=>[k("div",We,V(f),1),o(W),f===r(M)?(u(),d("div",Xe,"Not Removable")):(u(),d(O,{key:1},[o(ke,{modelValue:g[f],"onUpdate:modelValue":C=>g[f]=C,class:"level"},{default:a(()=>[Ze,et,tt]),_:2},1032,["modelValue","onUpdate:modelValue"]),k("div",ot,[o(be,{class:"trash",onClick:C=>se(f)},null,8,["onClick"])])],64))]),_:2},1024))),128))]),_:1},8,["open"]),o(H,{open:(h.value==="view"||h.value==="comment")&&z.value},{buttons:a(()=>[o(y,{cancel:"",onClick:e[10]||(e[10]=t=>z.value=!1)},{default:a(()=>[st]),_:1}),o(y,{onClick:ue},{default:a(()=>[lt]),_:1})]),default:a(()=>[k("p",null," Are you sure you want to leave "+V(w.value)+"? You can always contact the chat owner to be re-added. ",1)]),_:1},8,["open"]),o(H,{open:((i=c.value)==null?void 0:i.from)===r(M)&&B.value},{buttons:a(()=>[o(y,{onClick:oe},{default:a(()=>[it]),_:1}),o(y,{cancel:"",onClick:e[12]||(e[12]=t=>B.value=!1)},{default:a(()=>[dt]),_:1})]),default:a(()=>[ut,o(K,{modelValue:I.value,"onUpdate:modelValue":e[11]||(e[11]=t=>I.value=t),maxlength:1e3},null,8,["modelValue"])]),_:1},8,["open"])],64)}}});const Ct=j(ct,[["__scopeId","data-v-d6dafe5e"]]);export{Ct as default};

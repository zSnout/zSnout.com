import{d as Br,q as je,aM as wn,aA as Ln,o as Ee,h as Oe,c as Nn,w as ae,n as An,a as ce,b as fe,aB as Lr,e as ye,t as Nr,u as Ar,F as Dr}from"./index.722e2749.js";import{_ as Gr}from"./plugin-vue_export-helper.21dcd24c.js";import{D as Dn}from"./DocumentDisplay.1eff68e1.js";import{I as Me}from"./InlineButton.481a6abc.js";import{s as er}from"./useShuffle.2103acf2.js";import"./Navigation.4e77c3c5.js";import"./SharedNav.d290b78b.js";import"./Button.bd51d884.js";import"./Logo.ac20dcd2.js";import"./LogoLight.546f93a8.js";const jn="pnbrqkPNBRQK",rr="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",xn=["1-0","0-1","1/2-1/2","*"],nr={b:[16,32,17,15],w:[-16,-32,-17,-15]},jr={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},Tn=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],Cn=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],Pn={p:0,n:1,b:2,r:3,q:4,k:5},S={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},kn=7,En=6,zn=1,Zn=0,x={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},me={w:[{square:x.a1,flag:S.QSIDE_CASTLE},{square:x.h1,flag:S.KSIDE_CASTLE}],b:[{square:x.a8,flag:S.QSIDE_CASTLE},{square:x.h8,flag:S.KSIDE_CASTLE}]},_n=0,xr=1;function Un(e,r){for(var n=e.from,t=e.to,i=e.piece,a=0,u=0,f=0,I=0,g=r.length;I<g;I++){var h=r[I].from,m=r[I].to,_=r[I].piece;i===_&&n!==h&&t===m&&(a++,Se(n)===Se(h)&&u++,Be(n)===Be(h)&&f++)}return a>0?u>0&&f>0?Q(n):f>0?Q(n).charAt(1):Q(n).charAt(0):""}function Rn(e){var r=e.charAt(0);if(r>="a"&&r<="h"){var n=e.match(/[a-h]\d.*[a-h]\d/);return n?void 0:le}return r=r.toLowerCase(),r==="o"?ze:r}function Tr(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function Se(e){return e>>4}function Be(e){return e&15}function Q(e){var r=Be(e),n=Se(e);return"abcdefgh".substring(r,r+1)+"87654321".substring(n,n+1)}function Re(e){return e===ue?he:ue}function Hn(e){return"0123456789".indexOf(e)!==-1}function Qr(e){var r=e instanceof Array?[]:{};for(var n in e)typeof n=="object"?r[n]=Qr(e[n]):r[n]=e[n];return r}function Cr(e){return e.replace(/^\s+|\s+$/g,"")}const he="b",ue="w",ee=-1,le="p",Pr="n",qe="b",Wn="r",On="q",ze="k";(function(){for(var e=[],r=x.a8;r<=x.h1;r++){if(r&136){r+=7;continue}e.push(Q(r))}return e})();const Bn={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},Gn=function(e){var r=new Array(128),n={w:ee,b:ee},t=ue,i={w:0,b:0},a=ee,u=0,f=1,I=[],g={},h={};L(typeof e=="undefined"?rr:e);function m(o){typeof o=="undefined"&&(o=!1),r=new Array(128),n={w:ee,b:ee},t=ue,i={w:0,b:0},a=ee,u=0,f=1,I=[],o||(g={}),h={},R(k())}function _(){for(var o=[],c={},l=function(s){s in h&&(c[s]=h[s])};I.length>0;)o.push(Ie());for(l(k());o.length>0;)de(o.pop()),l(k());h=c}function q(){L(rr)}function L(o,c){typeof c=="undefined"&&(c=!1);var l=o.split(/\s+/),s=l[0],p=0;if(!N(o).valid)return!1;m(c);for(var d=0;d<s.length;d++){var b=s.charAt(d);if(b==="/")p+=8;else if(Hn(b))p+=parseInt(b,10);else{var A=b<"a"?ue:he;te({type:b.toLowerCase(),color:A},Q(p)),p++}}return t=l[1],l[2].indexOf("K")>-1&&(i.w|=S.KSIDE_CASTLE),l[2].indexOf("Q")>-1&&(i.w|=S.QSIDE_CASTLE),l[2].indexOf("k")>-1&&(i.b|=S.KSIDE_CASTLE),l[2].indexOf("q")>-1&&(i.b|=S.QSIDE_CASTLE),a=l[3]==="-"?ee:x[l[3]],u=parseInt(l[4],10),f=parseInt(l[5],10),R(k()),!0}function N(o){var c={0:"No errors.",1:"FEN string must contain six space-delimited fields.",2:"6th field (move number) must be a positive integer.",3:"5th field (half move counter) must be a non-negative integer.",4:"4th field (en-passant square) is invalid.",5:"3rd field (castling availability) is invalid.",6:"2nd field (side to move) is invalid.",7:"1st field (piece positions) does not contain 8 '/'-delimited rows.",8:"1st field (piece positions) is invalid [consecutive numbers].",9:"1st field (piece positions) is invalid [invalid piece].",10:"1st field (piece positions) is invalid [row too large].",11:"Illegal en-passant square"},l=o.split(/\s+/);if(l.length!==6)return{valid:!1,error_number:1,error:c[1]};if(isNaN(parseInt(l[5]))||parseInt(l[5],10)<=0)return{valid:!1,error_number:2,error:c[2]};if(isNaN(parseInt(l[4]))||parseInt(l[4],10)<0)return{valid:!1,error_number:3,error:c[3]};if(!/^(-|[abcdefgh][36])$/.test(l[3]))return{valid:!1,error_number:4,error:c[4]};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(l[2]))return{valid:!1,error_number:5,error:c[5]};if(!/^(w|b)$/.test(l[1]))return{valid:!1,error_number:6,error:c[6]};var s=l[0].split("/");if(s.length!==8)return{valid:!1,error_number:7,error:c[7]};for(var p=0;p<s.length;p++){for(var d=0,b=!1,A=0;A<s[p].length;A++)if(isNaN(s[p][A])){if(!/^[prnbqkPRNBQK]$/.test(s[p][A]))return{valid:!1,error_number:9,error:c[9]};d+=1,b=!1}else{if(b)return{valid:!1,error_number:8,error:c[8]};d+=parseInt(s[p][A],10),b=!0}if(d!==8)return{valid:!1,error_number:10,error:c[10]}}return l[3][1]=="3"&&l[1]=="w"||l[3][1]=="6"&&l[1]=="b"?{valid:!1,error_number:11,error:c[11]}:{valid:!0,error_number:0,error:c[0]}}function k(){for(var o=0,c="",l=x.a8;l<=x.h1;l++){if(r[l]==null)o++;else{o>0&&(c+=o,o=0);var s=r[l].color,p=r[l].type;c+=s===ue?p.toUpperCase():p.toLowerCase()}l+1&136&&(o>0&&(c+=o),l!==x.h1&&(c+="/"),o=0,l+=8)}var d="";i[ue]&S.KSIDE_CASTLE&&(d+="K"),i[ue]&S.QSIDE_CASTLE&&(d+="Q"),i[he]&S.KSIDE_CASTLE&&(d+="k"),i[he]&S.QSIDE_CASTLE&&(d+="q"),d=d||"-";var b=a===ee?"-":Q(a);return[c,t,d,b,u,f].join(" ")}function J(o){for(var c=0;c<o.length;c+=2)typeof o[c]=="string"&&typeof o[c+1]=="string"&&(g[o[c]]=o[c+1]);return g}function R(o){I.length>0||(o!==rr?(g.SetUp="1",g.FEN=o):(delete g.SetUp,delete g.FEN))}function ne(o){var c=r[x[o]];return c?{type:c.type,color:c.color}:null}function te(o,c){if(!("type"in o&&"color"in o)||jn.indexOf(o.type.toLowerCase())===-1||!(c in x))return!1;var l=x[c];return o.type==ze&&!(n[o.color]==ee||n[o.color]==l)?!1:(r[l]={type:o.type,color:o.color},o.type===ze&&(n[o.color]=l),R(k()),!0)}function G(o){var c=ne(o);return r[x[o]]=null,c&&c.type===ze&&(n[c.color]=ee),R(k()),c}function K(o,c,l,s,p){var d={color:t,from:c,to:l,flags:s,piece:o[c].type};return p&&(d.flags|=S.PROMOTION,d.promotion=p),o[l]?d.captured=o[l].type:s&S.EP_CAPTURE&&(d.captured=le),d}function H(o){function c(oe,Ze,z,B,ke){if(oe[z].type===le&&(Se(B)===Zn||Se(B)===kn))for(var _e=[On,Wn,qe,Pr],De=0,Ue=_e.length;De<Ue;De++)Ze.push(K(oe,z,B,ke,_e[De]));else Ze.push(K(oe,z,B,ke))}var l=[],s=t,p=Re(s),d={b:zn,w:En},b=x.a8,A=x.h1,T=!1,E=typeof o!="undefined"&&"legal"in o?o.legal:!0,W=typeof o!="undefined"&&"piece"in o&&typeof o.piece=="string"?o.piece.toLowerCase():!0;if(typeof o!="undefined"&&"square"in o)if(o.square in x)b=A=x[o.square],T=!0;else return[];for(var w=b;w<=A;w++){if(w&136){w+=7;continue}var P=r[w];if(!(P==null||P.color!==s)){if(P.type===le&&(W===!0||W===le)){var j=w+nr[s][0];if(r[j]==null){c(r,l,w,j,S.NORMAL);var j=w+nr[s][1];d[s]===Se(w)&&r[j]==null&&c(r,l,w,j,S.BIG_PAWN)}for(C=2;C<4;C++){var j=w+nr[s][C];j&136||(r[j]!=null&&r[j].color===p?c(r,l,w,j,S.CAPTURE):j===a&&c(r,l,w,a,S.EP_CAPTURE))}}else if(W===!0||W===P.type)for(var C=0,U=jr[P.type].length;C<U;C++)for(var X=jr[P.type][C],j=w;j+=X,!(j&136);){if(r[j]==null)c(r,l,w,j,S.NORMAL);else{if(r[j].color===s)break;c(r,l,w,j,S.CAPTURE);break}if(P.type==="n"||P.type==="k")break}}}if((W===!0||W===ze)&&(!T||A===n[s])){if(i[s]&S.KSIDE_CASTLE){var O=n[s],ie=O+2;r[O+1]==null&&r[ie]==null&&!y(p,n[s])&&!y(p,O+1)&&!y(p,ie)&&c(r,l,n[s],ie,S.KSIDE_CASTLE)}if(i[s]&S.QSIDE_CASTLE){var O=n[s],ie=O-2;r[O-1]==null&&r[O-2]==null&&r[O-3]==null&&!y(p,n[s])&&!y(p,O-1)&&!y(p,ie)&&c(r,l,n[s],ie,S.QSIDE_CASTLE)}}if(!E)return l;for(var Ae=[],w=0,U=l.length;w<U;w++)de(l[w]),v(s)||Ae.push(l[w]),Ie();return Ae}function M(o,c){var l="";if(o.flags&S.KSIDE_CASTLE)l="O-O";else if(o.flags&S.QSIDE_CASTLE)l="O-O-O";else{if(o.piece!==le){var s=Un(o,c);l+=o.piece.toUpperCase()+s}o.flags&(S.CAPTURE|S.EP_CAPTURE)&&(o.piece===le&&(l+=Q(o.from)[0]),l+="x"),l+=Q(o.to),o.flags&S.PROMOTION&&(l+="="+o.promotion.toUpperCase())}return de(o),D()&&(pe()?l+="#":l+="+"),Ie(),l}function y(o,c){for(var l=x.a8;l<=x.h1;l++){if(l&136){l+=7;continue}if(!(r[l]==null||r[l].color!==o)){var s=r[l],p=l-c,d=p+119;if(Tn[d]&1<<Pn[s.type]){if(s.type===le){if(p>0){if(s.color===ue)return!0}else if(s.color===he)return!0;continue}if(s.type==="n"||s.type==="k")return!0;for(var b=Cn[d],A=l+b,T=!1;A!==c;){if(r[A]!=null){T=!0;break}A+=b}if(!T)return!0}}}return!1}function v(o){return y(Re(o),n[o])}function D(){return v(t)}function pe(){return D()&&H().length===0}function Fe(){return!D()&&H().length===0}function $e(){for(var o={},c=[],l=0,s=0,p=x.a8;p<=x.h1;p++){if(s=(s+1)%2,p&136){p+=7;continue}var d=r[p];d&&(o[d.type]=d.type in o?o[d.type]+1:1,d.type===qe&&c.push(s),l++)}if(l===2)return!0;if(l===3&&(o[qe]===1||o[Pr]===1))return!0;if(l===o[qe]+2){for(var b=0,A=c.length,p=0;p<A;p++)b+=c[p];if(b===0||b===A)return!0}return!1}function Xe(){for(var o=[],c={},l=!1;;){var s=Ie();if(!s)break;o.push(s)}for(;;){var p=k().split(" ").slice(0,4).join(" ");if(c[p]=p in c?c[p]+1:1,c[p]>=3&&(l=!0),!o.length)break;de(o.pop())}return l}function yn(o){I.push({move:o,kings:{b:n.b,w:n.w},turn:t,castling:{b:i.b,w:i.w},ep_square:a,half_moves:u,move_number:f})}function de(o){var c=t,l=Re(c);if(yn(o),r[o.to]=r[o.from],r[o.from]=null,o.flags&S.EP_CAPTURE&&(t===he?r[o.to-16]=null:r[o.to+16]=null),o.flags&S.PROMOTION&&(r[o.to]={type:o.promotion,color:c}),r[o.to].type===ze){if(n[r[o.to].color]=o.to,o.flags&S.KSIDE_CASTLE){var s=o.to-1,p=o.to+1;r[s]=r[p],r[p]=null}else if(o.flags&S.QSIDE_CASTLE){var s=o.to+1,p=o.to-2;r[s]=r[p],r[p]=null}i[c]=""}if(i[c]){for(var d=0,b=me[c].length;d<b;d++)if(o.from===me[c][d].square&&i[c]&me[c][d].flag){i[c]^=me[c][d].flag;break}}if(i[l]){for(var d=0,b=me[l].length;d<b;d++)if(o.to===me[l][d].square&&i[l]&me[l][d].flag){i[l]^=me[l][d].flag;break}}o.flags&S.BIG_PAWN?t==="b"?a=o.to-16:a=o.to+16:a=ee,o.piece===le||o.flags&(S.CAPTURE|S.EP_CAPTURE)?u=0:u++,t===he&&f++,t=Re(t)}function Ie(){var o=I.pop();if(o==null)return null;var c=o.move;n=o.kings,t=o.turn,i=o.castling,a=o.ep_square,u=o.half_moves,f=o.move_number;var l=t,s=Re(t);if(r[c.from]=r[c.to],r[c.from].type=c.piece,r[c.to]=null,c.flags&S.CAPTURE)r[c.to]={type:c.captured,color:s};else if(c.flags&S.EP_CAPTURE){var p;l===he?p=c.to-16:p=c.to+16,r[p]={type:le,color:s}}if(c.flags&(S.KSIDE_CASTLE|S.QSIDE_CASTLE)){var d,b;c.flags&S.KSIDE_CASTLE?(d=c.to+1,b=c.to-1):c.flags&S.QSIDE_CASTLE&&(d=c.to-2,b=c.to+1),r[d]=r[b],r[b]=null}return c}function br(o,c){for(var l=Tr(o),s=0;s<2;s++){if(s==xr){if(!c)return null;var p=!1,d=l.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/);if(d){var b=d[1],A=d[2],T=d[3],E=d[4];A.length==1&&(p=!0)}else{var d=l.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/);if(d){var b=d[1],A=d[2],T=d[3],E=d[4];if(A.length==1)var p=!0}}}for(var W=Rn(l),w=H({legal:!0,piece:b||W}),P=0,j=w.length;P<j;P++)switch(s){case _n:{if(l===Tr(M(w[P],w)))return w[P];break}case xr:if(d){if((!b||b.toLowerCase()==w[P].piece)&&x[A]==w[P].from&&x[T]==w[P].to&&(!E||E.toLowerCase()==w[P].promotion))return w[P];if(p){var C=Q(w[P].from);if((!b||b.toLowerCase()==w[P].piece)&&x[T]==w[P].to&&(A==C[0]||A==C[1])&&(!E||E.toLowerCase()==w[P].promotion))return w[P]}}}}return null}function Ye(o){var c=Qr(o);c.san=M(c,H({legal:!0})),c.to=Q(c.to),c.from=Q(c.from);var l="";for(var s in S)S[s]&c.flags&&(l+=Bn[s]);return c.flags=l,c}function Sr(o){for(var c=H({legal:!1}),l=0,s=t,p=0,d=c.length;p<d;p++){if(de(c[p]),!v(s))if(o-1>0){var b=Sr(o-1);l+=b}else l++;Ie()}return l}return{load:function(o){return L(o)},reset:function(){return q()},moves:function(o){for(var c=H(o),l=[],s=0,p=c.length;s<p;s++)typeof o!="undefined"&&"verbose"in o&&o.verbose?l.push(Ye(c[s])):l.push(M(c[s],H({legal:!0})));return l},in_check:function(){return D()},in_checkmate:function(){return pe()},in_stalemate:function(){return Fe()},in_draw:function(){return u>=100||Fe()||$e()||Xe()},insufficient_material:function(){return $e()},in_threefold_repetition:function(){return Xe()},game_over:function(){return u>=100||pe()||Fe()||$e()||Xe()},validate_fen:function(o){return N(o)},fen:function(){return k()},board:function(){for(var o=[],c=[],l=x.a8;l<=x.h1;l++)r[l]==null?c.push(null):c.push({square:Q(l),type:r[l].type,color:r[l].color}),l+1&136&&(o.push(c),c=[],l+=8);return o},pgn:function(o){var c=typeof o=="object"&&typeof o.newline_char=="string"?o.newline_char:`
`,l=typeof o=="object"&&typeof o.max_width=="number"?o.max_width:0,s=[],p=!1;for(var d in g)s.push("["+d+' "'+g[d]+'"]'+c),p=!0;p&&I.length&&s.push(c);for(var b=function(C){var U=h[k()];if(typeof U!="undefined"){var X=C.length>0?" ":"";C=`${C}${X}{${U}}`}return C},A=[];I.length>0;)A.push(Ie());var T=[],E="";for(A.length===0&&T.push(b(""));A.length>0;){E=b(E);var W=A.pop();if(!I.length&&W.color==="b"){const C=`${f}. ...`;E=E?`${E} ${C}`:C}else W.color==="w"&&(E.length&&T.push(E),E=f+".");E=E+" "+M(W,H({legal:!0})),de(W)}if(E.length&&T.push(b(E)),typeof g.Result!="undefined"&&T.push(g.Result),l===0)return s.join("")+T.join(" ");for(var w=function(){return s.length>0&&s[s.length-1]===" "?(s.pop(),!0):!1},P=function(C,U){for(var X of U.split(" "))if(!!X){if(C+X.length>l){for(;w();)C--;s.push(c),C=0}s.push(X),C+=X.length,s.push(" "),C++}return w()&&C--,C},j=0,d=0;d<T.length;d++){if(j+T[d].length>l&&T[d].includes("{")){j=P(j,T[d]);continue}j+T[d].length>l&&d!==0?(s[s.length-1]===" "&&s.pop(),s.push(c),j=0):d!==0&&(s.push(" "),j++),s.push(T[d]),j+=T[d].length}return s.join("")},load_pgn:function(o,c){var l=typeof c!="undefined"&&"sloppy"in c?c.sloppy:!1;function s(z){return z.replace(/\\/g,"\\")}function p(z,B){for(var ke=typeof B=="object"&&typeof B.newline_char=="string"?B.newline_char:`\r?
`,_e={},De=z.split(new RegExp(s(ke))),Ue="",yr="",Ve=0;Ve<De.length;Ve++){var wr=/^\s*\[([A-Za-z]+)\s*"(.*)"\s*\]\s*$/;Ue=De[Ve].replace(wr,"$1"),yr=De[Ve].replace(wr,"$2"),Cr(Ue).length>0&&(_e[Ue]=yr)}return _e}o=o.trim();var d=typeof c=="object"&&typeof c.newline_char=="string"?c.newline_char:`\r?
`,b=new RegExp("^(\\[((?:"+s(d)+")|.)*\\])(?:\\s*"+s(d)+"){2}"),A=b.test(o)?b.exec(o)[1]:"";q();var T=p(A,c),E="";for(var W in T)W.toLowerCase()==="fen"&&(E=T[W]),J([W,T[W]]);if(l){if(E&&!L(E,!0))return!1}else if(T.SetUp==="1"&&!("FEN"in T&&L(T.FEN,!0)))return!1;for(var w=function(z){return Array.from(z).map(function(B){return B.charCodeAt(0)<128?B.charCodeAt(0).toString(16):encodeURIComponent(B).replace(/\%/g,"").toLowerCase()}).join("")},P=function(z){return z.length==0?"":decodeURIComponent("%"+z.match(/.{1,2}/g).join("%"))},j=function(z){return z=z.replace(new RegExp(s(d),"g")," "),`{${w(z.slice(1,z.length-1))}}`},C=function(z){if(z.startsWith("{")&&z.endsWith("}"))return P(z.slice(1,z.length-1))},U=o.replace(A,"").replace(new RegExp(`({[^}]*})+?|;([^${s(d)}]*)`,"g"),function(z,B,ke){return B!==void 0?j(B):" "+j(`{${ke.slice(1)}}`)}).replace(new RegExp(s(d),"g")," "),X=/(\([^\(\)]+\))+?/g;X.test(U);)U=U.replace(X,"");U=U.replace(/\d+\.(\.\.)?/g,""),U=U.replace(/\.\.\./g,""),U=U.replace(/\$\d+/g,"");var O=Cr(U).split(new RegExp(/\s+/));O=O.join(",").replace(/,,+/g,",").split(",");for(var ie="",Ae="",oe=0;oe<O.length;oe++){var Ze=C(O[oe]);if(Ze!==void 0){h[k()]=Ze;continue}if(ie=br(O[oe],l),ie==null)if(xn.indexOf(O[oe])>-1)Ae=O[oe];else return!1;else Ae="",de(ie)}return Ae&&Object.keys(g).length&&!g.Result&&J(["Result",Ae]),!0},header:function(){return J(arguments)},turn:function(){return t},move:function(o,c){var l=typeof c!="undefined"&&"sloppy"in c?c.sloppy:!1,s=null;if(typeof o=="string")s=br(o,l);else if(typeof o=="object"){for(var p=H(),d=0,b=p.length;d<b;d++)if(o.from===Q(p[d].from)&&o.to===Q(p[d].to)&&(!("promotion"in p[d])||o.promotion===p[d].promotion)){s=p[d];break}}if(!s)return null;var A=Ye(s);return de(s),A},undo:function(){var o=Ie();return o?Ye(o):null},clear:function(){return m()},put:function(o,c){return te(o,c)},get:function(o){return ne(o)},ascii(){for(var o=`   +------------------------+
`,c=x.a8;c<=x.h1;c++){if(Be(c)===0&&(o+=" "+"87654321"[Se(c)]+" |"),r[c]==null)o+=" . ";else{var l=r[c].type,s=r[c].color,p=s===ue?l.toUpperCase():l.toLowerCase();o+=" "+p+" "}c+1&136&&(o+=`|
`,c+=8)}return o+=`   +------------------------+
`,o+="     a  b  c  d  e  f  g  h",o},remove:function(o){return G(o)},perft:function(o){return Sr(o)},square_color:function(o){if(o in x){var c=x[o];return(Se(c)+Be(c))%2===0?"light":"dark"}return null},history:function(o){for(var c=[],l=[],s=typeof o!="undefined"&&("verbose"in o)&&o.verbose;I.length>0;)c.push(Ie());for(;c.length>0;){var p=c.pop();s?l.push(Ye(p)):l.push(M(p,H({legal:!0}))),de(p)}return l},get_comment:function(){return h[k()]},set_comment:function(o){h[k()]=o.replace("{","[").replace("}","]")},delete_comment:function(){var o=h[k()];return delete h[k()],o},get_comments:function(){return _(),Object.keys(h).map(function(o){return{fen:o,comment:h[o]}})},delete_comments:function(){return _(),Object.keys(h).map(function(o){var c=h[o];return delete h[o],{fen:o,comment:c}})}}},Qn=["white","black"],ur=["a","b","c","d","e","f","g","h"],sr=["1","2","3","4","5","6","7","8"],Yn=[...sr].reverse(),dr=Array.prototype.concat(...ur.map(e=>sr.map(r=>e+r))),F=e=>dr[8*e[0]+e[1]],Z=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],Yr=dr.map(Z);function Vn(e){let r;const n=()=>(r===void 0&&(r=e()),r);return n.clear=()=>{r=void 0},n}const qn=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const r=performance.now()-e;return e=void 0,r}}},fr=e=>e==="white"?"black":"white",Ge=(e,r)=>{const n=e[0]-r[0],t=e[1]-r[1];return n*n+t*t},ar=(e,r)=>e.role===r.role&&e.color===r.color,Qe=e=>(r,n)=>[(n?r[0]:7-r[0])*e.width/8,(n?7-r[1]:r[1])*e.height/8],se=(e,r)=>{e.style.transform=`translate(${r[0]}px,${r[1]}px)`},Vr=(e,r,n=1)=>{e.style.transform=`translate(${r[0]}px,${r[1]}px) scale(${n})`},gr=(e,r)=>{e.style.visibility=r?"visible":"hidden"},Ce=e=>{var r;if(e.clientX||e.clientX===0)return[e.clientX,e.clientY];if(!((r=e.targetTouches)===null||r===void 0)&&r[0])return[e.targetTouches[0].clientX,e.targetTouches[0].clientY]},qr=e=>e.buttons===2||e.button===2,ge=(e,r)=>{const n=document.createElement(e);return r&&(n.className=r),n};function Jr(e,r,n){const t=Z(e);return r||(t[0]=7-t[0],t[1]=7-t[1]),[n.left+n.width*t[0]/8+n.width/16,n.top+n.height*(7-t[1])/8+n.height/16]}const Te=(e,r)=>Math.abs(e-r),Jn=e=>(r,n,t,i)=>Te(r,t)<2&&(e==="white"?i===n+1||n<=1&&i===n+2&&r===t:i===n-1||n>=6&&i===n-2&&r===t),Kr=(e,r,n,t)=>{const i=Te(e,n),a=Te(r,t);return i===1&&a===2||i===2&&a===1},Fr=(e,r,n,t)=>Te(e,n)===Te(r,t),$r=(e,r,n,t)=>e===n||r===t,Xr=(e,r,n,t)=>Fr(e,r,n,t)||$r(e,r,n,t),Kn=(e,r,n)=>(t,i,a,u)=>Te(t,a)<2&&Te(i,u)<2||n&&i===u&&i===(e==="white"?0:7)&&(t===4&&(a===2&&r.includes(0)||a===6&&r.includes(7))||r.includes(a));function Fn(e,r){const n=r==="white"?"1":"8",t=[];for(const[i,a]of e)i[1]===n&&a.color===r&&a.role==="rook"&&t.push(Z(i)[0]);return t}function en(e,r,n){const t=e.get(r);if(!t)return[];const i=Z(r),a=t.role,u=a==="pawn"?Jn(t.color):a==="knight"?Kr:a==="bishop"?Fr:a==="rook"?$r:a==="queen"?Xr:Kn(t.color,Fn(e,t.color),n);return Yr.filter(f=>(i[0]!==f[0]||i[1]!==f[1])&&u(i[0],i[1],f[0],f[1])).map(F)}function Y(e,...r){e&&setTimeout(()=>e(...r),1)}function $n(e){e.orientation=fr(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}function Xn(e,r){for(const[n,t]of r)t?e.pieces.set(n,t):e.pieces.delete(n)}function et(e,r){if(e.check=void 0,r===!0&&(r=e.turnColor),r)for(const[n,t]of e.pieces)t.role==="king"&&t.color===r&&(e.check=n)}function rt(e,r,n,t){Ne(e),e.premovable.current=[r,n],Y(e.premovable.events.set,r,n,t)}function Le(e){e.premovable.current&&(e.premovable.current=void 0,Y(e.premovable.events.unset))}function nt(e,r,n){Le(e),e.predroppable.current={role:r,key:n},Y(e.predroppable.events.set,r,n)}function Ne(e){const r=e.predroppable;r.current&&(r.current=void 0,Y(r.events.unset))}function tt(e,r,n){if(!e.autoCastle)return!1;const t=e.pieces.get(r);if(!t||t.role!=="king")return!1;const i=Z(r),a=Z(n);if(i[1]!==0&&i[1]!==7||i[1]!==a[1])return!1;i[0]===4&&!e.pieces.has(n)&&(a[0]===6?n=F([7,a[1]]):a[0]===2&&(n=F([0,a[1]])));const u=e.pieces.get(n);return!u||u.color!==t.color||u.role!=="rook"?!1:(e.pieces.delete(r),e.pieces.delete(n),i[0]<a[0]?(e.pieces.set(F([6,a[1]]),t),e.pieces.set(F([5,a[1]]),u)):(e.pieces.set(F([2,a[1]]),t),e.pieces.set(F([3,a[1]]),u)),!0)}function rn(e,r,n){const t=e.pieces.get(r),i=e.pieces.get(n);if(r===n||!t)return!1;const a=i&&i.color!==t.color?i:void 0;return n===e.selected&&$(e),Y(e.events.move,r,n,a),tt(e,r,n)||(e.pieces.set(n,t),e.pieces.delete(r)),e.lastMove=[r,n],e.check=void 0,Y(e.events.change),a||!0}function pr(e,r,n,t){if(e.pieces.has(n))if(t)e.pieces.delete(n);else return!1;return Y(e.events.dropNewPiece,r,n),e.pieces.set(n,r),e.lastMove=[n],e.check=void 0,Y(e.events.change),e.movable.dests=void 0,e.turnColor=fr(e.turnColor),!0}function nn(e,r,n){const t=rn(e,r,n);return t&&(e.movable.dests=void 0,e.turnColor=fr(e.turnColor),e.animation.current=void 0),t}function tn(e,r,n){if(Ir(e,r,n)){const t=nn(e,r,n);if(t){const i=e.hold.stop();$(e);const a={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:i};return t!==!0&&(a.captured=t),Y(e.movable.events.after,r,n,a),!0}}else if(ot(e,r,n))return rt(e,r,n,{ctrlKey:e.stats.ctrlKey}),$(e),!0;return $(e),!1}function on(e,r,n,t){const i=e.pieces.get(r);i&&(it(e,r,n)||t)?(e.pieces.delete(r),pr(e,i,n,t),Y(e.movable.events.afterNewPiece,i.role,n,{premove:!1,predrop:!1})):i&&at(e,r,n)?nt(e,i.role,n):(Le(e),Ne(e)),e.pieces.delete(r),$(e)}function cr(e,r,n){if(Y(e.events.select,r),e.selected){if(e.selected===r&&!e.draggable.enabled){$(e),e.hold.cancel();return}else if((e.selectable.enabled||n)&&e.selected!==r&&tn(e,e.selected,r)){e.stats.dragged=!1;return}}(e.selectable.enabled||e.draggable.enabled)&&(cn(e,r)||Mr(e,r))&&(an(e,r),e.hold.start())}function an(e,r){e.selected=r,Mr(e,r)?e.premovable.dests=en(e.pieces,r,e.premovable.castle):e.premovable.dests=void 0}function $(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function cn(e,r){const n=e.pieces.get(r);return!!n&&(e.movable.color==="both"||e.movable.color===n.color&&e.turnColor===n.color)}const Ir=(e,r,n)=>{var t,i;return r!==n&&cn(e,r)&&(e.movable.free||!!(!((i=(t=e.movable.dests)===null||t===void 0?void 0:t.get(r))===null||i===void 0)&&i.includes(n)))};function it(e,r,n){const t=e.pieces.get(r);return!!t&&(r===n||!e.pieces.has(n))&&(e.movable.color==="both"||e.movable.color===t.color&&e.turnColor===t.color)}function Mr(e,r){const n=e.pieces.get(r);return!!n&&e.premovable.enabled&&e.movable.color===n.color&&e.turnColor!==n.color}const ot=(e,r,n)=>r!==n&&Mr(e,r)&&en(e.pieces,r,e.premovable.castle).includes(n);function at(e,r,n){const t=e.pieces.get(r),i=e.pieces.get(n);return!!t&&(!i||i.color!==e.movable.color)&&e.predroppable.enabled&&(t.role!=="pawn"||n[1]!=="1"&&n[1]!=="8")&&e.movable.color===t.color&&e.turnColor!==t.color}function ct(e,r){const n=e.pieces.get(r);return!!n&&e.draggable.enabled&&(e.movable.color==="both"||e.movable.color===n.color&&(e.turnColor===n.color||e.premovable.enabled))}function lt(e){const r=e.premovable.current;if(!r)return!1;const n=r[0],t=r[1];let i=!1;if(Ir(e,n,t)){const a=nn(e,n,t);if(a){const u={premove:!0};a!==!0&&(u.captured=a),Y(e.movable.events.after,n,t,u),i=!0}}return Le(e),i}function ut(e,r){const n=e.predroppable.current;let t=!1;if(!n)return!1;if(r(n)){const i={role:n.role,color:e.movable.color};pr(e,i,n.key)&&(Y(e.movable.events.afterNewPiece,n.role,n.key,{premove:!1,predrop:!0}),t=!0)}return Ne(e),t}function mr(e){Le(e),Ne(e),$(e)}function kr(e){e.movable.color=e.movable.dests=e.animation.current=void 0,mr(e)}function Pe(e,r,n){let t=Math.floor(8*(e[0]-n.left)/n.width);r||(t=7-t);let i=7-Math.floor(8*(e[1]-n.top)/n.height);return r||(i=7-i),t>=0&&t<8&&i>=0&&i<8?F([t,i]):void 0}function st(e,r,n,t){const i=Z(e),a=Yr.filter(g=>Xr(i[0],i[1],g[0],g[1])||Kr(i[0],i[1],g[0],g[1])),f=a.map(g=>Jr(F(g),n,t)).map(g=>Ge(r,g)),[,I]=f.reduce((g,h,m)=>g[0]<h?g:[h,m],[f[0],0]);return F(a[I])}const V=e=>e.orientation==="white",ln="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",dt={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},ft={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function un(e){e==="start"&&(e=ln);const r=new Map;let n=7,t=0;for(const i of e)switch(i){case" ":case"[":return r;case"/":if(--n,n<0)return r;t=0;break;case"~":{const a=r.get(F([t-1,n]));a&&(a.promoted=!0);break}default:{const a=i.charCodeAt(0);if(a<57)t+=a-48;else{const u=i.toLowerCase();r.set(F([t,n]),{role:dt[u],color:i===u?"black":"white"}),++t}}}return r}function gt(e){return Yn.map(r=>ur.map(n=>{const t=e.get(n+r);if(t){let i=ft[t.role];return t.color==="white"&&(i=i.toUpperCase()),t.promoted&&(i+="~"),i}else return"1"}).join("")).join("/").replace(/1{2,}/g,r=>r.length.toString())}function sn(e,r){r.animation&&(vr(e.animation,r.animation),(e.animation.duration||0)<70&&(e.animation.enabled=!1))}function dn(e,r){var n,t;if(!((n=r.movable)===null||n===void 0)&&n.dests&&(e.movable.dests=void 0),!((t=r.drawable)===null||t===void 0)&&t.autoShapes&&(e.drawable.autoShapes=[]),vr(e,r),r.fen&&(e.pieces=un(r.fen),e.drawable.shapes=[]),"check"in r&&et(e,r.check||!1),"lastMove"in r&&!r.lastMove?e.lastMove=void 0:r.lastMove&&(e.lastMove=r.lastMove),e.selected&&an(e,e.selected),sn(e,r),!e.movable.rookCastle&&e.movable.dests){const i=e.movable.color==="white"?"1":"8",a="e"+i,u=e.movable.dests.get(a),f=e.pieces.get(a);if(!u||!f||f.role!=="king")return;e.movable.dests.set(a,u.filter(I=>!(I==="a"+i&&u.includes("c"+i))&&!(I==="h"+i&&u.includes("g"+i))))}}function vr(e,r){for(const n in r)Object.prototype.hasOwnProperty.call(r,n)&&(Object.prototype.hasOwnProperty.call(e,n)&&Er(e[n])&&Er(r[n])?vr(e[n],r[n]):e[n]=r[n])}function Er(e){if(typeof e!="object"||e===null)return!1;const r=Object.getPrototypeOf(e);return r===Object.prototype||r===null}const xe=(e,r)=>r.animation.enabled?Mt(e,r):be(e,r);function be(e,r){const n=e(r);return r.dom.redraw(),n}const tr=(e,r)=>({key:e,pos:Z(e),piece:r}),pt=(e,r)=>r.sort((n,t)=>Ge(e.pos,n.pos)-Ge(e.pos,t.pos))[0];function It(e,r){const n=new Map,t=[],i=new Map,a=[],u=[],f=new Map;let I,g,h;for(const[m,_]of e)f.set(m,tr(m,_));for(const m of dr)I=r.pieces.get(m),g=f.get(m),I?g?ar(I,g.piece)||(a.push(g),u.push(tr(m,I))):u.push(tr(m,I)):g&&a.push(g);for(const m of u)g=pt(m,a.filter(_=>ar(m.piece,_.piece))),g&&(h=[g.pos[0]-m.pos[0],g.pos[1]-m.pos[1]],n.set(m.key,h.concat(h)),t.push(g.key));for(const m of a)t.includes(m.key)||i.set(m.key,m.piece);return{anims:n,fadings:i}}function fn(e,r){const n=e.animation.current;if(n===void 0){e.dom.destroyed||e.dom.redrawNow();return}const t=1-(r-n.start)*n.frequency;if(t<=0)e.animation.current=void 0,e.dom.redrawNow();else{const i=mt(t);for(const a of n.plan.anims.values())a[2]=a[0]*i,a[3]=a[1]*i;e.dom.redrawNow(!0),requestAnimationFrame((a=performance.now())=>fn(e,a))}}function Mt(e,r){const n=new Map(r.pieces),t=e(r),i=It(n,r);if(i.anims.size||i.fadings.size){const a=r.animation.current&&r.animation.current.start;r.animation.current={start:performance.now(),frequency:1/r.animation.duration,plan:i},a||fn(r,performance.now())}else r.dom.redraw();return t}const mt=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,vt=["green","red","blue","yellow"];function ht(e,r){if(r.touches&&r.touches.length>1)return;r.stopPropagation(),r.preventDefault(),r.ctrlKey?$(e):mr(e);const n=Ce(r),t=Pe(n,V(e),e.dom.bounds());!t||(e.drawable.current={orig:t,pos:n,brush:wt(r),snapToValidMove:e.drawable.defaultSnapToValidMove},gn(e))}function gn(e){requestAnimationFrame(()=>{const r=e.drawable.current;if(r){const n=Pe(r.pos,V(e),e.dom.bounds());n||(r.snapToValidMove=!1);const t=r.snapToValidMove?st(r.orig,r.pos,V(e),e.dom.bounds()):n;t!==r.mouseSq&&(r.mouseSq=t,r.dest=t!==r.orig?t:void 0,e.dom.redrawNow()),gn(e)}})}function bt(e,r){e.drawable.current&&(e.drawable.current.pos=Ce(r))}function St(e){const r=e.drawable.current;r&&(r.mouseSq&&Lt(e.drawable,r),pn(e))}function pn(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function yt(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),In(e.drawable))}function wt(e){var r;const n=(e.shiftKey||e.ctrlKey)&&qr(e),t=e.altKey||e.metaKey||((r=e.getModifierState)===null||r===void 0?void 0:r.call(e,"AltGraph"));return vt[(n?1:0)+(t?2:0)]}function Lt(e,r){const n=i=>i.orig===r.orig&&i.dest===r.dest,t=e.shapes.find(n);t&&(e.shapes=e.shapes.filter(i=>!n(i))),(!t||t.brush!==r.brush)&&e.shapes.push(r),In(e)}function In(e){e.onChange&&e.onChange(e.shapes)}function Nt(e,r){if(!r.isTrusted||r.button!==void 0&&r.button!==0||r.touches&&r.touches.length>1)return;const n=e.dom.bounds(),t=Ce(r),i=Pe(t,V(e),n);if(!i)return;const a=e.pieces.get(i),u=e.selected;!u&&e.drawable.enabled&&(e.drawable.eraseOnClick||!a||a.color!==e.turnColor)&&yt(e),r.cancelable!==!1&&(!r.touches||e.blockTouchScroll||a||u||At(e,t))&&r.preventDefault();const f=!!e.premovable.current,I=!!e.predroppable.current;e.stats.ctrlKey=r.ctrlKey,e.selected&&Ir(e,e.selected,i)?xe(m=>cr(m,i),e):cr(e,i);const g=e.selected===i,h=mn(e,i);if(a&&h&&g&&ct(e,i)){e.draggable.current={orig:i,piece:a,origPos:t,pos:t,started:e.draggable.autoDistance&&e.stats.dragged,element:h,previouslySelected:u,originTarget:r.target,keyHasChanged:!1},h.cgDragging=!0,h.classList.add("dragging");const m=e.dom.elements.ghost;m&&(m.className=`ghost ${a.color} ${a.role}`,se(m,Qe(n)(Z(i),V(e))),gr(m,!0)),hr(e)}else f&&Le(e),I&&Ne(e);e.dom.redraw()}function At(e,r){const n=V(e),t=e.dom.bounds(),i=Math.pow(t.width/8,2);for(const a of e.pieces.keys()){const u=Jr(a,n,t);if(Ge(u,r)<=i)return!0}return!1}function Dt(e,r,n,t){const i="a0";e.pieces.set(i,r),e.dom.redraw();const a=Ce(n);e.draggable.current={orig:i,piece:r,origPos:a,pos:a,started:!0,element:()=>mn(e,i),originTarget:n.target,newPiece:!0,force:!!t,keyHasChanged:!1},hr(e)}function hr(e){requestAnimationFrame(()=>{var r;const n=e.draggable.current;if(!n)return;!((r=e.animation.current)===null||r===void 0)&&r.plan.anims.has(n.orig)&&(e.animation.current=void 0);const t=e.pieces.get(n.orig);if(!t||!ar(t,n.piece))Je(e);else if(!n.started&&Ge(n.pos,n.origPos)>=Math.pow(e.draggable.distance,2)&&(n.started=!0),n.started){if(typeof n.element=="function"){const a=n.element();if(!a)return;a.cgDragging=!0,a.classList.add("dragging"),n.element=a}const i=e.dom.bounds();se(n.element,[n.pos[0]-i.left-i.width/16,n.pos[1]-i.top-i.height/16]),n.keyHasChanged||(n.keyHasChanged=n.orig!==Pe(n.pos,V(e),i))}hr(e)})}function jt(e,r){e.draggable.current&&(!r.touches||r.touches.length<2)&&(e.draggable.current.pos=Ce(r))}function xt(e,r){const n=e.draggable.current;if(!n)return;if(r.type==="touchend"&&r.cancelable!==!1&&r.preventDefault(),r.type==="touchend"&&n.originTarget!==r.target&&!n.newPiece){e.draggable.current=void 0;return}Le(e),Ne(e);const t=Ce(r)||n.pos,i=Pe(t,V(e),e.dom.bounds());i&&n.started&&n.orig!==i?n.newPiece?on(e,n.orig,i,n.force):(e.stats.ctrlKey=r.ctrlKey,tn(e,n.orig,i)&&(e.stats.dragged=!0)):n.newPiece?e.pieces.delete(n.orig):e.draggable.deleteOnDropOff&&!i&&(e.pieces.delete(n.orig),Y(e.events.change)),(n.orig===n.previouslySelected||n.keyHasChanged)&&(n.orig===i||!i)?$(e):e.selectable.enabled||$(e),Mn(e),e.draggable.current=void 0,e.dom.redraw()}function Je(e){const r=e.draggable.current;r&&(r.newPiece&&e.pieces.delete(r.orig),e.draggable.current=void 0,$(e),Mn(e),e.dom.redraw())}function Mn(e){const r=e.dom.elements;r.ghost&&gr(r.ghost,!1)}function mn(e,r){let n=e.dom.elements.board.firstChild;for(;n;){if(n.cgKey===r&&n.tagName==="PIECE")return n;n=n.nextSibling}}function Tt(e,r){e.exploding={stage:1,keys:r},e.dom.redraw(),setTimeout(()=>{zr(e,2),setTimeout(()=>zr(e,void 0),120)},120)}function zr(e,r){e.exploding&&(r?e.exploding.stage=r:e.exploding=void 0,e.dom.redraw())}function Ct(e,r){function n(){$n(e),r()}return{set(t){t.orientation&&t.orientation!==e.orientation&&n(),sn(e,t),(t.fen?xe:be)(i=>dn(i,t),e)},state:e,getFen:()=>gt(e.pieces),toggleOrientation:n,setPieces(t){xe(i=>Xn(i,t),e)},selectSquare(t,i){t?xe(a=>cr(a,t,i),e):e.selected&&($(e),e.dom.redraw())},move(t,i){xe(a=>rn(a,t,i),e)},newPiece(t,i){xe(a=>pr(a,t,i),e)},playPremove(){if(e.premovable.current){if(xe(lt,e))return!0;e.dom.redraw()}return!1},playPredrop(t){if(e.predroppable.current){const i=ut(e,t);return e.dom.redraw(),i}return!1},cancelPremove(){be(Le,e)},cancelPredrop(){be(Ne,e)},cancelMove(){be(t=>{mr(t),Je(t)},e)},stop(){be(t=>{kr(t),Je(t)},e)},explode(t){Tt(e,t)},setAutoShapes(t){be(i=>i.drawable.autoShapes=t,e)},setShapes(t){be(i=>i.drawable.shapes=t,e)},getKeyAtDomPos(t){return Pe(t,V(e),e.dom.bounds())},redrawAll:r,dragNewPiece(t,i,a){Dt(e,t,i,a)},destroy(){kr(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}function Pt(){return{pieces:un(ln),orientation:"white",turnColor:"white",coordinates:!0,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,pieceKey:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},prevSvgHash:""},hold:qn()}}function lr(e,r,n){const t=new Map,i=[];for(const f of e)t.set(f.hash,!1);let a=r.firstChild,u;for(;a;)u=a.getAttribute("cgHash"),t.has(u)?t.set(u,!0):i.push(a),a=a.nextSibling;for(const f of i)r.removeChild(f);for(const f of e)t.get(f.hash)||r.appendChild(n(f))}function re(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function kt(e,r,n){const t=e.drawable,i=t.current,a=i&&i.mouseSq?i:void 0,u=new Map,f=e.dom.bounds(),I=t.autoShapes.filter(L=>!L.piece);for(const L of t.shapes.concat(I).concat(a?[a]:[]))L.dest&&u.set(L.dest,(u.get(L.dest)||0)+1);const g=t.shapes.concat(I).map(L=>({shape:L,current:!1,hash:Zr(L,u,!1,f)}));a&&g.push({shape:a,current:!0,hash:Zr(a,u,!0,f)});const h=g.map(L=>L.hash).join(";");if(h===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=h;const m=r.querySelector("defs"),_=r.querySelector("g"),q=n.querySelector("g");Et(t,g,m),lr(g.filter(L=>!L.shape.customSvg),_,L=>_r(e,L,t.brushes,u,f)),lr(g.filter(L=>L.shape.customSvg),q,L=>_r(e,L,t.brushes,u,f))}function Et(e,r,n){const t=new Map;let i;for(const f of r)f.shape.dest&&(i=e.brushes[f.shape.brush],f.shape.modifiers&&(i=vn(i,f.shape.modifiers)),t.set(i.key,i));const a=new Set;let u=n.firstChild;for(;u;)a.add(u.getAttribute("cgKey")),u=u.nextSibling;for(const[f,I]of t.entries())a.has(f)||n.appendChild(Wt(I))}function Zr({orig:e,dest:r,brush:n,piece:t,modifiers:i,customSvg:a},u,f,I){return[I.width,I.height,f,e,r,n,r&&(u.get(r)||0)>1,t&&zt(t),i&&Zt(i),a&&_t(a)].filter(g=>g).join(",")}function zt(e){return[e.color,e.role,e.scale].filter(r=>r).join(",")}function Zt(e){return""+(e.lineWidth||"")}function _t(e){let r=0;for(let n=0;n<e.length;n++)r=(r<<5)-r+e.charCodeAt(n)>>>0;return"custom-"+r.toString()}function _r(e,{shape:r,current:n,hash:t},i,a,u){let f;const I=Ur(Z(r.orig),e.orientation);if(r.customSvg)f=Ut(r.customSvg,I,u);else if(r.dest){let g=i[r.brush];r.modifiers&&(g=vn(g,r.modifiers)),f=Ht(g,I,Ur(Z(r.dest),e.orientation),n,(a.get(r.dest)||0)>1,u)}else f=Rt(i[r.brush],I,n,u);return f.setAttribute("cgHash",t),f}function Ut(e,r,n){const[t,i]=Ke(r,n),a=we(re("g"),{transform:`translate(${t},${i})`}),u=we(re("svg"),{width:1,height:1,viewBox:"0 0 100 100"});return a.appendChild(u),u.innerHTML=e,a}function Rt(e,r,n,t){const i=Ke(r,t),a=Ot(),u=(t.width+t.height)/(4*Math.max(t.width,t.height));return we(re("circle"),{stroke:e.color,"stroke-width":a[n?0:1],fill:"none",opacity:hn(e,n),cx:i[0],cy:i[1],r:u-a[1]/2})}function Ht(e,r,n,t,i,a){const u=Gt(i&&!t),f=Ke(r,a),I=Ke(n,a),g=I[0]-f[0],h=I[1]-f[1],m=Math.atan2(h,g),_=Math.cos(m)*u,q=Math.sin(m)*u;return we(re("line"),{stroke:e.color,"stroke-width":Bt(e,t),"stroke-linecap":"round","marker-end":"url(#arrowhead-"+e.key+")",opacity:hn(e,t),x1:f[0],y1:f[1],x2:I[0]-_,y2:I[1]-q})}function Wt(e){const r=we(re("marker"),{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01});return r.appendChild(we(re("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),r.setAttribute("cgKey",e.key),r}function we(e,r){for(const n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.setAttribute(n,r[n]);return e}function Ur(e,r){return r==="white"?e:[7-e[0],7-e[1]]}function vn(e,r){return{color:e.color,opacity:Math.round(e.opacity*10)/10,lineWidth:Math.round(r.lineWidth||e.lineWidth),key:[e.key,r.lineWidth].filter(n=>n).join("")}}function Ot(){return[3/64,4/64]}function Bt(e,r){return(e.lineWidth||10)*(r?.85:1)/64}function hn(e,r){return(e.opacity||1)*(r?.9:1)}function Gt(e){return(e?20:10)/64}function Ke(e,r){const n=Math.min(1,r.width/r.height),t=Math.min(1,r.height/r.width);return[(e[0]-3.5)*n,(3.5-e[1])*t]}function Qt(e,r){e.innerHTML="",e.classList.add("cg-wrap");for(const I of Qn)e.classList.toggle("orientation-"+I,r.orientation===I);e.classList.toggle("manipulable",!r.viewOnly);const n=ge("cg-container");e.appendChild(n);const t=ge("cg-board");n.appendChild(t);let i,a,u;if(r.drawable.visible&&(i=we(re("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),i.appendChild(re("defs")),i.appendChild(re("g")),a=we(re("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),a.appendChild(re("g")),u=ge("cg-auto-pieces"),n.appendChild(i),n.appendChild(a),n.appendChild(u)),r.coordinates){const I=r.orientation==="black"?" black":"",g=r.ranksPosition==="left"?" left":"";n.appendChild(Rr(sr,"ranks"+I+g)),n.appendChild(Rr(ur,"files"+I))}let f;return r.draggable.enabled&&r.draggable.showGhost&&(f=ge("piece","ghost"),gr(f,!1),n.appendChild(f)),{board:t,container:n,wrap:e,ghost:f,svg:i,customSvg:a,autoPieces:u}}function Rr(e,r){const n=ge("coords",r);let t;for(const i of e)t=ge("coord"),t.textContent=i,n.appendChild(t);return n}function Yt(e,r){if(!e.dropmode.active)return;Le(e),Ne(e);const n=e.dropmode.piece;if(n){e.pieces.set("a0",n);const t=Ce(r),i=t&&Pe(t,V(e),e.dom.bounds());i&&on(e,"a0",i)}e.dom.redraw()}function Vt(e,r){const n=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(r).observe(e.dom.elements.wrap),e.viewOnly)return;const t=Jt(e);n.addEventListener("touchstart",t,{passive:!1}),n.addEventListener("mousedown",t,{passive:!1}),(e.disableContextMenu||e.drawable.enabled)&&n.addEventListener("contextmenu",i=>i.preventDefault())}function qt(e,r){const n=[];if("ResizeObserver"in window||n.push(He(document.body,"chessground.resize",r)),!e.viewOnly){const t=Hr(e,jt,bt),i=Hr(e,xt,St);for(const u of["touchmove","mousemove"])n.push(He(document,u,t));for(const u of["touchend","mouseup"])n.push(He(document,u,i));const a=()=>e.dom.bounds.clear();n.push(He(document,"scroll",a,{capture:!0,passive:!0})),n.push(He(window,"resize",a,{passive:!0}))}return()=>n.forEach(t=>t())}function He(e,r,n,t){return e.addEventListener(r,n,t),()=>e.removeEventListener(r,n,t)}const Jt=e=>r=>{e.draggable.current?Je(e):e.drawable.current?pn(e):r.shiftKey||qr(r)?e.drawable.enabled&&ht(e,r):e.viewOnly||(e.dropmode.active?Yt(e,r):Nt(e,r))},Hr=(e,r,n)=>t=>{e.drawable.current?e.drawable.enabled&&n(e,t):e.viewOnly||r(e,t)};function Kt(e){const r=V(e),n=Qe(e.dom.bounds()),t=e.dom.elements.board,i=e.pieces,a=e.animation.current,u=a?a.plan.anims:new Map,f=a?a.plan.fadings:new Map,I=e.draggable.current,g=$t(e),h=new Set,m=new Set,_=new Map,q=new Map;let L,N,k,J,R,ne,te,G,K,H;for(N=t.firstChild;N;){if(L=N.cgKey,bn(N))if(k=i.get(L),R=u.get(L),ne=f.get(L),J=N.cgPiece,N.cgDragging&&(!I||I.orig!==L)&&(N.classList.remove("dragging"),se(N,n(Z(L),r)),N.cgDragging=!1),!ne&&N.cgFading&&(N.cgFading=!1,N.classList.remove("fading")),k){if(R&&N.cgAnimating&&J===We(k)){const M=Z(L);M[0]+=R[2],M[1]+=R[3],N.classList.add("anim"),se(N,n(M,r))}else N.cgAnimating&&(N.cgAnimating=!1,N.classList.remove("anim"),se(N,n(Z(L),r)),e.addPieceZIndex&&(N.style.zIndex=ir(Z(L),r)));J===We(k)&&(!ne||!N.cgFading)?h.add(L):ne&&J===We(ne)?(N.classList.add("fading"),N.cgFading=!0):or(_,J,N)}else or(_,J,N);else if(Sn(N)){const M=N.className;g.get(L)===M?m.add(L):or(q,M,N)}N=N.nextSibling}for(const[M,y]of g)if(!m.has(M)){K=q.get(y),H=K&&K.pop();const v=n(Z(M),r);if(H)H.cgKey=M,se(H,v);else{const D=ge("square",y);D.cgKey=M,se(D,v),t.insertBefore(D,t.firstChild)}}for(const[M,y]of i)if(R=u.get(M),!h.has(M))if(te=_.get(We(y)),G=te&&te.pop(),G){G.cgKey=M,G.cgFading&&(G.classList.remove("fading"),G.cgFading=!1);const v=Z(M);e.addPieceZIndex&&(G.style.zIndex=ir(v,r)),R&&(G.cgAnimating=!0,G.classList.add("anim"),v[0]+=R[2],v[1]+=R[3]),se(G,n(v,r))}else{const v=We(y),D=ge("piece",v),pe=Z(M);D.cgPiece=v,D.cgKey=M,R&&(D.cgAnimating=!0,pe[0]+=R[2],pe[1]+=R[3]),se(D,n(pe,r)),e.addPieceZIndex&&(D.style.zIndex=ir(pe,r)),t.appendChild(D)}for(const M of _.values())Or(e,M);for(const M of q.values())Or(e,M)}function Ft(e){const r=V(e),n=Qe(e.dom.bounds());let t=e.dom.elements.board.firstChild;for(;t;)(bn(t)&&!t.cgAnimating||Sn(t))&&se(t,n(Z(t.cgKey),r)),t=t.nextSibling}function Wr(e){var r,n;const t=e.dom.elements.wrap.getBoundingClientRect(),i=e.dom.elements.container,a=t.height/t.width,u=Math.floor(t.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,f=u*a;i.style.width=u+"px",i.style.height=f+"px",e.dom.bounds.clear(),(r=e.addDimensionsCssVarsTo)===null||r===void 0||r.style.setProperty("--cg-width",u+"px"),(n=e.addDimensionsCssVarsTo)===null||n===void 0||n.style.setProperty("--cg-height",f+"px")}const bn=e=>e.tagName==="PIECE",Sn=e=>e.tagName==="SQUARE";function Or(e,r){for(const n of r)e.dom.elements.board.removeChild(n)}function ir(e,r){const t=e[1];return`${r?3+7-t:3+t}`}const We=e=>`${e.color} ${e.role}`;function $t(e){var r;const n=new Map;if(e.lastMove&&e.highlight.lastMove)for(const a of e.lastMove)ve(n,a,"last-move");if(e.check&&e.highlight.check&&ve(n,e.check,"check"),e.selected&&(ve(n,e.selected,"selected"),e.movable.showDests)){const a=(r=e.movable.dests)===null||r===void 0?void 0:r.get(e.selected);if(a)for(const f of a)ve(n,f,"move-dest"+(e.pieces.has(f)?" oc":""));const u=e.premovable.dests;if(u)for(const f of u)ve(n,f,"premove-dest"+(e.pieces.has(f)?" oc":""))}const t=e.premovable.current;if(t)for(const a of t)ve(n,a,"current-premove");else e.predroppable.current&&ve(n,e.predroppable.current.key,"current-premove");const i=e.exploding;if(i)for(const a of i.keys)ve(n,a,"exploding"+i.stage);return n}function ve(e,r,n){const t=e.get(r);t?e.set(r,`${t} ${n}`):e.set(r,n)}function or(e,r,n){const t=e.get(r);t?t.push(n):e.set(r,[n])}function Xt(e,r){const t=e.drawable.autoShapes.filter(i=>i.piece).map(i=>({shape:i,hash:ni(i),current:!1}));lr(t,r,i=>ri(e,i,e.dom.bounds()))}function ei(e){var r;const n=V(e),t=Qe(e.dom.bounds());let i=(r=e.dom.elements.autoPieces)===null||r===void 0?void 0:r.firstChild;for(;i;)Vr(i,t(Z(i.cgKey),n),i.cgScale),i=i.nextSibling}function ri(e,{shape:r,hash:n},t){var i,a,u;const f=r.orig,I=(i=r.piece)===null||i===void 0?void 0:i.role,g=(a=r.piece)===null||a===void 0?void 0:a.color,h=(u=r.piece)===null||u===void 0?void 0:u.scale,m=ge("piece",`${I} ${g}`);return m.setAttribute("cgHash",n),m.cgKey=f,m.cgScale=h,Vr(m,Qe(t)(Z(f),V(e)),h),m}const ni=e=>{var r,n,t;return[e.orig,(r=e.piece)===null||r===void 0?void 0:r.role,(n=e.piece)===null||n===void 0?void 0:n.color,(t=e.piece)===null||t===void 0?void 0:t.scale].join(",")};function ti(e,r){const n=Pt();dn(n,r||{});function t(){const i="dom"in n?n.dom.unbind:void 0,a=Qt(e,n),u=Vn(()=>a.board.getBoundingClientRect()),f=h=>{Kt(g),a.autoPieces&&Xt(g,a.autoPieces),!h&&a.svg&&kt(g,a.svg,a.customSvg)},I=()=>{Wr(g),Ft(g),a.autoPieces&&ei(g)},g=n;return g.dom={elements:a,bounds:u,redraw:ii(f),redrawNow:f,unbind:i},g.drawable.prevSvgHash="",Wr(g),f(!1),Vt(g,I),i||(g.dom.unbind=qt(g,I)),g.events.insert&&g.events.insert(a),g}return Ct(t(),t)}function ii(e){let r=!1;return()=>{r||(r=!0,requestAnimationFrame(()=>{e(),r=!1}))}}const oi=Br({__name:"Chessboard",props:{config:null},emits:["ready"],setup(e,{emit:r}){const{config:n}=e,t=je();function i(){const{value:a}=t;if(a&&a.parentElement){const u=a.parentElement;u.removeChild(a);const{width:f,height:I}=u.getBoundingClientRect();a.style.width=Math.min(f,I)+"px",a.style.height=Math.min(f,I)+"px",u.appendChild(a)}}return wn(()=>{if(t.value){i(),Ln("resize",i);const a=ti(t.value,n);r("ready",a)}}),(a,u)=>(Ee(),Oe("div",{ref_key:"board",ref:t,class:"chessboard"},null,512))}});var ai=Gr(oi,[["__scopeId","data-v-0c2a7817"]]);const ci=ye("Reset"),li=ye("Flip Board"),ui=ye(" Auto-Flip? "),si=ye(" Instantly Move AIs? "),di=ye("White"),fi=ye("Black"),gi=Br({__name:"chess",setup(e){const r=Gn(),n=new Map;let t;const i={Player(){return r.moves({verbose:!0})},Random(){const M=r.moves({verbose:!0});return M[Math.floor(M.length*Math.random())]},"Prefer Capturing"(){const M=["k","q","r","b","n","p",void 0],y=er(r.moves({verbose:!0}));return y.sort(({captured:v},{captured:D})=>M.indexOf(v)-M.indexOf(D)),y[0]},"Refuse Capturing"(){const M=["k","q","r","b","n","p",void 0],y=er(r.moves({verbose:!0}));return y.sort(({captured:v},{captured:D})=>M.indexOf(D)-M.indexOf(v)),y[0]},"Use Weak Pieces"(){const M=["k","q","r","b","n","p",void 0],y=er(r.moves({verbose:!0}));return y.sort(({piece:v},{piece:D})=>M.indexOf(D)-M.indexOf(v)).sort(({captured:v},{captured:D})=>M.indexOf(D)-M.indexOf(v)),y[0]}},a=Object.keys(i),u=je("Player"),f=je("Player"),I=je(!1),g=je(!1),h=je("w"),m=je(!1);function _(){r.reset(),h.value="w",m.value=!1,I.value&&(t==null||t.set({orientation:"white",fen:r.fen()})),K()}function q(M){I.value=M,M&&(t==null||t.set({orientation:r.turn()==="w"?"white":"black"}))}function L(){I.value&&(I.value=!1),t==null||t.toggleOrientation()}function N(M){n.clear();for(const y of M){const v=n.get(y.from)||[];v.push(y.to),n.set(y.from,v)}return n}function k(M){!t||(t.state.turnColor=t.state.movable.color=(h.value=r.turn())==="w"?"white":"black",I.value&&(t==null||t.set({orientation:r.turn()==="w"?"white":"black"})),t.state.movable.dests=N(M),t.state.movable.free=!1,t.state.movable.events.after=(y,v)=>{y==="a0"||v==="a0"?t.cancelMove():M.some(D=>D.from===y&&D.to===v)?H({from:y,to:v,promotion:"q"}):t.cancelMove()})}function J(M){t=M,t.state.blockTouchScroll=!0,t.state.premovable.enabled=!1,K()}function R(M){u.value=M,r.turn()==="w"&&K()}function ne(M){f.value=M,r.turn()==="b"&&K()}let te=0;function G(){return new Promise(M=>{setTimeout(M,g.value?0:500)})}function K(){const M=i[r.turn()==="w"?u.value:f.value],y=M();if(te++,Array.isArray(y))k(y);else if(y){k([]);const v=te;Promise.all([y,G()]).then(([D])=>{v===te&&(D?H(D):(k([]),m.value=!0))})}else k([]),m.value=!0}function H(M){const y=r.turn();if(!r.move(M)){const v=r.remove(M.from);v&&(v.color==="w"&&v.type==="p"&&M.to.startsWith("h")&&(v.type="q"),v.color==="b"&&v.type==="p"&&M.to.startsWith("a")&&(v.type="q"),r.put(v,M.to))}r.load(r.fen().replace(/ [bw] /,()=>y==="b"?" w ":" b ")),t.set({fen:r.fen(),lastMove:[M.from,M.to]}),K()}return(M,y)=>(Ee(),Nn(Dn,{class:An({gameOver:m.value}),center:""},{aside:ae(()=>[ce("nav",null,[ce("ul",null,[ce("li",null,[fe(Me,{onClick:_},{default:ae(()=>[ci]),_:1})]),ce("li",null,[fe(Me,{onClick:L},{default:ae(()=>[li]),_:1})]),ce("li",null,[fe(Me,{active:I.value,onClick:y[0]||(y[0]=v=>q(!I.value))},{default:ae(()=>[ui]),_:1},8,["active"])]),ce("li",null,[fe(Me,{active:g.value,onClick:y[1]||(y[1]=v=>g.value=!g.value)},{default:ae(()=>[si]),_:1},8,["active"])]),ce("li",null,[fe(Me,{active:h.value==="w"},{default:ae(()=>[di]),_:1},8,["active"]),ce("ul",null,[(Ee(!0),Oe(Dr,null,Lr(Ar(a),v=>(Ee(),Oe("li",null,[fe(Me,{active:u.value===v,onClick:D=>R(v)},{default:ae(()=>[ye(Nr(v),1)]),_:2},1032,["active","onClick"])]))),256))])]),ce("li",null,[fe(Me,{active:h.value==="b"},{default:ae(()=>[fi]),_:1},8,["active"]),ce("ul",null,[(Ee(!0),Oe(Dr,null,Lr(Ar(a),v=>(Ee(),Oe("li",null,[fe(Me,{active:f.value===v,onClick:D=>ne(v)},{default:ae(()=>[ye(Nr(v),1)]),_:2},1032,["active","onClick"])]))),256))])])])])]),default:ae(()=>[fe(ai,{onReady:J})]),_:1},8,["class"]))}});var Li=Gr(gi,[["__scopeId","data-v-4b99ee44"]]);export{Li as default};

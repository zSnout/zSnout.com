import{v as _e,_ as me,M as A,H as B,c as pe,a as Z,F as X,T as fe}from"./SharedNav.40at9hg6.js";import{d as P,aV as ve,a3 as he,q as p,aA as E,U as ye,aW as oe,u as d,o as l,h as c,r as Y,n as ae,ay as ge,aX as ke,B as J,aY as V,v as be,aZ as Ce,aE as y,b as o,w as a,F as z,a_ as O,s as g,aG as q,j as F,c as G,a as b,t as D,aC as Q,e as i,a$ as xe,p as we,l as $e}from"./index.3wtsgydi.js";import{B as k}from"./Button.49gbgcb2.js";import{_ as T}from"./_plugin-vue_export-helper.35ltfn2z.js";import{D as Me}from"./DocumentDisplay.1u3n8z7b.js";import{D as Se}from"./Dropdown.5andrccq.js";import{I as ee}from"./InlineButton.197m3pe8.js";import{I as Ve}from"./InlineField.1bs7kao1.js";import"./Navigation.4poltm3u.js";import"./Logo.vue_vue_type_script_setup_true_lang.4ks050nj.js";import"./LogoLight.539ztpd2.js";const Oe=P({__name:"ContextMenu",props:{open:{type:Boolean}},emits:["update:open"],setup(m,{emit:u}){const s=m,I=ve(he(s,"open"),500),M=p(0),C=p(0);function r(v){(!s.open||v.type==="contextmenu")&&(M.value=v.pageX,C.value=v.pageY)}E("mousedown",r,{passive:!0}),E("mousemove",r,{passive:!0}),E("pointerdown",r,{passive:!0}),E("pointermove",r,{passive:!0}),E("contextmenu",r,{passive:!0}),E("keydown",v=>{!v.altKey&&!v.ctrlKey&&!v.metaKey&&s.open&&u("update:open",!1)});const f=p(),{height:x}=ye(f,void 0,{box:"border-box"});return(v,j)=>oe((l(),c("div",{ref_key:"menu",ref:f,class:ae([{open:m.open},"menu second-layer"]),style:ge({top:`min(${Math.max(C.value,8)}px, var(--app-height) - 0.5rem - ${d(x)}px)`,left:`min(${Math.max(M.value,8)}px, var(--app-width) - 0.5rem - 10rem)`})},[Y(v.$slots,"default",{},void 0,!0)],6)),[[d(_e),()=>d(I)&&u("update:open",!1)]])}});const De=T(Oe,[["__scopeId","data-v-7cbdd023"]]),Ie=["disabled"],Ue=P({__name:"MenuEntry",props:{disabled:{type:Boolean}},setup(m){return(u,s)=>(l(),c("button",{class:ae([{disabled:m.disabled},"entry"]),disabled:m.disabled},[Y(u.$slots,"default",{},void 0,!0)],10,Ie))}});const te=T(Ue,[["__scopeId","data-v-c48abc64"]]);const Ee={},Le={class:"sticky"};function Be(m,u){return l(),c("div",Le,[Y(m.$slots,"default",{},void 0,!0)])}const ze=T(Ee,[["render",Be],["__scopeId","data-v-b70addb1"]]);const Te={},Ke={class:"sticky"};function Re(m,u){return l(),c("div",Ke,[Y(m.$slots,"default",{},void 0,!0)])}const Ne=T(Te,[["render",Re],["__scopeId","data-v-b6bfcac1"]]),H=m=>(we("data-v-d6dafe5e"),m=m(),$e(),m),qe={key:0},Fe={key:1},Ye=i(" You're not logged in. "),He=i("Log in"),je=i(" or "),Ae=i("sign up"),Xe=i(" to access this chat. "),Ge={key:2},Pe=i(" Edit Members "),We={style:{flex:"1"}},Ze=i(" Leave this Chat "),Je={key:5},Qe={class:"normalize"},et={key:0,class:"name"},tt=["onContextmenu"],ot=i(D("")),at=i("Send"),nt=i(" Delete Message "),st=i(" Edit Message "),lt=i("Add Member"),ut={class:"second-layer"},it={key:0,class:"second-layer"},dt=H(()=>b("option",{value:"view"},"Viewer",-1)),ct=H(()=>b("option",{value:"comment"},"Commenter",-1)),rt=H(()=>b("option",{value:"manage"},"Manager",-1)),_t={class:"second-layer trash-div"},mt=i("OK"),pt=i(" Cancel "),ft=i("Cancel"),vt=i("OK"),ht=H(()=>b("p",null,"Edit your message below, then click OK to send it.",-1)),yt=i("OK"),gt=i("Cancel"),kt=P({__name:"chat",setup(m){const u=p(),s=""+ke().query.id,I=p(!1),M=p(!1),C=p(""),r=J([]),f=p("waiting"),x=p("Loading title...");V("chat:message:delete",(n,e)=>{if(n===s){const _=r.findIndex(({id:t})=>t===e);_!==-1&&r.splice(_,1)}}),V("chat:message:list",(n,e)=>{n===s&&(r.splice(0,r.length,...e),setTimeout(()=>scrollTo(0,1e6)))}),V("chat:message:update",(n,e)=>{if(n===s){let _;e.from===O.value?_=r.find(t=>t.localOnly===e.content):_=r.find(t=>t.id===e.id),_?(_.content=e.content,_.from=e.from,_.id=e.id,_.timestamp=e.timestamp,delete _.localOnly):r.push(e),document.body.scrollHeight-window.innerHeight+8>=scrollY&&setTimeout(()=>scrollTo(0,1e6))}}),V("chat:update:title",(n,e)=>{n===s&&(x.value=e,document.title=`${x.value} | zSnout`)}),V("chat:permission",(n,e)=>{n===s&&(f.value=e)}),be(()=>{y.emit("chat:watch:start",g.value,s)}),V("connect",()=>{y.emit("chat:watch:start",g.value,s)}),Ce(()=>y.emit("chat:watch:stop",s));function v(n){var e;n==null||n.preventDefault(),C.value&&(y.emit("chat:message:send",g.value,s,C.value),r.push({from:O.value,content:"Sending your message...",id:((e=window.crypto)==null?void 0:e.randomUUID())||"",timestamp:Date.now(),localOnly:C.value.slice(0,1e3)}),C.value="")}function j(n){u.value=n,I.value=!0}function ne(){I.value=!1,u.value&&y.emit("chat:message:delete",g.value,s,u.value.id)}const K=p(!1),L=p("");function se(){u.value&&u.value.from===O.value&&(K.value=!0,L.value=u.value.content)}function le(){u.value&&(K.value=!1,u.value.content=L.value,y.emit("chat:message:update",g.value,s,u.value.id,L.value))}const R=p(!1),w=J(Object.create(null));V("chat:update:members",(n,e)=>{if(n===s){for(let _ in w)delete w[_];Object.assign(w,e)}});function ue(){f.value==="manage"&&(S.splice(0,S.length),y.emit("chat:request:members",g.value,s),R.value=!0)}const S=[];function ie(){if(f.value==="manage"){for(const n of S)y.emit("chat:message:send",g.value,s,n);S.splice(0,S.length),y.emit("chat:update:members",g.value,s,w)}}const U=p("");function W(n){n==null||n.preventDefault(),U.value&&(w[U.value]="comment",S.push(`(added ${U.value})`),U.value="")}function de(n){S.push(`(removed ${n})`),delete w[n]}const N=p(!1);function ce(){N.value=!0}function re(){N.value=!1,y.emit("chat:leave",g.value,s),xe.push("/my-chats")}return(n,e)=>{var _;return l(),c(z,null,[o(Me,{center:"","no-footer":""},{default:a(()=>[o(Ne,{class:"normalize"},{default:a(()=>[d(q)?F("",!0):(l(),c("p",qe," Looks like you're temporarily offline. zSnout is reconnecting... ")),d(g)?f.value==="none"?(l(),c("p",Ge," Looks like you don't have permission to access this chat! ")):d(q)&&f.value==="manage"?(l(),G(B,{key:3,wraps:""},{default:a(()=>[o(Ve,{maxlength:100,"model-value":x.value,style:{flex:"1"},"onUpdate:modelValue":e[2]||(e[2]=t=>d(y).emit("chat:update:title",d(g),s,x.value=t))},null,8,["model-value"]),o(k,{pre:"",style:{"font-size":"1rem"},onClick:ue},{default:a(()=>[Pe]),_:1})]),_:1})):d(q)?(l(),G(B,{key:4,wraps:""},{default:a(()=>[b("p",We,D(x.value),1),o(k,{pre:"",style:{"font-size":"1rem"},onClick:ce},{default:a(()=>[Ze]),_:1})]),_:1})):d(q)?(l(),c("p",Je,D(x.value),1)):F("",!0):(l(),c("p",Fe,[Ye,o(ee,{onClick:e[0]||(e[0]=t=>M.value=!0)},{default:a(()=>[He]),_:1}),je,o(ee,{onClick:e[1]||(e[1]=t=>M.value=!0)},{default:a(()=>[Ae]),_:1}),Xe]))]),_:1}),b("div",Qe,[(l(!0),c(z,null,Q(r,(t,h)=>(l(),c(z,{key:t.id},[h===0||r[h-1].from!==t.from?(l(),c("div",et,D(t.from)+": ",1)):F("",!0),oe((l(),c("div",{onContextmenu:$=>($.preventDefault(),j(t)),onMousedown:e[3]||(e[3]=$=>$.preventDefault())},[i(D(t.content),1)],40,tt)),[[d(pe),$=>($.preventDefault(),j(t))]])],64))),128))]),o(Z,null,{default:a(()=>[ot]),_:1}),o(ze,{class:"normalize"},{default:a(()=>[f.value==="manage"||f.value==="comment"?(l(),c("form",{key:0,style:{"font-size":"1rem"},onSubmit:v},[o(B,null,{default:a(()=>[o(X,{modelValue:C.value,"onUpdate:modelValue":e[4]||(e[4]=t=>C.value=t),maxlength:1e3,placeholder:"Send a message...",style:{flex:"1"}},null,8,["modelValue"]),o(k,{onClick:v},{default:a(()=>[at]),_:1})]),_:1})],32)):F("",!0)]),_:1})]),_:1}),o(me,{open:M.value,"onUpdate:open":e[5]||(e[5]=t=>M.value=t)},null,8,["open"]),o(De,{open:I.value,"onUpdate:open":e[6]||(e[6]=t=>I.value=t)},{default:a(()=>{var t,h;return[o(te,{disabled:((t=u.value)==null?void 0:t.from)!==d(O),onClick:ne},{default:a(()=>[nt]),_:1},8,["disabled"]),o(te,{disabled:((h=u.value)==null?void 0:h.from)!==d(O),onClick:se},{default:a(()=>[st]),_:1},8,["disabled"])]}),_:1},8,["open"]),o(A,{open:f.value==="manage"&&R.value},{buttons:a(()=>[o(k,{onClick:e[8]||(e[8]=t=>(ie(),R.value=!1))},{default:a(()=>[mt]),_:1}),o(k,{cancel:"",onClick:e[9]||(e[9]=t=>(d(y).emit("chat:request:members",d(g),s),R.value=!1))},{default:a(()=>[pt]),_:1})]),default:a(()=>[b("form",{onSubmit:W},[o(B,null,{default:a(()=>[o(X,{modelValue:U.value,"onUpdate:modelValue":e[7]||(e[7]=t=>U.value=t),placeholder:"Type someone's username..."},null,8,["modelValue"]),o(k,{pre:"",onClick:W},{default:a(()=>[lt]),_:1})]),_:1})],32),(l(!0),c(z,null,Q(w,(t,h)=>(l(),G(B,{key:h,class:"member"},{default:a(()=>[b("div",ut,D(h),1),o(Z),h===d(O)?(l(),c("div",it,"Not Removable")):(l(),c(z,{key:1},[o(Se,{modelValue:w[h],"onUpdate:modelValue":$=>w[h]=$,class:"level"},{default:a(()=>[dt,ct,rt]),_:2},1032,["modelValue","onUpdate:modelValue"]),b("div",_t,[o(fe,{class:"trash",onClick:$=>de(h)},null,8,["onClick"])])],64))]),_:2},1024))),128))]),_:1},8,["open"]),o(A,{open:(f.value==="view"||f.value==="comment")&&N.value},{buttons:a(()=>[o(k,{cancel:"",onClick:e[10]||(e[10]=t=>N.value=!1)},{default:a(()=>[ft]),_:1}),o(k,{onClick:re},{default:a(()=>[vt]),_:1})]),default:a(()=>[b("p",null," Are you sure you want to leave "+D(x.value)+"? You can always contact the chat owner to be re-added. ",1)]),_:1},8,["open"]),o(A,{open:((_=u.value)==null?void 0:_.from)===d(O)&&K.value},{buttons:a(()=>[o(k,{onClick:le},{default:a(()=>[yt]),_:1}),o(k,{cancel:"",onClick:e[12]||(e[12]=t=>K.value=!1)},{default:a(()=>[gt]),_:1})]),default:a(()=>[ht,o(X,{modelValue:L.value,"onUpdate:modelValue":e[11]||(e[11]=t=>L.value=t),maxlength:1e3},null,8,["modelValue"])]),_:1},8,["open"])],64)}}});const Ut=T(kt,[["__scopeId","data-v-d6dafe5e"]]);export{Ut as default};

var E=Object.defineProperty;var l=(S,h,s)=>h in S?E(S,h,{enumerable:!0,configurable:!0,writable:!0,value:s}):S[h]=s;var o=(S,h,s)=>(l(S,typeof h!="symbol"?h+"":h,s),s);import{s as g}from"./index.d8290167.js";import{p as x}from"./useOption.3236779b.js";import{W as v}from"./WebGlCanvas.75c51362.js";class N extends v{constructor(s,{bounds:t,fragmentString:i,saveBounds:e,...a}={}){var r,n,y,c;super(s,{...a,fragmentString:i});o(this,"saveBounds");o(this,"navTimer",!0);o(this,"bounds");this.saveBounds=e!=null?e:!1,e&&(t={xStart:Number.isFinite(+x.xStart)?+x.xStart:t==null?void 0:t.xStart,xEnd:Number.isFinite(+x.xEnd)?+x.xEnd:t==null?void 0:t.xEnd,yStart:Number.isFinite(+x.yStart)?+x.yStart:t==null?void 0:t.yStart,yEnd:Number.isFinite(+x.yEnd)?+x.yEnd:t==null?void 0:t.yEnd}),this.setBounds({xStart:(r=t==null?void 0:t.xStart)!=null?r:-2,xEnd:(n=t==null?void 0:t.xEnd)!=null?n:2,yStart:(y=t==null?void 0:t.yStart)!=null?y:-2,yEnd:(c=t==null?void 0:t.yEnd)!=null?c:2}),g(this.canvas,()=>this.setBounds(this.bounds)),this.on("render",()=>{const{x:f,y:m}=this.mouseToCoords();this.setUniform("m",f,m)})}getNormalizedBounds(s=this.bounds){let{xStart:t,xEnd:i,yStart:e,yEnd:a}=s;const r=t+i,n=e+a,y=(i-t)/2,c=(a-e)/2,{width:f,height:m}=this.canvas;return f>m?(t=r-f/m*y,i=r+f/m*y):(e=n-m/f*c,a=n+m/f*c),{xStart:t,xEnd:i,yStart:e,yEnd:a}}getAdjusters(s=this.bounds){const{width:t,height:i}=this.canvas,{xStart:e,xEnd:a,yStart:r,yEnd:n}=this.getNormalizedBounds(s);return t>i?{scale:{x:a-e,y:n-r},offset:{x:(e-(a-e)/2)/2,y:r}}:{scale:{x:a-e,y:n-r},offset:{x:e,y:(r-(n-r)/2)/2}}}setBounds(s){const{xStart:t,xEnd:i,yStart:e,yEnd:a}=this.bounds=s;this.saveBounds&&this.navTimer&&(x.xStart=""+t,x.xEnd=""+i,x.yStart=""+e,x.yEnd=""+a,this.navTimer=!1,setTimeout(()=>this.navTimer=!0,1e3));const{offset:r,scale:n}=this.getAdjusters();this.setUniform("u_offset",r.x,r.y),this.setUniform("u_scale",n.x,n.y);const{offset:y,scale:c}=this.getAdjusters({xStart:-1,xEnd:1,yStart:-1,yEnd:1});this.setUniform("us_offset",y.x,y.y),this.setUniform("us_scale",c.x,c.y)}pxToCoords(s,t){const{offset:i,scale:e}=this.getAdjusters();return{x:s/this.canvas.clientWidth*e.x+i.x,y:(1-t/this.canvas.clientHeight)*e.y+i.y}}mouseToCoords(){return this.pxToCoords(this.mouse.x,this.canvas.clientHeight-this.mouse.y)}}export{N as C};

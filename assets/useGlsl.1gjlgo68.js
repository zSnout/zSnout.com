const o={"+":2,"-":2,"*":3,"#":3,"/":3,"**":4,"^":5,"^2":5,"^3":5};function u(s){return s==="("?0:o[s]||1}const m={"+":"l","-":"l","*":"l","#":"l","/":"l"};function $(s){return m[s]||"r"}const z=["+","-","*","#","/","^","("];function n(s){return!z.includes(s)}function g(s){s=s.toLowerCase();const p=[];let e=!1;for(;;){let l;if(s.length===0)break;s[0]==="$"||s[0]==="@"?s=s.slice(1):(l=s.match(/^\d+(?:\.\d+)?/))||!e&&(l=s.match(/^-\d+(?:\.\d+)?/))?(e&&p.push("**"),e=!0,p.push(+l[0]),s=s.slice(l[0].length)):(l=s.match(/^(sin|cos|tan|exp|log|abs|min|max)/))?(e&&p.push("**"),e=!1,p.push(l[0]),s=s.slice(l[0].length)):(l=s.match(/^(pi|pz|ppz|sz|e|i|c|z|p|m|t|fx|fy)/))?(e&&p.push("**"),e=!0,p.push(l[0]),s=s.slice(l[0].length)):(l=s.match(/^\.[xy]/))||(l=s.match(/^\^[23]/))?(e=!0,p.push(l[0]),s=s.slice(l[0].length)):((l=s.match(/^[-+*#\/^()]/))&&(e&&l[0]==="("&&p.push("**"),e=!1,l[0]===")"&&(e=!0),p.push(l[0])),s=s.slice(1))}const t=[],c=[];let f;for(;f=p.shift();)if(typeof f=="number"||f.match(/^(pi|pz|ppz|sz|e|i|c|z|fx|fy)$/))t.push(f);else if(f.match(/^\.[xy]$/))t.push(f);else if(f===")"){for(;c[c.length-1]!=="(";){const h=c[c.length-1];if(!h)return["z"];c.pop(),t.push(h)}if(c.pop()!=="(")return["z"];const l=c[c.length-1];if(!l)continue;n(l)&&(c.pop(),t.push(l))}else if(f==="("||n(f))c.push(f);else{const l=f;let h;for(;(h=c[c.length-1])&&h!=="(";){const i=u(l),r=u(h);if(!(r>i||i===r&&$(l)==="l"))break;t.push((c.pop(),h))}c.push(l)}for(;f=c.pop();){if(f==="("||f===")")return["z"];t.push(f)}return t}function v(s){try{const p=[];for(let e of s)if(typeof e=="number")p.push(`vec2(${e}, 0)`);else if(e==="i")p.push("vec2(0, 1)");else if(e==="pi")p.push("vec2(3.141592653589793, 0)");else if(e==="e")p.push("vec2(2.718281828459045, 0)");else if(e==="t")p.push("vec2(time, 0)");else if(e==="m"||e==="p")p.push("mouse");else if(e==="fx")p.push("vec2(1, -1)");else if(e==="fy")p.push("vec2(-1, 1)");else if(e.match(/^(pz|ppz|sz|c|z)$/))p.push(e);else if(e==="+"||e==="-"||e==="#"){const t=p.pop(),c=p.pop()??"";p.push(`${c} ${e==="#"?"*":e} ${t}`)}else if(e==="^2")p.push(`sqr(${p.pop()})`);else if(e==="^3")p.push(`cube(${p.pop()})`);else if(e==="*"||e==="**"||e==="/"||e==="^"||e==="min"||e==="max"){e==="/"?e="div":e==="^"?e="cx_pow":(e==="*"||e==="**")&&(e="mult");const t=p.pop(),c=p.pop();p.push(`${e}(${c}, ${t})`)}else e==="abs"?p.push(`abs(${p.pop()})`):e==="sin"||e==="cos"||e==="tan"||e==="exp"||e==="log"?p.push(`cx_${e}(${p.pop()})`):(e===".x"||e===".y")&&p.push(`vec2((${p.pop()})${e}, 0)`);return p.length!==1?"z":p[0]}catch{return"z"}}function x(s){return v(g(s))}export{x as g};

var G=Object.defineProperty,J=Object.defineProperties;var Q=Object.getOwnPropertyDescriptors;var P=Object.getOwnPropertySymbols;var V=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable;var T=(e,a,t)=>a in e?G(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t,D=(e,a)=>{for(var t in a||(a={}))V.call(a,t)&&T(e,t,a[t]);if(P)for(var t of P(a))k.call(a,t)&&T(e,t,a[t]);return e},I=(e,a)=>J(e,Q(a));import{J as v,f as n,X as B,m as h,Y as j,Z as F,_ as H,$ as K,Q as ee,r as te,S as p,M as ae}from"./index.0167cfe6.js";import{u as ne}from"./useWebGL.9467ffc4.js";function X(e,a,t,u,r){return v(()=>(n(r)-n(e))*(n(u)-n(t))/(n(a)-n(e))+n(t))}function R(e,a,t){const u=B(),r=X(0,u.width,0,1,t.x),o=X(u.height,0,0,1,t.y);return{x:v(()=>r.value*a.x.value+e.x.value),y:v(()=>o.value*a.y.value+e.y.value)}}function re(e,a){const t=B();e=ue(e,a);const u=v(()=>{const r=n(e.xStart),o=n(e.xEnd),y=n(e.yStart),x=n(e.yEnd);return t.width.value>t.height.value?{x:(r-(o-r)/2)/2,y}:{x:r,y:(y-(x-y)/2)/2}});return{offset:{x:v(()=>u.value.x),y:v(()=>u.value.y)},scale:{x:v(()=>n(e.xEnd)-n(e.xStart)),y:v(()=>n(e.yEnd)-n(e.yStart))}}}function _(e){return v(()=>[n(e.x),n(e.y)])}function ue(e,a){const t=v(()=>{const{xStart:u,xEnd:r,yStart:o,yEnd:y}=e,x=n(u)+n(r),c=n(o)+n(y),d=(n(r)-n(u))/2,i=(n(y)-n(o))/2;let{width:{value:l},height:{value:f}}=a;return(Number.isNaN(l)||l===0)&&(l=f),(Number.isNaN(f)||f===0)&&(f=l),(Number.isNaN(l)||l===0)&&(l=f=1),l<f?{xStart:u,xEnd:r,yStart:c-f/l*i,yEnd:c+f/l*i}:{xStart:x-l/f*d,xEnd:x+l/f*d,yStart:o,yEnd:y}});return{xStart:v(()=>n(t.value.xStart)),xEnd:v(()=>n(t.value.xEnd)),yStart:v(()=>n(t.value.yStart)),yEnd:v(()=>n(t.value.yEnd))}}const O=`
struct Bounds {
  float xStart;
  float xEnd;
  float yStart;
  float yEnd;
};

struct Coordinates {
  float x;
  float y;
};
`,oe=`
in vec2 _pos;
out vec2 pos;

uniform vec2 offset;
uniform vec2 scale;

void main() {
  gl_Position = vec4(_pos, 0, 1);
  pos = _pos * scale + offset;
}`;async function le(e,a,t){var x,c,d,i,l,f,g,C,M;const u={xStart:h((c=(x=t==null?void 0:t.bounds)==null?void 0:x.xStart)!=null?c:-2),xEnd:h((i=(d=t==null?void 0:t.bounds)==null?void 0:d.xEnd)!=null?i:2),yStart:h((f=(l=t==null?void 0:t.bounds)==null?void 0:l.yStart)!=null?f:-2),yEnd:h((C=(g=t==null?void 0:t.bounds)==null?void 0:g.yEnd)!=null?C:2)},r=await ne(e,O+a,I(D({},t),{vertShader:O+((M=t==null?void 0:t.vertShader)!=null?M:oe)})),{offset:o,scale:y}=re(u,r.size);if(r.useUniform("offset","f",_(o)),r.useUniform("scale","f",_(y)),(t==null?void 0:t.uniforms)===!0){r.useUniform("bounds.xStart","f",u.xStart),r.useUniform("bounds.xEnd","f",u.xEnd),r.useUniform("bounds.yStart","f",u.yStart),r.useUniform("bounds.yEnd","f",u.yEnd);const E=j(),S=R(o,y,E);r.useUniform("pointer.x","f",S.x),r.useUniform("pointer.y","f",S.y)}return Object.assign(r,{bounds:u,offset:o,scale:y})}const m=F("history");function se(e,a){return m[e]===void 0&&a!==void 0&&(typeof a=="boolean"?a?m[e]="":delete m[e]:m[e]=""+a),H({get(){return typeof a=="boolean"?m[e]==="true":typeof a=="number"?+m[e]:""+m[e]},set(t){if(typeof t=="boolean"){t?m[e]="true":delete m[e];return}m[e]=""+t}})}function ie(e,a){const t=se(e,a.value);a.value=t.value;const u=K(t,a,{direction:"rtl"});return ee(u),u}function ye(){const e=te(new Map);return p("pointermove",a=>{const{height:t,pointerId:u,pointerType:r,pressure:o,tiltX:y,tiltY:x,twist:c,width:d,x:i,y:l}=a;!e.has(u)||e.set(u,{height:t,pointerId:u,pointerType:r||null,pressure:o,tiltX:y,tiltY:x,twist:c,width:d,x:i,y:l})}),p("pointerdown",a=>{const{height:t,pointerId:u,pointerType:r,pressure:o,tiltX:y,tiltY:x,twist:c,width:d,x:i,y:l}=a;e.set(u,{height:t,pointerId:u,pointerType:r||null,pressure:o,tiltX:y,tiltY:x,twist:c,width:d,x:i,y:l})}),p("pointerup",a=>{e.delete(a.pointerId)}),p("pointercancel",a=>{e.delete(a.pointerId)}),e}function ve(e,a=1e6){return v({get(){return~~(n(a)*e.value)/n(a)},set(t){e.value=t}})}function A(e,a,t){return{xStart:v(()=>n(e.xStart)+n(t)*(n(a.x)-n(e.xStart))/10),xEnd:v(()=>n(e.xEnd)+n(t)*(n(a.x)-n(e.xEnd))/10),yStart:v(()=>n(e.yStart)+n(t)*(n(a.y)-n(e.yStart))/10),yEnd:v(()=>n(e.yEnd)+n(t)*(n(a.y)-n(e.yEnd))/10)}}async function de(e,a,t){const u=await le(e,a,t),{canvas:r,bounds:o,offset:y,onDispose:x,scale:c,useUniform:d}=u,i=j(),l={x:h(NaN),y:h(NaN)},f=h(0),g=A(o,R(y,c,i),f);if((t==null?void 0:t.uniforms)===!0){const s=A(o,R(y,c,i),1);d("zoomRegion.xStart","f",s.xStart),d("zoomRegion.xEnd","f",s.xEnd),d("zoomRegion.yStart","f",s.yStart),d("zoomRegion.yEnd","f",s.yEnd)}x(p(r,"wheel",s=>{s.preventDefault(),i.x.value=s.offsetX,i.y.value=s.offsetY,f.value=Math.sqrt(Math.abs(s.deltaY))*-Math.sign(s.deltaY)/10;const{xStart:{value:w},xEnd:{value:z},yStart:{value:Y},yEnd:{value:b}}=g;o.xStart.value=w,o.xEnd.value=z,o.yStart.value=Y,o.yEnd.value=b},{passive:!1}));const C=R(y,c,i),M=R(y,c,l),E={x:h(NaN),y:h(NaN)},S={x:h(NaN),y:h(NaN)};x(p(r,"pointermove",s=>{if(s.preventDefault(),N.value&&!isNaN(E.x.value)&&!isNaN(S.x.value)){const Y=Math.hypot(S.x.value-E.x.value,S.y.value-E.y.value);E.x.value=N.value[0].x,E.y.value=N.value[0].y,S.x.value=N.value[1].x,S.y.value=N.value[1].y;const b=Math.hypot(S.x.value-E.x.value,S.y.value-E.y.value);i.x.value=(E.x.value+S.x.value)/2,i.y.value=(E.y.value+S.y.value)/2,f.value=b>=Y?.4:-.4;const{xStart:{value:W},xEnd:{value:Z},yStart:{value:$},yEnd:{value:q}}=g;o.xStart.value=W,o.xEnd.value=Z,o.yStart.value=$,o.yEnd.value=q;return}else if(N.value){E.x.value=N.value[0].x,E.y.value=N.value[0].y,S.x.value=N.value[1].x,S.y.value=N.value[1].y;return}if(Number.isNaN(l.x.value)||Number.isNaN(l.y.value))return;i.x.value=s.offsetX,i.y.value=s.offsetY;const w=C.x.value-M.x.value,z=C.y.value-M.y.value;o.xStart.value-=w,o.xEnd.value-=w,o.yStart.value-=z,o.yEnd.value-=z,l.x.value=i.x.value,l.y.value=i.y.value})),x(p(r,"pointerdown",s=>{r.setPointerCapture(s.pointerId),l.x.value=s.offsetX,l.y.value=s.offsetY})),x(p("pointerup",s=>{r.releasePointerCapture(s.pointerId),l.x.value=NaN,l.y.value=NaN}));const L=ye(),N=v(()=>{const s=[...L.values()].filter(w=>w.pointerType=="touch");if(s.length===2)return s});function U(s){x(ie(s,ve(ae(o,s))))}return U("xStart"),U("xEnd"),U("yStart"),U("yEnd"),u}export{de as a,ie as s,ve as u};
